import{s as ve,e as ue,i as Y,d as x,u as _e,f as S,l as se,a as R,g as C,h as L,m as re,c as A,j as E,z as u,n as ae,P as z,I as he,r as ce,V as xe,C as we,p as ke}from"../chunks/scheduler.rZW7Z6w_.js";import{S as be,i as Ee,g as K,t as P,c as Q,a as N,b as F,d as J,m as B,e as X}from"../chunks/index.WQ7nL_NI.js";import{e as fe}from"../chunks/each.o0bxhoLd.js";import"../chunks/ProgressBar.svelte_svelte_type_style_lang.6aodKNVu.js";import{A as ye}from"../chunks/Avatar._y3B20rW.js";import{u as Se}from"../chunks/stores.GqnCJTk4.js";import{g as Ie}from"../chunks/stores.8166QIDq.js";const Le=""+new URL("../assets/pere-ubu-head.ryl4GOAg.jpg",import.meta.url).href;function Te(l){let t,e,s,r,a=l[2].firstname+"",i,d,n,o,h,f,g;return f=new ye({props:{src:"https://i.pravatar.cc/?img=14",width:"w-12"}}),{c(){t=S("div"),e=S("div"),s=S("header"),r=S("p"),i=se(a),d=R(),n=S("p"),o=se(l[0]),h=R(),F(f.$$.fragment),this.h()},l(v){t=C(v,"DIV",{class:!0});var y=L(t);e=C(y,"DIV",{class:!0});var I=L(e);s=C(I,"HEADER",{class:!0});var D=L(s);r=C(D,"P",{class:!0});var _=L(r);i=re(_,a),_.forEach(x),D.forEach(x),d=A(I),n=C(I,"P",{});var O=L(n);o=re(O,l[0]),O.forEach(x),I.forEach(x),h=A(y),J(f.$$.fragment,y),y.forEach(x),this.h()},h(){E(r,"class","font-bold"),E(s,"class","flex items-center justify-between"),E(e,"class","card variant-filled-tertiary space-y-2 rounded-tr-none p-4"),E(t,"class","grid grid-cols-[1fr_auto] gap-2")},m(v,y){Y(v,t,y),u(t,e),u(e,s),u(s,r),u(r,i),u(e,d),u(e,n),u(n,o),u(t,h),B(f,t,null),g=!0},p(v,y){(!g||y&4)&&a!==(a=v[2].firstname+"")&&ae(i,a),(!g||y&1)&&ae(o,v[0])},i(v){g||(N(f.$$.fragment,v),g=!0)},o(v){P(f.$$.fragment,v),g=!1},d(v){v&&x(t),X(f)}}}function Ne(l){let t,e,s,r,a,i='<p class="font-bold">Père Ubu</p>',d,n,o,h;return e=new ye({props:{src:Le,width:"w-12"}}),{c(){t=S("div"),F(e.$$.fragment),s=R(),r=S("div"),a=S("header"),a.innerHTML=i,d=R(),n=S("p"),o=se(l[0]),this.h()},l(f){t=C(f,"DIV",{class:!0});var g=L(t);J(e.$$.fragment,g),s=A(g),r=C(g,"DIV",{class:!0});var v=L(r);a=C(v,"HEADER",{class:!0,"data-svelte-h":!0}),z(a)!=="svelte-diubji"&&(a.innerHTML=i),d=A(v),n=C(v,"P",{});var y=L(n);o=re(y,l[0]),y.forEach(x),v.forEach(x),g.forEach(x),this.h()},h(){E(a,"class","flex items-center justify-between"),E(r,"class","card variant-filled-secondary space-y-2 rounded-tl-none p-4"),E(t,"class","grid grid-cols-[auto_1fr] gap-2")},m(f,g){Y(f,t,g),B(e,t,null),u(t,s),u(t,r),u(r,a),u(r,d),u(r,n),u(n,o),h=!0},p(f,g){(!h||g&1)&&ae(o,f[0])},i(f){h||(N(e.$$.fragment,f),h=!0)},o(f){P(e.$$.fragment,f),h=!1},d(f){f&&x(t),X(e)}}}function Oe(l){let t,e,s,r;const a=[Ne,Te],i=[];function d(n,o){return n[1]==="assistant"?0:1}return t=d(l),e=i[t]=a[t](l),{c(){e.c(),s=ue()},l(n){e.l(n),s=ue()},m(n,o){i[t].m(n,o),Y(n,s,o),r=!0},p(n,[o]){let h=t;t=d(n),t===h?i[t].p(n,o):(K(),P(i[h],1,1,()=>{i[h]=null}),Q(),e=i[t],e?e.p(n,o):(e=i[t]=a[t](n),e.c()),N(e,1),e.m(s.parentNode,s))},i(n){r||(N(e),r=!0)},o(n){P(e),r=!1},d(n){n&&x(s),i[t].d(n)}}}function Pe(l,t,e){let s;_e(l,Se,i=>e(2,s=i));let{message:r}=t,{role:a}=t;return l.$$set=i=>{"message"in i&&e(0,r=i.message),"role"in i&&e(1,a=i.role)},[r,a,s]}class ne extends be{constructor(t){super(),Ee(this,t,Pe,Oe,ve,{message:0,role:1})}}var W=function(l,t){if(!(this instanceof W))return new W(l,t);this.INITIALIZING=-1,this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,this.url=l,t=t||{},this.headers=t.headers||{},this.payload=t.payload!==void 0?t.payload:"",this.method=t.method||this.payload&&"POST"||"GET",this.withCredentials=!!t.withCredentials,this.debug=!!t.debug,this.FIELD_SEPARATOR=":",this.listeners={},this.xhr=null,this.readyState=this.INITIALIZING,this.progress=0,this.chunk="",this.addEventListener=function(e,s){this.listeners[e]===void 0&&(this.listeners[e]=[]),this.listeners[e].indexOf(s)===-1&&this.listeners[e].push(s)},this.removeEventListener=function(e,s){if(this.listeners[e]!==void 0){var r=[];this.listeners[e].forEach(function(a){a!==s&&r.push(a)}),r.length===0?delete this.listeners[e]:this.listeners[e]=r}},this.dispatchEvent=function(e){if(!e)return!0;this.debug&&console.debug(e),e.source=this;var s="on"+e.type;return this.hasOwnProperty(s)&&(this[s].call(this,e),e.defaultPrevented)?!1:this.listeners[e.type]?this.listeners[e.type].every(function(r){return r(e),!e.defaultPrevented}):!0},this._setReadyState=function(e){var s=new CustomEvent("readystatechange");s.readyState=e,this.readyState=e,this.dispatchEvent(s)},this._onStreamFailure=function(e){var s=new CustomEvent("error");s.data=e.currentTarget.response,this.dispatchEvent(s),this.close()},this._onStreamAbort=function(e){this.dispatchEvent(new CustomEvent("abort")),this.close()},this._onStreamProgress=function(e){if(this.xhr){if(this.xhr.status!==200){this._onStreamFailure(e);return}this.readyState==this.CONNECTING&&(this.dispatchEvent(new CustomEvent("open")),this._setReadyState(this.OPEN));var s=this.xhr.responseText.substring(this.progress);this.progress+=s.length;var r=(this.chunk+s).split(/(\r\n\r\n|\r\r|\n\n)/g),a=r.pop();r.forEach(function(i){i.trim().length>0&&this.dispatchEvent(this._parseEventChunk(i))}.bind(this)),this.chunk=a}},this._onStreamLoaded=function(e){this._onStreamProgress(e),this.dispatchEvent(this._parseEventChunk(this.chunk)),this.chunk=""},this._parseEventChunk=function(e){if(!e||e.length===0)return null;this.debug&&console.debug(e);var s={id:null,retry:null,data:null,event:"message"};e.split(/\n|\r\n|\r/).forEach(function(a){a=a.trimRight();var i=a.indexOf(this.FIELD_SEPARATOR);if(!(i<=0)){var d=a.substring(0,i);if(d in s){var n=a[i+1]===" "?2:1,o=a.substring(i+n);d==="data"&&s[d]!==null?s.data+=`
`+o:s[d]=o}}}.bind(this));var r=new CustomEvent(s.event);return r.data=s.data||"",r.id=s.id,r},this._checkStreamClosed=function(){this.xhr&&this.xhr.readyState===XMLHttpRequest.DONE&&this._setReadyState(this.CLOSED)},this.stream=function(){if(!this.xhr){this._setReadyState(this.CONNECTING),this.xhr=new XMLHttpRequest,this.xhr.addEventListener("progress",this._onStreamProgress.bind(this)),this.xhr.addEventListener("load",this._onStreamLoaded.bind(this)),this.xhr.addEventListener("readystatechange",this._checkStreamClosed.bind(this)),this.xhr.addEventListener("error",this._onStreamFailure.bind(this)),this.xhr.addEventListener("abort",this._onStreamAbort.bind(this)),this.xhr.open(this.method,this.url);for(var e in this.headers)this.xhr.setRequestHeader(e,this.headers[e]);this.xhr.withCredentials=this.withCredentials,this.xhr.send(this.payload)}},this.close=function(){this.readyState!==this.CLOSED&&(this.xhr.abort(),this.xhr=null,this._setReadyState(this.CLOSED))},(t.start===void 0||t.start)&&this.stream()};typeof exports<"u"&&(exports.SSE=W);const De=""+new URL("../assets/ubu-roi.kZBfKq9G.jpg",import.meta.url).href;function de(l,t,e){const s=l.slice();return s[14]=t[e],s[16]=e,s}function pe(l){let t,e;return t=new ne({props:{role:l[14].role,message:l[14].content}}),{c(){F(t.$$.fragment)},l(s){J(t.$$.fragment,s)},m(s,r){B(t,s,r),e=!0},p(s,r){const a={};r&16&&(a.role=s[14].role),r&16&&(a.message=s[14].content),t.$set(a)},i(s){e||(N(t.$$.fragment,s),e=!0)},o(s){P(t.$$.fragment,s),e=!1},d(s){X(t,s)}}}function me(l){let t,e;return t=new ne({props:{role:"assistant",message:l[0]}}),{c(){F(t.$$.fragment)},l(s){J(t.$$.fragment,s)},m(s,r){B(t,s,r),e=!0},p(s,r){const a={};r&1&&(a.message=s[0]),t.$set(a)},i(s){e||(N(t.$$.fragment,s),e=!0)},o(s){P(t.$$.fragment,s),e=!1},d(s){X(t,s)}}}function ge(l){let t,e;return t=new ne({props:{role:"assistant",message:"....."}}),{c(){F(t.$$.fragment)},l(s){J(t.$$.fragment,s)},m(s,r){B(t,s,r),e=!0},i(s){e||(N(t.$$.fragment,s),e=!0)},o(s){P(t.$$.fragment,s),e=!1},d(s){X(t,s)}}}function Re(l){let t,e,s='<h1 class="h1">Père Ubu</h1>',r,a,i=`<img src="${De}" alt="Père Ubu" width="150px" class="float-left pb-2 pr-2"/> <p class="my-2">Hé là, moi c&#39;est Père Ubu, le roi des absurdes et le maître de la
			<a href="http://college-de-pataphysique.fr/presentation/">&#39;Pataphysique&#39;</a> ! Je suis un personnage
			fictif créé par le dramaturge français Alfred Jarry au XIXe siècle.</p> <p class="my-2">Je suis connu pour mon comportement excentrique, mon langage étrange et ma nature
			imprévisible. Mon cri de guerre est &quot;Merdre !&quot;</p> <p class="my-2">Je peux essayer de t&#39;aider en Maths, mais dès fois je dis d&#39;<i>hénaurmes</i>
			bêtises ! Il vaut alors mieux que tu demandes à M. Le Jolly, qui a toujours raison.</p>`,d,n,o,h,f,g,v,y,I,D,_="+",O,T,H,M,j,Z,$,ee,ie,q=fe(l[4]),b=[];for(let c=0;c<q.length;c+=1)b[c]=pe(de(l,q,c));const Ce=c=>P(b[c],1,1,()=>{b[c]=null});let w=l[0]&&me(l),k=l[3]&&ge();return{c(){t=S("div"),e=S("div"),e.innerHTML=s,r=R(),a=S("div"),a.innerHTML=i,d=R(),n=S("div"),o=S("div"),h=S("section");for(let c=0;c<b.length;c+=1)b[c].c();f=R(),w&&w.c(),g=R(),k&&k.c(),v=R(),y=S("div"),I=S("div"),D=S("button"),D.textContent=_,O=R(),T=S("textarea"),H=R(),M=S("button"),j=S("i"),this.h()},l(c){t=C(c,"DIV",{class:!0});var p=L(t);e=C(p,"DIV",{"data-svelte-h":!0}),z(e)!=="svelte-xky6bn"&&(e.innerHTML=s),r=A(p),a=C(p,"DIV",{"data-svelte-h":!0}),z(a)!=="svelte-1rv3b5v"&&(a.innerHTML=i),d=A(p),n=C(p,"DIV",{class:!0});var m=L(n);o=C(m,"DIV",{class:!0});var G=L(o);h=C(G,"SECTION",{class:!0});var U=L(h);for(let te=0;te<b.length;te+=1)b[te].l(U);f=A(U),w&&w.l(U),g=A(U),k&&k.l(U),U.forEach(x),G.forEach(x),v=A(m),y=C(m,"DIV",{class:!0});var le=L(y);I=C(le,"DIV",{class:!0});var V=L(I);D=C(V,"BUTTON",{class:!0,"data-svelte-h":!0}),z(D)!=="svelte-pe7l84"&&(D.textContent=_),O=A(V),T=C(V,"TEXTAREA",{class:!0,name:!0,id:!0,placeholder:!0,rows:!0}),L(T).forEach(x),H=A(V),M=C(V,"BUTTON",{class:!0});var oe=L(M);j=C(oe,"I",{class:!0}),L(j).forEach(x),oe.forEach(x),V.forEach(x),le.forEach(x),m.forEach(x),p.forEach(x),this.h()},h(){E(h,"class","max-h-[400px] w-full space-y-4 p-4"),E(o,"class","bg-surface-500/30 overflow-y-auto p-4"),E(D,"class","input-group-shim"),E(T,"class","border-0 bg-transparent p-2 outline-none ring-0"),E(T,"name","prompt"),E(T,"id","prompt"),E(T,"placeholder","message..."),E(T,"rows","1"),E(j,"class","fa-solid fa-paper-plane"),E(M,"class",Z=l[1]?"variant-filled-primary":"input-group-shim"),M.disabled=l[3],E(I,"class","input-group input-group-divider rounded-container-token grid-cols-[auto_1fr_auto]"),E(y,"class","p-4"),E(n,"class","grid h-full grid-rows-[1fr_auto] gap-1"),E(t,"class","flex w-full flex-col items-center gap-12 px-8 pt-4")},m(c,p){Y(c,t,p),u(t,e),u(t,r),u(t,a),u(t,d),u(t,n),u(n,o),u(o,h);for(let m=0;m<b.length;m+=1)b[m]&&b[m].m(h,null);u(h,f),w&&w.m(h,null),u(h,g),k&&k.m(h,null),l[6](o),u(n,v),u(n,y),u(y,I),u(I,D),u(I,O),u(I,T),he(T,l[1]),u(I,H),u(I,M),u(M,j),$=!0,ee||(ie=[ce(T,"input",l[7]),ce(M,"click",l[5])],ee=!0)},p(c,[p]){if(p&16){q=fe(c[4]);let m;for(m=0;m<q.length;m+=1){const G=de(c,q,m);b[m]?(b[m].p(G,p),N(b[m],1)):(b[m]=pe(G),b[m].c(),N(b[m],1),b[m].m(h,f))}for(K(),m=q.length;m<b.length;m+=1)Ce(m);Q()}c[0]?w?(w.p(c,p),p&1&&N(w,1)):(w=me(c),w.c(),N(w,1),w.m(h,g)):w&&(K(),P(w,1,1,()=>{w=null}),Q()),c[3]?k?p&8&&N(k,1):(k=ge(),k.c(),N(k,1),k.m(h,null)):k&&(K(),P(k,1,1,()=>{k=null}),Q()),p&2&&he(T,c[1]),(!$||p&2&&Z!==(Z=c[1]?"variant-filled-primary":"input-group-shim"))&&E(M,"class",Z),(!$||p&8)&&(M.disabled=c[3])},i(c){if(!$){for(let p=0;p<q.length;p+=1)N(b[p]);N(w),N(k),$=!0}},o(c){b=b.filter(Boolean);for(let p=0;p<b.length;p+=1)P(b[p]);P(w),P(k),$=!1},d(c){c&&x(t),xe(b,c),w&&w.d(),k&&k.d(),l[6](null),ee=!1,we(ie)}}}function Ae(l,t,e){let s;_e(l,Se,_=>e(9,s=_));const r=Ie();let a="",i="",d,n=!1,o=[];function h(_){e(3,n=!1),e(1,i=""),e(0,a=""),console.error(_),r.trigger({message:"Une erreur est survenue. La limite d'utilisation est peut-être dépassée : "+_,background:"bg-error-500"})}let f=[{id:0,role:"assistant",avatar:0,name:"Ubu",content:"De par ma chandèle verte, comment puis-je t'aider ?",color:"variant-soft-primary"}];function g(_){d.scrollTo({top:d.scrollHeight,behavior:_})}function v(){e(4,f=[f[0],...o.map(_=>({id:f.length,role:_.role,avatar:_.role==="assistant"?0:48,name:_.role==="assistant"?"Ubu":s.firstname,content:_.content||"",color:"variant-soft-primary"}))])}async function y(){e(3,n=!0),o=[...o,{role:"user",content:i}],v(),e(1,i=""),setTimeout(()=>{g("smooth")},0);const _=new W("/api/chat",{headers:{"Content-Type":"application/json"},payload:JSON.stringify({messages:o.map(O=>O.role==="user"?{...O,content:'Réponds avec ta nouvelle personnalité de Père Ubu,  à la question : " '+O.content+'"'}:O)})});_.addEventListener("error",h),_.addEventListener("message",O=>{try{if(e(3,n=!1),O.data==="[DONE]"){o=[...o,{role:"assistant",content:a}],v(),e(0,a=""),setTimeout(()=>{g("smooth")},0);return}const T=JSON.parse(O.data),[{delta:H}]=T.choices;H.content&&e(0,a=(a??"")+H.content),setTimeout(()=>{g("smooth")},0)}catch(T){h(T)}}),_.stream()}function I(_){ke[_?"unshift":"push"](()=>{d=_,e(2,d)})}function D(){i=this.value,e(1,i)}return[a,i,d,n,f,y,I,D]}class Ge extends be{constructor(t){super(),Ee(this,t,Ae,Re,ve,{})}}export{Ge as component};
