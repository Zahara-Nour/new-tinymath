import{w as O}from"./index.qOeORYfI.js";import{g as D,C as S,E as q,k as y,F as C,b as v,G as N,H,I as E}from"./db.SyFzU9Zt.js";import{O as u}from"./scheduler.rZW7Z6w_.js";import{u as w}from"./stores.GqnCJTk4.js";const J={1:[{name:"Iguane",element:"feu",category:"equilibre"},{name:"Scorpion",element:"feu",category:"defensif"},{name:"Vipère",element:"feu",category:"offensif"},{name:"Lion",element:"feu",category:"offensif"},{name:"Puma",element:"feu",category:"equilibre"},{name:"Dendrobate",element:"eau",category:"equilibre"},{name:"Couleuvre",element:"eau",category:"offensif"},{name:"Sangsue",element:"eau",category:"defensif"},{name:"Gavial",element:"eau",category:"defensif"},{name:"Rage des marais",element:"eau",category:"offensif"},{name:"Veuve noire",element:"terre",category:"defensif"},{name:"Cobra",element:"terre",category:"offensif"},{name:"Loup",element:"terre",category:"equilibre"},{name:"Sanglier",element:"terre",category:"defensif"},{name:"Dévoreur",element:"terre",category:"equilibre"},{name:"Chauve-souris",element:"vent",category:"defensif"},{name:"Vautour",element:"vent",category:"equilibre"},{name:"Aigle",element:"vent",category:"offensif"},{name:"Terreur ailée",element:"vent",category:"offensif"},{name:"Dard mortel",element:"vent",category:"offensif"}],2.5:[{name:"Tigre",element:"feu",category:"offensif"},{name:"Lynx",element:"feu",category:"equilibre"},{name:"Varan",element:"eau",category:"equilibre"},{name:"Alligator",element:"eau",category:"defensif"},{name:"Jaguar",element:"terre",category:"offensif"},{name:"Boa",element:"terre",category:"equilibre"},{name:"Brute des plaines",element:"vent",category:"defensif"},{name:"Coureur du vent",element:"vent",category:"equilibre"}],4.5:[{name:"Fureur des pics",element:"feu",category:"offensif"},{name:"Grizzly",element:"feu",category:"defensif"},{name:"Anaconda",element:"eau",category:"offensif"},{name:"Hippopotame",element:"eau",category:"defensif"},{name:"Gorille",element:"terre",category:"defensif"},{name:"Ours brun",element:"terre",category:"defensif"},{name:"Harpie",element:"vent",category:"offensif"},{name:"Griffon",element:"vent",category:"defensif"}],8:[{name:"Cyclope",element:"feu",category:"offensif"},{name:"Hydre",element:"eau",category:"equilibre"},{name:"Minotaure",element:"terre",category:"defensif"},{name:"Dragon",element:"vent",category:"equilibre"}]};let{trace:P,info:R,fail:d,warn:W}=D("player","trace");const j={createMonster:L,hydrateMonster:M,async loadDB(a){const{error:n,data:e}=await S(y,a);if(n)return d("error while loading monster",n.message),null;if(e){const t={...e,position:JSON.parse(e.position),element:e.element,category:e.category};return M(t)}else return d("monster not found"),null},async insertDB(a){const{error:n,data:e}=await q(y,{...a.profile,position:JSON.stringify(a.profile.position)});n?d("coud not insert monster",n.message):e?(a.profile.id=e.id,P("saved monster",e)):d("no data returned after inserted new monster")},async updateDB(a){const{error:n,data:e}=await C(y,{...a.profile,position:JSON.stringify(a.profile.position)});n?d("coud not update monster",n.message):P("updated monster",e)}},G={id:0,nb_hunters:1,level:1,category:"offensif",name:"",element:"feu",dead:!1,position:{x:0,y:0}};function M(a){return{profile:a,get pm(){const n=k.createPlayer({..._,level:u(b).profile.level}),e=.33,t=.67;let r=Math.ceil(n.stamina*e);switch(this.profile.category){case"offensif":r=(1+t)*r;break;case"defensif":r=t*r;break}return this.profile.nb_hunters==4.5?r=r*1.05:this.profile.nb_hunters==8&&(r=r*1.1),Math.round(r)},get stamina(){const n=k.createPlayer({..._,level:u(b).profile.level}),e=3.5,t=.67;let r=Math.floor(n.pm*e+.07*n.pm*this.profile.level);switch(this.profile.category){case"offensif":r=t*r;break;case"defensif":r=(1+t)*r;break}return Math.round(this.profile.nb_hunters*r)},defineBorderColorHex(){switch(this.profile.element){case"feu":return"#ad0101";case"eau":return"#016dad";case"vent":return"#f2b819";case"terre":return"#0aae02"}},defineNameColorHex(){switch(this.profile.element){case"feu":return"#eec2c3";case"eau":return"#caecf6";case"vent":return"#f1eec1";case"terre":return"#ccf7ca"}},definePosition(){const n=u(b).profile;console.log("playerProfile",n);const e=n.position;console.log("playerPosition",e);let t=1;const r=10,o=10,s=12,l=10;let i=0,c=0,f=0,m=0,g=0,h=0;for(;t>0;){switch(this.profile.element){case"feu":i=530,c=680,f=470,m=680;break;case"eau":i=210,c=400,f=210,m=400;break;case"vent":i=250,c=450,f=500,m=720;break;case"terre":i=500,c=680,f=170,m=380;break}t=0,g=v(i,c)/10,h=v(f,m)/10,Math.abs(g-e.x)<=r&&Math.abs(h-e.y)<=o&&t++,u(b).monsters.forEach(x=>{Math.abs(g-x.profile.position.x)<=s&&Math.abs(h-x.profile.position.y)<=l&&t++})}this.profile.position={x:g,y:h}}}}function L({level:a=1,nb_hunters:n=1,caracs:e}){e||(e=$(n));const t={...G,level:a,nb_hunters:n,...e};return M(t)}function $(a){const n=J[a];return n[Math.floor(Math.random()*n.length)]}let{trace:I,info:K,fail:p,warn:Q}=D("player","trace");const _={id:0,sex:"fille",pseudo:"",avatar:"",level:1,xp:0,fire_pyrs:0,wind_pyrs:0,water_pyrs:0,earth_pyrs:0,spent_fire_pyrs:0,spent_wind_pyrs:0,spent_water_pyrs:0,spent_earth_pyrs:0,prestige:0,tuto:"",tutor:"Namuka",position:{x:0,y:0},monsters_ids:[]},T=B(_);function B(a,n=[]){return{profile:{..._,...a},monsters:n,getElementsStats(){let e={},t=this.profile.spent_fire_pyrs+this.profile.spent_water_pyrs+this.profile.spent_wind_pyrs+this.profile.spent_earth_pyrs;if(t===4){e.feu=Math.round(this.profile.spent_fire_pyrs/t*100),e.eau=Math.round(this.profile.spent_water_pyrs/t*100),e.vent=Math.round(this.profile.spent_wind_pyrs/t*100),e.terre=Math.round(this.profile.spent_earth_pyrs/t*100);const r=100-e.feu-e.eau-e.vent-e.terre,o=Math.max(...Object.values(e)),s=Object.keys(e).find(l=>e[l]===o);e[s]=e[s]+r}else{const r=this.profile.spent_fire_pyrs-1,o=this.profile.spent_water_pyrs-1,s=this.profile.spent_wind_pyrs-1,l=this.profile.spent_earth_pyrs-1;t-=4,e.feu=Math.round(r/t*100),e.eau=Math.round(o/t*100),e.vent=Math.round(s/t*100),e.terre=Math.round(l/t*100);const i=100-e.feu-e.eau-e.vent-e.terre,c=Math.max(...Object.values(e)),f=Object.keys(e).find(m=>e[m]===c);e[f]=e[f]+i}return e},defineElement(){const e=this.getElementsStats();console.log("profile elements",e);const t=Math.max(...Object.values(e)),r=Object.keys(e).filter(s=>e[s]===t);let o="";return r.length>1?this.profile.tutor==="Namuka"&&t===e.feu?o="feu":this.profile.tutor==="Katillys"&&t===e.eau?o="eau":this.profile.tutor==="Sivem"&&t===e.vent?o="vent":this.profile.tutor==="Leorn"&&t===e.terre&&(o="terre"):t===e.feu?o="feu":t===e.eau?o="eau":t===e.vent?o="vent":t===e.terre?o="terre":p("defineElement"),o},get element(){return this.defineElement()},get stamina(){let e=1,t=10;for(;e<this.profile.level;)e++,t=Math.ceil(t+e*3.75);return t},get pm(){let e=1,t=7;for(;e<this.profile.level;)e++,t=Math.ceil(t+e*1.12);return t},definePosition(){let e=0,t=0,r=0,o=0,s=0,l=0;switch(console.log("element",this.element),this.element){case"feu":e=530,r=680,t=500,o=680;break;case"eau":e=210,r=400,t=210,o=400;break;case"vent":e=250,r=450,t=550,o=720;break;case"terre":e=500,r=680,t=170,o=380;break}s=v(e,r)/10,l=v(t,o)/10;const i={x:s,y:l};this.profile.position=i}}}const k={createPlayer:B,async loadDB(a){a||(a=u(w).id);const{error:n,data:e}=await N(y,a);if(n)return p("error while loading player",n.message),null;if(e){console.log("loadDb");const t={...e,sex:e.sex,tutor:e.tutor,position:JSON.parse(e.position)},r=(await Promise.all(t.monsters_ids.map(s=>j.loadDB(s)))).filter(s=>s!==null);console.log("monsters",r);const o=this.createPlayer(t,r);return console.log("player****",o),o}else return p("player not found"),null},async insertDB({profile:a},n){n||(n=u(w).id);const e={...a,position:JSON.stringify(a.position),user_id:n},{error:t,data:r}=await H(y,e);t?p("coud not insert player",t.message):r?a.id=r.id:p("no data returned after inserted new player")},async updateDB({profile:a},n){n||(n=u(w).id);const e={...a,position:JSON.stringify(a.position),user_id:n},{error:t}=await E(y,e);t?p("coud not update player",t.message):I("player updated")}},b=O(T);export{k as a,_ as d,j as m,b as p};
