import{p as b}from"./parse.RrI1B0B4.js";import{k as h}from"./singletons.8ZDzkOWj.js";import{a as y}from"./navigation.KipUJB2f.js";function A(t){return h.apply_action(t)}function E(t){const r=JSON.parse(t);return r.data&&(r.data=b(r.data)),r}function d(t){return HTMLElement.prototype.cloneNode.call(t)}function M(t,r=()=>{}){const s=async({action:e,result:c,reset:o=!0,invalidateAll:i=!0})=>{c.type==="success"&&(o&&HTMLFormElement.prototype.reset.call(t),i&&await y()),(location.origin+location.pathname===e.origin+e.pathname||c.type==="redirect"||c.type==="error")&&A(c)};async function l(e){if((e.submitter?.hasAttribute("formmethod")?e.submitter.formMethod:d(t).method)!=="post")return;e.preventDefault();const o=new URL(e.submitter?.hasAttribute("formaction")?e.submitter.formAction:d(t).action),i=new FormData(t),u=e.submitter?.getAttribute("name");u&&i.append(u,e.submitter?.getAttribute("value")??"");const p=new AbortController;let m=!1;const f=await r({action:o,cancel:()=>m=!0,controller:p,formData:i,formElement:t,submitter:e.submitter})??s;if(m)return;let n;try{const a=await fetch(o,{method:"POST",headers:{accept:"application/json","x-sveltekit-action":"true"},cache:"no-store",body:i,signal:p.signal});n=E(await a.text()),n.type==="error"&&(n.status=a.status)}catch(a){if(a?.name==="AbortError")return;n={type:"error",error:a}}f({action:o,formData:i,formElement:t,update:a=>s({action:o,result:n,reset:a?.reset,invalidateAll:a?.invalidateAll}),result:n})}return HTMLFormElement.prototype.addEventListener.call(t,"submit",l),{destroy(){HTMLFormElement.prototype.removeEventListener.call(t,"submit",l)}}}export{M as e};
