import{_ as bt}from"./preload-helper.0HuHagjb.js";const kn="https://vlqgmctfhesdhaifmyab.supabase.co",Sn="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYyOTg5NDQxMiwiZXhwIjoxOTQ1NDcwNDEyfQ.TsEExn6lY3VjvqDIyO5FcoTLAaflgYrBWj7pkGiBOZU",En=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...i)=>bt(()=>Promise.resolve().then(()=>Ht),void 0,import.meta.url).then(({default:r})=>r(...i)):t=fetch,(...i)=>t(...i)};class _r extends Error{constructor(t,i="FunctionsError",r){super(t),this.name=i,this.context=r}}class On extends _r{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class xn extends _r{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class $n extends _r{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var Pn=function(e,t,i,r){function s(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(c){try{u(r.next(c))}catch(h){o(h)}}function l(c){try{u(r.throw(c))}catch(h){o(h)}}function u(c){c.done?n(c.value):s(c.value).then(a,l)}u((r=r.apply(e,t||[])).next())})};class An{constructor(t,{headers:i={},customFetch:r}={}){this.url=t,this.headers=i,this.fetch=En(r)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t,i={}){var r;return Pn(this,void 0,void 0,function*(){try{const{headers:s,method:n,body:o}=i;let a={},l;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",l=o):typeof o=="string"?(a["Content-Type"]="text/plain",l=o):typeof FormData<"u"&&o instanceof FormData?l=o:(a["Content-Type"]="application/json",l=JSON.stringify(o)));const u=yield this.fetch(`${this.url}/${t}`,{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),s),body:l}).catch(p=>{throw new On(p)}),c=u.headers.get("x-relay-error");if(c&&c==="true")throw new xn(u);if(!u.ok)throw new $n(u);let h=((r=u.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),d;return h==="application/json"?d=yield u.json():h==="application/octet-stream"?d=yield u.blob():h==="multipart/form-data"?d=yield u.formData():d=yield u.text(),{data:d,error:null}}catch(s){return{data:null,error:s}}})}}var Ln=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Tt=Ln();const jn=Tt.fetch,br=Tt.fetch.bind(Tt),$s=Tt.Headers,Nn=Tt.Request,Cn=Tt.Response,Ht=Object.freeze(Object.defineProperty({__proto__:null,Headers:$s,Request:Nn,Response:Cn,default:br,fetch:jn},Symbol.toStringTag,{value:"Module"}));class Dn{constructor(t){this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=t.headers,this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=t.shouldThrowOnError,this.signal=t.signal,this.isMaybeSingle=t.isMaybeSingle,t.fetch?this.fetch=t.fetch:typeof fetch>"u"?this.fetch=br:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(t,i){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async n=>{var o,a,l;let u=null,c=null,h=null,d=n.status,p=n.statusText;if(n.ok){if(this.method!=="HEAD"){const g=await n.text();g===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?c=g:c=JSON.parse(g))}const v=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),f=(a=n.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");v&&f&&f.length>1&&(h=parseInt(f[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(c)&&(c.length>1?(u={code:"PGRST116",details:`Results contain ${c.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},c=null,h=null,d=406,p="Not Acceptable"):c.length===1?c=c[0]:c=null)}else{const v=await n.text();try{u=JSON.parse(v),Array.isArray(u)&&n.status===404&&(c=[],u=null,d=200,p="OK")}catch{n.status===404&&v===""?(d=204,p="No Content"):u={message:v}}if(u&&this.isMaybeSingle&&(!((l=u?.details)===null||l===void 0)&&l.includes("0 rows"))&&(u=null,d=200,p="OK"),u&&this.shouldThrowOnError)throw u}return{error:u,data:c,count:h,status:d,statusText:p}});return this.shouldThrowOnError||(s=s.catch(n=>{var o,a,l;return{error:{message:`${(o=n?.name)!==null&&o!==void 0?o:"FetchError"}: ${n?.message}`,details:`${(a=n?.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(l=n?.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),s.then(t,i)}}class In extends Dn{select(t){let i=!1;const r=(t??"*").split("").map(s=>/\s/.test(s)&&!i?"":(s==='"'&&(i=!i),s)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(t,{ascending:i=!0,nullsFirst:r,foreignTable:s,referencedTable:n=s}={}){const o=n?`${n}.order`:"order",a=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${a?`${a},`:""}${t}.${i?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:i,referencedTable:r=i}={}){const s=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${t}`),this}range(t,i,{foreignTable:r,referencedTable:s=r}={}){const n=typeof s>"u"?"offset":`${s}.offset`,o=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${t}`),this.url.searchParams.set(o,`${i-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:t=!1,verbose:i=!1,settings:r=!1,buffers:s=!1,wal:n=!1,format:o="text"}={}){var a;const l=[t?"analyze":null,i?"verbose":null,r?"settings":null,s?"buffers":null,n?"wal":null].filter(Boolean).join("|"),u=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${u}"; options=${l};`,o==="json"?this:this}rollback(){var t;return((t=this.headers.Prefer)!==null&&t!==void 0?t:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class ft extends In{eq(t,i){return this.url.searchParams.append(t,`eq.${i}`),this}neq(t,i){return this.url.searchParams.append(t,`neq.${i}`),this}gt(t,i){return this.url.searchParams.append(t,`gt.${i}`),this}gte(t,i){return this.url.searchParams.append(t,`gte.${i}`),this}lt(t,i){return this.url.searchParams.append(t,`lt.${i}`),this}lte(t,i){return this.url.searchParams.append(t,`lte.${i}`),this}like(t,i){return this.url.searchParams.append(t,`like.${i}`),this}likeAllOf(t,i){return this.url.searchParams.append(t,`like(all).{${i.join(",")}}`),this}likeAnyOf(t,i){return this.url.searchParams.append(t,`like(any).{${i.join(",")}}`),this}ilike(t,i){return this.url.searchParams.append(t,`ilike.${i}`),this}ilikeAllOf(t,i){return this.url.searchParams.append(t,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(t,i){return this.url.searchParams.append(t,`ilike(any).{${i.join(",")}}`),this}is(t,i){return this.url.searchParams.append(t,`is.${i}`),this}in(t,i){const r=i.map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(t,`in.(${r})`),this}contains(t,i){return typeof i=="string"?this.url.searchParams.append(t,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(t,`cs.{${i.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(i)}`),this}containedBy(t,i){return typeof i=="string"?this.url.searchParams.append(t,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(t,`cd.{${i.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(i)}`),this}rangeGt(t,i){return this.url.searchParams.append(t,`sr.${i}`),this}rangeGte(t,i){return this.url.searchParams.append(t,`nxl.${i}`),this}rangeLt(t,i){return this.url.searchParams.append(t,`sl.${i}`),this}rangeLte(t,i){return this.url.searchParams.append(t,`nxr.${i}`),this}rangeAdjacent(t,i){return this.url.searchParams.append(t,`adj.${i}`),this}overlaps(t,i){return typeof i=="string"?this.url.searchParams.append(t,`ov.${i}`):this.url.searchParams.append(t,`ov.{${i.join(",")}}`),this}textSearch(t,i,{config:r,type:s}={}){let n="";s==="plain"?n="pl":s==="phrase"?n="ph":s==="websearch"&&(n="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(t,`${n}fts${o}.${i}`),this}match(t){return Object.entries(t).forEach(([i,r])=>{this.url.searchParams.append(i,`eq.${r}`)}),this}not(t,i,r){return this.url.searchParams.append(t,`not.${i}.${r}`),this}or(t,{foreignTable:i,referencedTable:r=i}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${t})`),this}filter(t,i,r){return this.url.searchParams.append(t,`${i}.${r}`),this}}class qn{constructor(t,{headers:i={},schema:r,fetch:s}){this.url=t,this.headers=i,this.schema=r,this.fetch=s}select(t,{head:i=!1,count:r}={}){const s=i?"HEAD":"GET";let n=!1;const o=(t??"*").split("").map(a=>/\s/.test(a)&&!n?"":(a==='"'&&(n=!n),a)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new ft({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(t,{count:i,defaultToNull:r=!0}={}){const s="POST",n=[];if(this.headers.Prefer&&n.push(this.headers.Prefer),i&&n.push(`count=${i}`),r||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(t)){const o=t.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(o.length>0){const a=[...new Set(o)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new ft({method:s,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}upsert(t,{onConflict:i,ignoreDuplicates:r=!1,count:s,defaultToNull:n=!0}={}){const o="POST",a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(i!==void 0&&this.url.searchParams.set("on_conflict",i),this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),n||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(t)){const l=t.reduce((u,c)=>u.concat(Object.keys(c)),[]);if(l.length>0){const u=[...new Set(l)].map(c=>`"${c}"`);this.url.searchParams.set("columns",u.join(","))}}return new ft({method:o,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}update(t,{count:i}={}){const r="PATCH",s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),i&&s.push(`count=${i}`),this.headers.Prefer=s.join(","),new ft({method:r,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}delete({count:t}={}){const i="DELETE",r=[];return t&&r.push(`count=${t}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new ft({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const Rn="1.9.0",Un={"X-Client-Info":`postgrest-js/${Rn}`};class Tr{constructor(t,{headers:i={},schema:r,fetch:s}={}){this.url=t,this.headers=Object.assign(Object.assign({},Un),i),this.schemaName=r,this.fetch=s}from(t){const i=new URL(`${this.url}/${t}`);return new qn(i,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new Tr(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,i={},{head:r=!1,count:s}={}){let n;const o=new URL(`${this.url}/rpc/${t}`);let a;r?(n="HEAD",Object.entries(i).forEach(([u,c])=>{o.searchParams.append(u,`${c}`)})):(n="POST",a=i);const l=Object.assign({},this.headers);return s&&(l.Prefer=`count=${s}`),new ft({method:n,url:o,headers:l,schema:this.schemaName,body:a,fetch:this.fetch,allowEmpty:!1})}}const Mn="2.9.1",Fn={"X-Client-Info":`realtime-js/${Mn}`},Bn="1.0.0",Ps=1e4,Zn=1e3;var vt;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(vt||(vt={}));var fe;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(fe||(fe={}));var _e;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(_e||(_e={}));var ar;(function(e){e.websocket="websocket"})(ar||(ar={}));var Ge;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(Ge||(Ge={}));class As{constructor(t,i){this.callback=t,this.timerCalc=i,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=i}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class Hn{constructor(){this.HEADER_LENGTH=1}decode(t,i){return t.constructor===ArrayBuffer?i(this._binaryDecode(t)):i(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const i=new DataView(t),r=new TextDecoder;return this._decodeBroadcast(t,i,r)}_decodeBroadcast(t,i,r){const s=i.getUint8(1),n=i.getUint8(2);let o=this.HEADER_LENGTH+2;const a=r.decode(t.slice(o,o+s));o=o+s;const l=r.decode(t.slice(o,o+n));o=o+n;const u=JSON.parse(r.decode(t.slice(o,t.byteLength)));return{ref:null,topic:a,event:l,payload:u}}}class Qi{constructor(t,i,r={},s=Ps){this.channel=t,this.event=i,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,i){var r;return this._hasReceived(t)&&i((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:t,callback:i}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=i=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=i,this._matchReceive(i)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,i){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:i})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:i}){this.recHooks.filter(r=>r.status===t).forEach(r=>r.callback(i))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var zr;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(zr||(zr={}));class Dt{constructor(t,i){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=i?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:n,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Dt.syncState(this.state,s,n,o),this.pendingDiffs.forEach(l=>{this.state=Dt.syncDiff(this.state,l,n,o)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},s=>{const{onJoin:n,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Dt.syncDiff(this.state,s,n,o),a())}),this.onJoin((s,n,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:n,newPresences:o})}),this.onLeave((s,n,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:n,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,i,r,s){const n=this.cloneDeep(t),o=this.transformState(i),a={},l={};return this.map(n,(u,c)=>{o[u]||(l[u]=c)}),this.map(o,(u,c)=>{const h=n[u];if(h){const d=c.map(f=>f.presence_ref),p=h.map(f=>f.presence_ref),w=c.filter(f=>p.indexOf(f.presence_ref)<0),v=h.filter(f=>d.indexOf(f.presence_ref)<0);w.length>0&&(a[u]=w),v.length>0&&(l[u]=v)}else a[u]=c}),this.syncDiff(n,{joins:a,leaves:l},r,s)}static syncDiff(t,i,r,s){const{joins:n,leaves:o}={joins:this.transformState(i.joins),leaves:this.transformState(i.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(n,(a,l)=>{var u;const c=(u=t[a])!==null&&u!==void 0?u:[];if(t[a]=this.cloneDeep(l),c.length>0){const h=t[a].map(p=>p.presence_ref),d=c.filter(p=>h.indexOf(p.presence_ref)<0);t[a].unshift(...d)}r(a,c,l)}),this.map(o,(a,l)=>{let u=t[a];if(!u)return;const c=l.map(h=>h.presence_ref);u=u.filter(h=>c.indexOf(h.presence_ref)<0),t[a]=u,s(a,u,l),u.length===0&&delete t[a]}),t}static map(t,i){return Object.getOwnPropertyNames(t).map(r=>i(r,t[r]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((i,r)=>{const s=t[r];return"metas"in s?i[r]=s.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):i[r]=s,i},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Z;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(Z||(Z={}));const Gr=(e,t,i={})=>{var r;const s=(r=i.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(t).reduce((n,o)=>(n[o]=Jn(o,e,t,s),n),{})},Jn=(e,t,i,r)=>{const s=t.find(a=>a.name===e),n=s?.type,o=i[e];return n&&!r.includes(n)?Ls(n,o):lr(o)},Ls=(e,t)=>{if(e.charAt(0)==="_"){const i=e.slice(1,e.length);return Kn(t,i)}switch(e){case Z.bool:return zn(t);case Z.float4:case Z.float8:case Z.int2:case Z.int4:case Z.int8:case Z.numeric:case Z.oid:return Gn(t);case Z.json:case Z.jsonb:return Vn(t);case Z.timestamp:return Qn(t);case Z.abstime:case Z.date:case Z.daterange:case Z.int4range:case Z.int8range:case Z.money:case Z.reltime:case Z.text:case Z.time:case Z.timestamptz:case Z.timetz:case Z.tsrange:case Z.tstzrange:return lr(t);default:return lr(t)}},lr=e=>e,zn=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},Gn=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},Vn=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},Kn=(e,t)=>{if(typeof e!="string")return e;const i=e.length-1,r=e[i];if(e[0]==="{"&&r==="}"){let n;const o=e.slice(1,i);try{n=JSON.parse("["+o+"]")}catch{n=o?o.split(","):[]}return n.map(a=>Ls(t,a))}return e},Qn=e=>typeof e=="string"?e.replace(" ","T"):e;var Vr;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(Vr||(Vr={}));var Kr;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes"})(Kr||(Kr={}));var Qr;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(Qr||(Qr={}));class kr{constructor(t,i={config:{}},r){this.topic=t,this.params=i,this.socket=r,this.bindings={},this.state=fe.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},i.config),this.timeout=this.socket.timeout,this.joinPush=new Qi(this,_e.join,this.params,this.timeout),this.rejoinTimer=new As(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=fe.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=fe.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=fe.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=fe.errored,this.rejoinTimer.scheduleTimeout())}),this._on(_e.reply,{},(s,n)=>{this._trigger(this._replyEventName(n),s)}),this.presence=new Dt(this),this.broadcastEndpointURL=this._broadcastEndpointURL()}subscribe(t,i=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:n,presence:o}}=this.params;this._onError(u=>t&&t("CHANNEL_ERROR",u)),this._onClose(()=>t&&t("CLOSED"));const a={},l={broadcast:n,presence:o,postgres_changes:(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&s!==void 0?s:[]};this.socket.accessToken&&(a.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:l},a)),this.joinedOnce=!0,this._rejoin(i),this.joinPush.receive("ok",({postgres_changes:u})=>{var c;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),u===void 0){t&&t("SUBSCRIBED");return}else{const h=this.bindings.postgres_changes,d=(c=h?.length)!==null&&c!==void 0?c:0,p=[];for(let w=0;w<d;w++){const v=h[w],{filter:{event:f,schema:g,table:k,filter:x}}=v,P=u&&u[w];if(P&&P.event===f&&P.schema===g&&P.table===k&&P.filter===x)p.push(Object.assign(Object.assign({},v),{id:P.id}));else{this.unsubscribe(),t&&t("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=p,t&&t("SUBSCRIBED");return}}).receive("error",u=>{t&&t("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{t&&t("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(t,i={}){return await this.send({type:"presence",event:"track",payload:t},i.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,i,r){return this._on(t,i,r)}async send(t,i={}){var r,s;if(!this._canPush()&&t.type==="broadcast"){const{event:n,payload:o}=t,a={method:"POST",headers:{apikey:(r=this.socket.accessToken)!==null&&r!==void 0?r:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:o}]})};try{return(await this._fetchWithTimeout(this.broadcastEndpointURL,a,(s=i.timeout)!==null&&s!==void 0?s:this.timeout)).ok?"ok":"error"}catch(l){return l.name==="AbortError"?"timed out":"error"}}else return new Promise(n=>{var o,a,l;const u=this._push(t.type,t,i.timeout||this.timeout);t.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&n("ok"),u.receive("ok",()=>n("ok")),u.receive("timeout",()=>n("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=fe.leaving;const i=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(_e.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const s=new Qi(this,_e.leave,{},t);s.receive("ok",()=>{i(),r("ok")}).receive("timeout",()=>{i(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}_broadcastEndpointURL(){let t=this.socket.endPoint;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"}async _fetchWithTimeout(t,i,r){const s=new AbortController,n=setTimeout(()=>s.abort(),r),o=await this.socket.fetch(t,Object.assign(Object.assign({},i),{signal:s.signal}));return clearTimeout(n),o}_push(t,i,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Qi(this,t,i,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(t,i,r){return i}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,i,r){var s,n;const o=t.toLocaleLowerCase(),{close:a,error:l,leave:u,join:c}=_e;if(r&&[a,l,u,c].indexOf(o)>=0&&r!==this._joinRef())return;let d=this._onMessage(o,i,r);if(i&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(p=>{var w,v,f;return((w=p.filter)===null||w===void 0?void 0:w.event)==="*"||((f=(v=p.filter)===null||v===void 0?void 0:v.event)===null||f===void 0?void 0:f.toLocaleLowerCase())===o}).map(p=>p.callback(d,r)):(n=this.bindings[o])===null||n===void 0||n.filter(p=>{var w,v,f,g,k,x;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const P=p.id,E=(w=p.filter)===null||w===void 0?void 0:w.event;return P&&((v=i.ids)===null||v===void 0?void 0:v.includes(P))&&(E==="*"||E?.toLocaleLowerCase()===((f=i.data)===null||f===void 0?void 0:f.type.toLocaleLowerCase()))}else{const P=(k=(g=p?.filter)===null||g===void 0?void 0:g.event)===null||k===void 0?void 0:k.toLocaleLowerCase();return P==="*"||P===((x=i?.event)===null||x===void 0?void 0:x.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof d=="object"&&"ids"in d){const w=d.data,{schema:v,table:f,commit_timestamp:g,type:k,errors:x}=w;d=Object.assign(Object.assign({},{schema:v,table:f,commit_timestamp:g,eventType:k,new:{},old:{},errors:x}),this._getPayloadRecords(w))}p.callback(d,r)})}_isClosed(){return this.state===fe.closed}_isJoined(){return this.state===fe.joined}_isJoining(){return this.state===fe.joining}_isLeaving(){return this.state===fe.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,i,r){const s=t.toLocaleLowerCase(),n={type:s,filter:i,callback:r};return this.bindings[s]?this.bindings[s].push(n):this.bindings[s]=[n],this}_off(t,i){const r=t.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(s=>{var n;return!(((n=s.type)===null||n===void 0?void 0:n.toLocaleLowerCase())===r&&kr.isEqual(s.filter,i))}),this}static isEqual(t,i){if(Object.keys(t).length!==Object.keys(i).length)return!1;for(const r in t)if(t[r]!==i[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(_e.close,{},t)}_onError(t){this._on(_e.error,{},i=>t(i))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=fe.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const i={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(i.new=Gr(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(i.old=Gr(t.columns,t.old_record)),i}}const Wn=()=>{},Yn=typeof WebSocket<"u";class Xn{constructor(t,i){var r;this.accessToken=null,this.channels=[],this.endPoint="",this.headers=Fn,this.params={},this.timeout=Ps,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Wn,this.conn=null,this.sendBuffer=[],this.serializer=new Hn,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=n=>{let o;return n?o=n:typeof fetch>"u"?o=(...a)=>bt(()=>Promise.resolve().then(()=>Ht),void 0,import.meta.url).then(({default:l})=>l(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${t}/${ar.websocket}`,i?.transport?this.transport=i.transport:this.transport=null,i?.params&&(this.params=i.params),i?.headers&&(this.headers=Object.assign(Object.assign({},this.headers),i.headers)),i?.timeout&&(this.timeout=i.timeout),i?.logger&&(this.logger=i.logger),i?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=i.heartbeatIntervalMs);const s=(r=i?.params)===null||r===void 0?void 0:r.apikey;s&&(this.accessToken=s),this.reconnectAfterMs=i?.reconnectAfterMs?i.reconnectAfterMs:n=>[1e3,2e3,5e3,1e4][n-1]||1e4,this.encode=i?.encode?i.encode:(n,o)=>o(JSON.stringify(n)),this.decode=i?.decode?i.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new As(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(i?.fetch)}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});return}if(Yn){this.conn=new WebSocket(this._endPointURL()),this.setupConnection();return}this.conn=new eo(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),bt(()=>import("./browser.Q6OzlgWg.js").then(t=>t.b),__vite__mapDeps([]),import.meta.url).then(({default:t})=>{this.conn=new t(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(t,i){this.conn&&(this.conn.onclose=function(){},t?this.conn.close(t,i??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(t){const i=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),i}async removeAllChannels(){const t=await Promise.all(this.channels.map(i=>i.unsubscribe()));return this.disconnect(),t}log(t,i,r){this.logger(t,i,r)}connectionState(){switch(this.conn&&this.conn.readyState){case vt.connecting:return Ge.Connecting;case vt.open:return Ge.Open;case vt.closing:return Ge.Closing;default:return Ge.Closed}}isConnected(){return this.connectionState()===Ge.Open}channel(t,i={config:{}}){const r=new kr(`realtime:${t}`,i,this);return this.channels.push(r),r}push(t){const{topic:i,event:r,payload:s,ref:n}=t,o=()=>{this.encode(t,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${i} ${r} (${n})`,s),this.isConnected()?o():this.sendBuffer.push(o)}setAuth(t){this.accessToken=t,this.channels.forEach(i=>{t&&i.updateJoinPayload({access_token:t}),i.joinedOnce&&i._isJoined()&&i._push(_e.access_token,{access_token:t})})}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let i=this.channels.find(r=>r.topic===t&&(r._isJoined()||r._isJoining()));i&&(this.log("transport",`leaving duplicate topic "${t}"`),i.unsubscribe())}_remove(t){this.channels=this.channels.filter(i=>i._joinRef()!==t._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Bn}))}_onConnMessage(t){this.decode(t.data,i=>{let{topic:r,event:s,payload:n,ref:o}=i;(o&&o===this.pendingHeartbeatRef||s===n?.type)&&(this.pendingHeartbeatRef=null),this.log("receive",`${n.status||""} ${r} ${s} ${o&&"("+o+")"||""}`,n),this.channels.filter(a=>a._isMember(r)).forEach(a=>a._trigger(s,n,o)),this.stateChangeCallbacks.message.forEach(a=>a(i))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(t=>t())}_onConnClose(t){this.log("transport","close",t),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(i=>i(t))}_onConnError(t){this.log("transport",t.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(i=>i(t))}_triggerChanError(){this.channels.forEach(t=>t._trigger(_e.error))}_appendParams(t,i){if(Object.keys(i).length===0)return t;const r=t.match(/\?/)?"&":"?",s=new URLSearchParams(i);return`${t}${r}${s}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_sendHeartbeat(){var t;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(t=this.conn)===null||t===void 0||t.close(Zn,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class eo{constructor(t,i,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=vt.connecting,this.send=()=>{},this.url=null,this.url=t,this.close=r.close}}class Sr extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function se(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class to extends Sr{constructor(t,i){super(t),this.name="StorageApiError",this.status=i}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Wr extends Sr{constructor(t,i){super(t),this.name="StorageUnknownError",this.originalError=i}}var io=function(e,t,i,r){function s(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(c){try{u(r.next(c))}catch(h){o(h)}}function l(c){try{u(r.throw(c))}catch(h){o(h)}}function u(c){c.done?n(c.value):s(c.value).then(a,l)}u((r=r.apply(e,t||[])).next())})};const js=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...i)=>bt(()=>Promise.resolve().then(()=>Ht),void 0,import.meta.url).then(({default:r})=>r(...i)):t=fetch,(...i)=>t(...i)},ro=()=>io(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield bt(()=>Promise.resolve().then(()=>Ht),void 0,import.meta.url)).Response:Response});var xt=function(e,t,i,r){function s(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(c){try{u(r.next(c))}catch(h){o(h)}}function l(c){try{u(r.throw(c))}catch(h){o(h)}}function u(c){c.done?n(c.value):s(c.value).then(a,l)}u((r=r.apply(e,t||[])).next())})};const Wi=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),so=(e,t)=>xt(void 0,void 0,void 0,function*(){const i=yield ro();e instanceof i?e.json().then(r=>{t(new to(Wi(r),e.status||500))}).catch(r=>{t(new Wr(Wi(r),r))}):t(new Wr(Wi(e),e))}),no=(e,t,i,r)=>{const s={method:e,headers:t?.headers||{}};return e==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json"},t?.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),i))};function ni(e,t,i,r,s,n){return xt(this,void 0,void 0,function*(){return new Promise((o,a)=>{e(i,no(t,r,s,n)).then(l=>{if(!l.ok)throw l;return r?.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>so(l,a))})})}function ur(e,t,i,r){return xt(this,void 0,void 0,function*(){return ni(e,"GET",t,i,r)})}function De(e,t,i,r,s){return xt(this,void 0,void 0,function*(){return ni(e,"POST",t,r,s,i)})}function oo(e,t,i,r,s){return xt(this,void 0,void 0,function*(){return ni(e,"PUT",t,r,s,i)})}function Ns(e,t,i,r,s){return xt(this,void 0,void 0,function*(){return ni(e,"DELETE",t,r,s,i)})}var ge=function(e,t,i,r){function s(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(c){try{u(r.next(c))}catch(h){o(h)}}function l(c){try{u(r.throw(c))}catch(h){o(h)}}function u(c){c.done?n(c.value):s(c.value).then(a,l)}u((r=r.apply(e,t||[])).next())})};const ao={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Yr={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class lo{constructor(t,i={},r,s){this.url=t,this.headers=i,this.bucketId=r,this.fetch=js(s)}uploadOrUpdate(t,i,r,s){return ge(this,void 0,void 0,function*(){try{let n;const o=Object.assign(Object.assign({},Yr),s),a=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(o.upsert)});typeof Blob<"u"&&r instanceof Blob?(n=new FormData,n.append("cacheControl",o.cacheControl),n.append("",r)):typeof FormData<"u"&&r instanceof FormData?(n=r,n.append("cacheControl",o.cacheControl)):(n=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType);const l=this._removeEmptyFolders(i),u=this._getFinalPath(l),c=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:t,body:n,headers:a},o?.duplex?{duplex:o.duplex}:{})),h=yield c.json();return c.ok?{data:{path:l,id:h.Id,fullPath:h.Key},error:null}:{data:null,error:h}}catch(n){if(se(n))return{data:null,error:n};throw n}})}upload(t,i,r){return ge(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,i,r)})}uploadToSignedUrl(t,i,r,s){return ge(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(t),o=this._getFinalPath(n),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",i);try{let l;const u=Object.assign({upsert:Yr.upsert},s),c=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",u.cacheControl)):(l=r,c["cache-control"]=`max-age=${u.cacheControl}`,c["content-type"]=u.contentType);const h=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:c}),d=yield h.json();return h.ok?{data:{path:n,fullPath:d.Key},error:null}:{data:null,error:d}}catch(l){if(se(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(t){return ge(this,void 0,void 0,function*(){try{let i=this._getFinalPath(t);const r=yield De(this.fetch,`${this.url}/object/upload/sign/${i}`,{},{headers:this.headers}),s=new URL(this.url+r.url),n=s.searchParams.get("token");if(!n)throw new Sr("No token returned by API");return{data:{signedUrl:s.toString(),path:t,token:n},error:null}}catch(i){if(se(i))return{data:null,error:i};throw i}})}update(t,i,r){return ge(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,i,r)})}move(t,i){return ge(this,void 0,void 0,function*(){try{return{data:yield De(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:i},{headers:this.headers}),error:null}}catch(r){if(se(r))return{data:null,error:r};throw r}})}copy(t,i){return ge(this,void 0,void 0,function*(){try{return{data:{path:(yield De(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:i},{headers:this.headers})).Key},error:null}}catch(r){if(se(r))return{data:null,error:r};throw r}})}createSignedUrl(t,i,r){return ge(this,void 0,void 0,function*(){try{let s=this._getFinalPath(t),n=yield De(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:i},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r?.download?`&download=${r.download===!0?"":r.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${o}`)},{data:n,error:null}}catch(s){if(se(s))return{data:null,error:s};throw s}})}createSignedUrls(t,i,r){return ge(this,void 0,void 0,function*(){try{const s=yield De(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:i,paths:t},{headers:this.headers}),n=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${n}`):null})),error:null}}catch(s){if(se(s))return{data:null,error:s};throw s}})}download(t,i){return ge(this,void 0,void 0,function*(){const s=typeof i?.transform<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString(i?.transform||{}),o=n?`?${n}`:"";try{const a=this._getFinalPath(t);return{data:yield(yield ur(this.fetch,`${this.url}/${s}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(se(a))return{data:null,error:a};throw a}})}getPublicUrl(t,i){const r=this._getFinalPath(t),s=[],n=i?.download?`download=${i.download===!0?"":i.download}`:"";n!==""&&s.push(n);const a=typeof i?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(i?.transform||{});l!==""&&s.push(l);let u=s.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${u}`)}}}remove(t){return ge(this,void 0,void 0,function*(){try{return{data:yield Ns(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(i){if(se(i))return{data:null,error:i};throw i}})}list(t,i,r){return ge(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},ao),i),{prefix:t||""});return{data:yield De(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(se(s))return{data:null,error:s};throw s}})}_getFinalPath(t){return`${this.bucketId}/${t}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const i=[];return t.width&&i.push(`width=${t.width}`),t.height&&i.push(`height=${t.height}`),t.resize&&i.push(`resize=${t.resize}`),t.format&&i.push(`format=${t.format}`),t.quality&&i.push(`quality=${t.quality}`),i.join("&")}}const uo="2.5.5",co={"X-Client-Info":`storage-js/${uo}`};var at=function(e,t,i,r){function s(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(c){try{u(r.next(c))}catch(h){o(h)}}function l(c){try{u(r.throw(c))}catch(h){o(h)}}function u(c){c.done?n(c.value):s(c.value).then(a,l)}u((r=r.apply(e,t||[])).next())})};class ho{constructor(t,i={},r){this.url=t,this.headers=Object.assign(Object.assign({},co),i),this.fetch=js(r)}listBuckets(){return at(this,void 0,void 0,function*(){try{return{data:yield ur(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){if(se(t))return{data:null,error:t};throw t}})}getBucket(t){return at(this,void 0,void 0,function*(){try{return{data:yield ur(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(i){if(se(i))return{data:null,error:i};throw i}})}createBucket(t,i={public:!1}){return at(this,void 0,void 0,function*(){try{return{data:yield De(this.fetch,`${this.url}/bucket`,{id:t,name:t,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(se(r))return{data:null,error:r};throw r}})}updateBucket(t,i){return at(this,void 0,void 0,function*(){try{return{data:yield oo(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:i.public,file_size_limit:i.fileSizeLimit,allowed_mime_types:i.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(se(r))return{data:null,error:r};throw r}})}emptyBucket(t){return at(this,void 0,void 0,function*(){try{return{data:yield De(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(i){if(se(i))return{data:null,error:i};throw i}})}deleteBucket(t){return at(this,void 0,void 0,function*(){try{return{data:yield Ns(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(i){if(se(i))return{data:null,error:i};throw i}})}}class fo extends ho{constructor(t,i={},r){super(t,i,r)}from(t){return new lo(this.url,this.headers,t,this.fetch)}}const po="2.39.1";let Nt="";typeof Deno<"u"?Nt="deno":typeof document<"u"?Nt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Nt="react-native":Nt="node";const mo={"X-Client-Info":`supabase-js-${Nt}/${po}`};var go=function(e,t,i,r){function s(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(c){try{u(r.next(c))}catch(h){o(h)}}function l(c){try{u(r.throw(c))}catch(h){o(h)}}function u(c){c.done?n(c.value):s(c.value).then(a,l)}u((r=r.apply(e,t||[])).next())})};const vo=e=>{let t;return e?t=e:typeof fetch>"u"?t=br:t=fetch,(...i)=>t(...i)},wo=()=>typeof Headers>"u"?$s:Headers,yo=(e,t,i)=>{const r=vo(i),s=wo();return(n,o)=>go(void 0,void 0,void 0,function*(){var a;const l=(a=yield t())!==null&&a!==void 0?a:e;let u=new s(o?.headers);return u.has("apikey")||u.set("apikey",e),u.has("Authorization")||u.set("Authorization",`Bearer ${l}`),r(n,Object.assign(Object.assign({},o),{headers:u}))})};function _o(e){return e.replace(/\/$/,"")}function bo(e,t){const{db:i,auth:r,realtime:s,global:n}=e,{db:o,auth:a,realtime:l,global:u}=t;return{db:Object.assign(Object.assign({},o),i),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},l),s),global:Object.assign(Object.assign({},u),n)}}function To(e){return Math.round(Date.now()/1e3)+e}function ko(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e=="x"?t:t&3|8).toString(16)})}const ye=()=>typeof document<"u",Be={tested:!1,writable:!1},It=()=>{if(!ye())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Be.tested)return Be.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Be.tested=!0,Be.writable=!0}catch{Be.tested=!0,Be.writable=!1}return Be.writable};function Yi(e){const t={},i=new URL(e);if(i.hash&&i.hash[0]==="#")try{new URLSearchParams(i.hash.substring(1)).forEach((s,n)=>{t[n]=s})}catch{}return i.searchParams.forEach((r,s)=>{t[s]=r}),t}const Cs=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...i)=>bt(()=>Promise.resolve().then(()=>Ht),void 0,import.meta.url).then(({default:r})=>r(...i)):t=fetch,(...i)=>t(...i)},So=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",Ze=async(e,t,i)=>{await e.setItem(t,JSON.stringify(i))},Kt=async(e,t)=>{const i=await e.getItem(t);if(!i)return null;try{return JSON.parse(i)}catch{return i}},Xi=async(e,t)=>{await e.removeItem(t)};function Eo(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let i="",r,s,n,o,a,l,u,c=0;for(e=e.replace("-","+").replace("_","/");c<e.length;)o=t.indexOf(e.charAt(c++)),a=t.indexOf(e.charAt(c++)),l=t.indexOf(e.charAt(c++)),u=t.indexOf(e.charAt(c++)),r=o<<2|a>>4,s=(a&15)<<4|l>>2,n=(l&3)<<6|u,i=i+String.fromCharCode(r),l!=64&&s!=0&&(i=i+String.fromCharCode(s)),u!=64&&n!=0&&(i=i+String.fromCharCode(n));return i}class oi{constructor(){this.promise=new oi.promiseConstructor((t,i)=>{this.resolve=t,this.reject=i})}}oi.promiseConstructor=Promise;function Xr(e){const t=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,i=e.split(".");if(i.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!t.test(i[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=i[1];return JSON.parse(Eo(r))}async function Oo(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function xo(e,t){return new Promise((r,s)=>{(async()=>{for(let n=0;n<1/0;n++)try{const o=await e(n);if(!t(n,null,o)){r(o);return}}catch(o){if(!t(n,o)){s(o);return}}})()})}function $o(e){return("0"+e.toString(16)).substr(-2)}function lt(){const t=new Uint32Array(56);if(typeof crypto>"u"){const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=i.length;let s="";for(let n=0;n<56;n++)s+=i.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(t),Array.from(t,$o).join("")}async function Po(e){const i=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",i),s=new Uint8Array(r);return Array.from(s).map(n=>String.fromCharCode(n)).join("")}function Ao(e){return btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ut(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const i=await Po(e);return Ao(i)}class Er extends Error{constructor(t,i){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=i}}function D(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class Lo extends Er{constructor(t,i){super(t,i),this.name="AuthApiError",this.status=i}toJSON(){return{name:this.name,message:this.message,status:this.status}}}function jo(e){return D(e)&&e.name==="AuthApiError"}class Ds extends Er{constructor(t,i){super(t),this.name="AuthUnknownError",this.originalError=i}}class it extends Er{constructor(t,i,r){super(t),this.name=i,this.status=r}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class ct extends it{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class er extends it{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}}class Qt extends it{constructor(t){super(t,"AuthInvalidCredentialsError",400)}}class Wt extends it{constructor(t,i=null){super(t,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class es extends it{constructor(t,i=null){super(t,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=i}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class cr extends it{constructor(t,i){super(t,"AuthRetryableFetchError",i)}}function tr(e){return D(e)&&e.name==="AuthRetryableFetchError"}class No extends it{constructor(t,i,r){super(t,"AuthWeakPasswordError",i),this.reasons=r}}var Co=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};const pt=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Do=[502,503,504];async function ts(e){if(!So(e))throw new cr(pt(e),0);if(Do.includes(e.status))throw new cr(pt(e),e.status);let t;try{t=await e.json()}catch(i){throw new Ds(pt(i),i)}throw typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,r)=>i&&typeof r=="string",!0)?new No(pt(t),e.status,t.weak_password.reasons):new Lo(pt(t),e.status||500)}const Io=(e,t,i,r)=>{const s={method:e,headers:t?.headers||{}};return e==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),i))};async function I(e,t,i,r){var s;const n=Object.assign({},r?.headers);r?.jwt&&(n.Authorization=`Bearer ${r.jwt}`);const o=(s=r?.query)!==null&&s!==void 0?s:{};r?.redirectTo&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await qo(e,t,i+a,{headers:n,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(l):{data:Object.assign({},l),error:null}}async function qo(e,t,i,r,s,n){const o=Io(t,r,s,n);let a;try{a=await e(i,o)}catch(l){throw console.error(l),new cr(pt(l),0)}if(a.ok||await ts(a),r?.noResolveJson)return a;try{return await a.json()}catch(l){await ts(l)}}function He(e){var t;let i=null;Fo(e)&&(i=Object.assign({},e),e.expires_at||(i.expires_at=To(e.expires_in)));const r=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:i,user:r},error:null}}function is(e){const t=He(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((i,r)=>i&&typeof r=="string",!0)&&(t.data.weak_password=e.weak_password),t}function qe(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function Ro(e){return{data:e,error:null}}function Uo(e){const{action_link:t,email_otp:i,hashed_token:r,redirect_to:s,verification_type:n}=e,o=Co(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:t,email_otp:i,hashed_token:r,redirect_to:s,verification_type:n},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function Mo(e){return e}function Fo(e){return e.access_token&&e.refresh_token&&e.expires_in}var Bo=function(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(i[r[s]]=e[r[s]]);return i};class Zo{constructor({url:t="",headers:i={},fetch:r}){this.url=t,this.headers=i,this.fetch=Cs(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(t,i="global"){try{return await I(this.fetch,"POST",`${this.url}/logout?scope=${i}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(r){if(D(r))return{data:null,error:r};throw r}}async inviteUserByEmail(t,i={}){try{return await I(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:i.data},headers:this.headers,redirectTo:i.redirectTo,xform:qe})}catch(r){if(D(r))return{data:{user:null},error:r};throw r}}async generateLink(t){try{const{options:i}=t,r=Bo(t,["options"]),s=Object.assign(Object.assign({},r),i);return"newEmail"in r&&(s.new_email=r?.newEmail,delete s.newEmail),await I(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Uo,redirectTo:i?.redirectTo})}catch(i){if(D(i))return{data:{properties:null,user:null},error:i};throw i}}async createUser(t){try{return await I(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:qe})}catch(i){if(D(i))return{data:{user:null},error:i};throw i}}async listUsers(t){var i,r,s,n,o,a,l;try{const u={nextPage:null,lastPage:0,total:0},c=await I(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(i=t?.page)===null||i===void 0?void 0:i.toString())!==null&&r!==void 0?r:"",per_page:(n=(s=t?.perPage)===null||s===void 0?void 0:s.toString())!==null&&n!==void 0?n:""},xform:Mo});if(c.error)throw c.error;const h=await c.json(),d=(o=c.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(l=(a=c.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(w=>{const v=parseInt(w.split(";")[0].split("=")[1].substring(0,1)),f=JSON.parse(w.split(";")[1].split("=")[1]);u[`${f}Page`]=v}),u.total=parseInt(d)),{data:Object.assign(Object.assign({},h),u),error:null}}catch(u){if(D(u))return{data:{users:[]},error:u};throw u}}async getUserById(t){try{return await I(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:qe})}catch(i){if(D(i))return{data:{user:null},error:i};throw i}}async updateUserById(t,i){try{return await I(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:i,headers:this.headers,xform:qe})}catch(r){if(D(r))return{data:{user:null},error:r};throw r}}async deleteUser(t,i=!1){try{return await I(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:i},xform:qe})}catch(r){if(D(r))return{data:{user:null},error:r};throw r}}async _listFactors(t){try{const{data:i,error:r}=await I(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:i,error:r}}catch(i){if(D(i))return{data:null,error:i};throw i}}async _deleteFactor(t){try{return{data:await I(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(i){if(D(i))return{data:null,error:i};throw i}}}const Is="2.62.0",Ho="http://localhost:9999",Jo="supabase.auth.token",zo={"X-Client-Info":`gotrue-js/${Is}`},rs=10,Go={getItem:e=>It()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{It()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{It()&&globalThis.localStorage.removeItem(e)}};function ss(e={}){return{getItem:t=>e[t]||null,setItem:(t,i)=>{e[t]=i},removeItem:t=>{delete e[t]}}}function Vo(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const ht={debug:!!(globalThis&&It()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class qs extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class Ko extends qs{}async function Qo(e,t,i){ht.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),ht.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){ht.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,s.name);try{return await i()}finally{ht.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,s.name)}}else{if(t===0)throw ht.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Ko(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(ht.debug)try{const n=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await i()}})}Vo();const Wo={url:Ho,storageKey:Jo,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:zo,flowType:"implicit",debug:!1},Lt=30*1e3,ns=3;async function os(e,t,i){return await i()}class qt{constructor(t){var i,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=qt.nextInstanceID,qt.nextInstanceID+=1,this.instanceID>0&&ye()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},Wo),t);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new Zo({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=Cs(s.fetch),this.lock=s.lock||os,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,s.lock?this.lock=s.lock:ye()&&(!((i=globalThis?.navigator)===null||i===void 0)&&i.locks)?this.lock=Qo:this.lock=os,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:It()?this.storage=Go:(this.memoryStorage={},this.storage=ss(this.memoryStorage)):(this.memoryStorage={},this.storage=ss(this.memoryStorage)),ye()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async n=>{this._debug("received broadcast notification from other tab or client",n),await this._notifyAllSubscribers(n.data.event,n.data.session,!1)})}this.initialize()}_debug(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Is}) ${new Date().toISOString()}`,...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){try{const t=ye()?await this._isPKCEFlow():!1;if(this._debug("#_initialize()","begin","is PKCE flow",t),t||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:i,error:r}=await this._getSessionFromURL(t);if(r)return this._debug("#_initialize()","error detecting session from URL",r),r?.message==="Identity is already linked"||r?.message==="Identity is already linked to another user"?{error:r}:(await this._removeSession(),{error:r});const{session:s,redirectType:n}=i;return this._debug("#_initialize()","detected session in URL",s,"redirect type",n),await this._saveSession(s),setTimeout(async()=>{n==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return D(t)?{error:t}:{error:new Ds("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signUp(t){var i,r,s;try{await this._removeSession();let n;if("email"in t){const{email:c,password:h,options:d}=t;let p=null,w=null;if(this.flowType==="pkce"){const v=lt();await Ze(this.storage,`${this.storageKey}-code-verifier`,v),p=await ut(v),w=v===p?"plain":"s256"}n=await I(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:d?.emailRedirectTo,body:{email:c,password:h,data:(i=d?.data)!==null&&i!==void 0?i:{},gotrue_meta_security:{captcha_token:d?.captchaToken},code_challenge:p,code_challenge_method:w},xform:He})}else if("phone"in t){const{phone:c,password:h,options:d}=t;n=await I(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:c,password:h,data:(r=d?.data)!==null&&r!==void 0?r:{},channel:(s=d?.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:d?.captchaToken}},xform:He})}else throw new Qt("You must provide either an email or phone number and a password");const{data:o,error:a}=n;if(a||!o)return{data:{user:null,session:null},error:a};const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(n){if(D(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(t){try{await this._removeSession();let i;if("email"in t){const{email:n,password:o,options:a}=t;i=await I(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:is})}else if("phone"in t){const{phone:n,password:o,options:a}=t;i=await I(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:o,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:is})}else throw new Qt("You must provide either an email or phone number and a password");const{data:r,error:s}=i;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new er}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(i){if(D(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithOAuth(t){var i,r,s,n;return await this._removeSession(),await this._handleProviderSignIn(t.provider,{redirectTo:(i=t.options)===null||i===void 0?void 0:i.redirectTo,scopes:(r=t.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=t.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(n=t.options)===null||n===void 0?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async _exchangeCodeForSession(t){const i=await Kt(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(i??"").split("/"),{data:n,error:o}=await I(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:r},xform:He});return await Xi(this.storage,`${this.storageKey}-code-verifier`),o?{data:{user:null,session:null,redirectType:null},error:o}:!n||!n.session||!n.user?{data:{user:null,session:null,redirectType:null},error:new er}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign(Object.assign({},n),{redirectType:s??null}),error:o})}async signInWithIdToken(t){await this._removeSession();try{const{options:i,provider:r,token:s,access_token:n,nonce:o}=t,a=await I(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:n,nonce:o,gotrue_meta_security:{captcha_token:i?.captchaToken}},xform:He}),{data:l,error:u}=a;return u?{data:{user:null,session:null},error:u}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new er}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:u})}catch(i){if(D(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithOtp(t){var i,r,s,n,o;try{if(await this._removeSession(),"email"in t){const{email:a,options:l}=t;let u=null,c=null;if(this.flowType==="pkce"){const d=lt();await Ze(this.storage,`${this.storageKey}-code-verifier`,d),u=await ut(d),c=d===u?"plain":"s256"}const{error:h}=await I(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(i=l?.data)!==null&&i!==void 0?i:{},create_user:(r=l?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:u,code_challenge_method:c},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in t){const{phone:a,options:l}=t,{data:u,error:c}=await I(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=l?.data)!==null&&s!==void 0?s:{},create_user:(n=l?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(o=l?.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:u?.message_id},error:c}}throw new Qt("You must provide either an email or phone number.")}catch(a){if(D(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(t){var i,r;try{t.type!=="email_change"&&t.type!=="phone_change"&&await this._removeSession();let s,n;"options"in t&&(s=(i=t.options)===null||i===void 0?void 0:i.redirectTo,n=(r=t.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:a}=await I(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:n}}),redirectTo:s,xform:He});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,u=o.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(s){if(D(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(t){var i,r,s;try{await this._removeSession();let n=null,o=null;if(this.flowType==="pkce"){const a=lt();await Ze(this.storage,`${this.storageKey}-code-verifier`,a),n=await ut(a),o=a===n?"plain":"s256"}return await I(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(r=(i=t.options)===null||i===void 0?void 0:i.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=t?.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:o}),headers:this.headers,xform:Ro})}catch(n){if(D(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:i},error:r}=t;if(r)throw r;if(!i)throw new ct;const{error:s}=await I(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:i.access_token});return{data:{user:null,session:null},error:s}})}catch(t){if(D(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{t.type!="email_change"&&t.type!="phone_change"&&await this._removeSession();const i=`${this.url}/resend`;if("email"in t){const{email:r,type:s,options:n}=t,{error:o}=await I(this.fetch,"POST",i,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:n?.captchaToken}},redirectTo:n?.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in t){const{phone:r,type:s,options:n}=t,{data:o,error:a}=await I(this.fetch,"POST",i,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:n?.captchaToken}}});return{data:{user:null,session:null,messageId:o?.message_id},error:a}}throw new Qt("You must provide either an email or phone number and a type")}catch(i){if(D(i))return{data:{user:null,session:null},error:i};throw i}}async getSession(){return await this.initializePromise,this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(t,i){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await i()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=i();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const i=await this.__loadSession();return await t(i)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const i=await Kt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",i),i!==null&&(this._isValidSession(i)?t=i:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const r=t.expires_at?t.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",t.expires_at),!r)return{data:{session:t},error:null};const{session:s,error:n}=await this._callRefreshToken(t.refresh_token);return n?{data:{session:null},error:n}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await I(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:qe}):await this._useSession(async i=>{var r,s;const{data:n,error:o}=i;if(o)throw o;return await I(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(r=n.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0,xform:qe})})}catch(i){if(D(i))return{data:{user:null},error:i};throw i}}async updateUser(t,i={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,i))}async _updateUser(t,i={}){try{return await this._useSession(async r=>{const{data:s,error:n}=r;if(n)throw n;if(!s.session)throw new ct;const o=s.session;let a=null,l=null;if(this.flowType==="pkce"&&t.email!=null){const h=lt();await Ze(this.storage,`${this.storageKey}-code-verifier`,h),a=await ut(h),l=h===a?"plain":"s256"}const{data:u,error:c}=await I(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:i?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:qe});if(c)throw c;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if(D(r))return{data:{user:null},error:r};throw r}}_decodeJWT(t){return Xr(t)}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new ct;const i=Date.now()/1e3;let r=i,s=!0,n=null;const o=Xr(t.access_token);if(o.exp&&(r=o.exp,s=r<=i),s){const{session:a,error:l}=await this._callRefreshToken(t.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};n=a}else{const{data:a,error:l}=await this._getUser(t.access_token);if(l)throw l;n={access_token:t.access_token,refresh_token:t.refresh_token,user:a.user,token_type:"bearer",expires_in:r-i,expires_at:r},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(i){if(D(i))return{data:{session:null,user:null},error:i};throw i}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async i=>{var r;if(!t){const{data:o,error:a}=i;if(a)throw a;t=(r=o.session)!==null&&r!==void 0?r:void 0}if(!t?.refresh_token)throw new ct;const{session:s,error:n}=await this._callRefreshToken(t.refresh_token);return n?{data:{user:null,session:null},error:n}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(i){if(D(i))return{data:{user:null,session:null},error:i};throw i}}async _getSessionFromURL(t){try{if(!ye())throw new Wt("No browser detected.");if(this.flowType==="implicit"&&!this._isImplicitGrantFlow())throw new Wt("Not a valid implicit grant flow url.");if(this.flowType=="pkce"&&!t)throw new es("Not a valid PKCE flow url.");const i=Yi(window.location.href);if(t){if(!i.code)throw new es("No code detected.");const{data:k,error:x}=await this._exchangeCodeForSession(i.code);if(x)throw x;const P=new URL(window.location.href);return P.searchParams.delete("code"),window.history.replaceState(window.history.state,"",P.toString()),{data:{session:k.session,redirectType:null},error:null}}if(i.error||i.error_description||i.error_code)throw new Wt(i.error_description||"Error in URL with unspecified error_description",{error:i.error||"unspecified_error",code:i.error_code||"unspecified_code"});const{provider_token:r,provider_refresh_token:s,access_token:n,refresh_token:o,expires_in:a,expires_at:l,token_type:u}=i;if(!n||!a||!o||!u)throw new Wt("No session defined in URL");const c=Math.round(Date.now()/1e3),h=parseInt(a);let d=c+h;l&&(d=parseInt(l));const p=d-c;p*1e3<=Lt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${h}s`);const w=d-h;c-w>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",w,d,c):c-w<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",w,d,c);const{data:v,error:f}=await this._getUser(n);if(f)throw f;const g={provider_token:r,provider_refresh_token:s,access_token:n,expires_in:h,expires_at:d,refresh_token:o,token_type:u,user:v.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:g,redirectType:i.type},error:null}}catch(i){if(D(i))return{data:{session:null,redirectType:null},error:i};throw i}}_isImplicitGrantFlow(){const t=Yi(window.location.href);return!!(ye()&&(t.access_token||t.error_description))}async _isPKCEFlow(){const t=Yi(window.location.href),i=await Kt(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&i)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async i=>{var r;const{data:s,error:n}=i;if(n)return{error:n};const o=(r=s.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:a}=await this.admin.signOut(o,t);if(a&&!(jo(a)&&(a.status===404||a.status===401)))return{error:a}}return t!=="others"&&(await this._removeSession(),await Xi(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(t){const i=ko(),r={id:i,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",i),this.stateChangeEmitters.delete(i)}};return this._debug("#onAuthStateChange()","registered callback with id",i),this.stateChangeEmitters.set(i,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(i)})))(),{data:{subscription:r}}}async _emitInitialSession(t){return await this._useSession(async i=>{var r,s;try{const{data:{session:n},error:o}=i;if(o)throw o;await((r=this.stateChangeEmitters.get(t))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",t,"session",n)}catch(n){await((s=this.stateChangeEmitters.get(t))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",n),console.error(n)}})}async resetPasswordForEmail(t,i={}){let r=null,s=null;if(this.flowType==="pkce"){const n=lt();await Ze(this.storage,`${this.storageKey}-code-verifier`,`${n}/PASSWORD_RECOVERY`),r=await ut(n),s=n===r?"plain":"s256"}try{return await I(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:i.captchaToken}},headers:this.headers,redirectTo:i.redirectTo})}catch(n){if(D(n))return{data:null,error:n};throw n}}async getUserIdentities(){var t;try{const{data:i,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(t=i.user.identities)!==null&&t!==void 0?t:[]},error:null}}catch(i){if(D(i))return{data:null,error:i};throw i}}async linkIdentity(t){var i;try{const{data:r,error:s}=await this._useSession(async n=>{var o,a,l,u,c;const{data:h,error:d}=n;if(d)throw d;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(o=t.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=t.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=t.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await I(this.fetch,"GET",p,{headers:this.headers,jwt:(c=(u=h.session)===null||u===void 0?void 0:u.access_token)!==null&&c!==void 0?c:void 0})});if(s)throw s;return ye()&&!(!((i=t.options)===null||i===void 0)&&i.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:t.provider,url:r?.url},error:null}}catch(r){if(D(r))return{data:{provider:t.provider,url:null},error:r};throw r}}async unlinkIdentity(t){try{return await this._useSession(async i=>{var r,s;const{data:n,error:o}=i;if(o)throw o;return await I(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(s=(r=n.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(i){if(D(i))return{data:null,error:i};throw i}}async _refreshAccessToken(t){const i=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(i,"begin");try{const r=Date.now();return await xo(async s=>(await Oo(s*200),this._debug(i,"refreshing attempt",s),await I(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:He})),(s,n,o)=>o&&o.error&&tr(o.error)&&Date.now()+(s+1)*200-r<Lt)}catch(r){if(this._debug(i,"error",r),D(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(i,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,i){const r=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:i.redirectTo,scopes:i.scopes,queryParams:i.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",i,"url",r),ye()&&!i.skipBrowserRedirect&&window.location.assign(r),{data:{provider:t,url:r},error:null}}async _recoverAndRefresh(){var t;const i="#_recoverAndRefresh()";this._debug(i,"begin");try{const r=await Kt(this.storage,this.storageKey);if(this._debug(i,"session from storage",r),!this._isValidSession(r)){this._debug(i,"session is not valid"),r!==null&&await this._removeSession();return}const s=Math.round(Date.now()/1e3),n=((t=r.expires_at)!==null&&t!==void 0?t:1/0)<s+rs;if(this._debug(i,`session has${n?"":" not"} expired with margin of ${rs}s`),n){if(this.autoRefreshToken&&r.refresh_token){const{error:o}=await this._callRefreshToken(r.refresh_token);o&&(console.error(o),tr(o)||(this._debug(i,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){this._debug(i,"error",r),console.error(r);return}finally{this._debug(i,"end")}}async _callRefreshToken(t){var i,r;if(!t)throw new ct;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new oi;const{data:n,error:o}=await this._refreshAccessToken(t);if(o)throw o;if(!n.session)throw new ct;await this._saveSession(n.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);const a={session:n.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(n){if(this._debug(s,"error",n),D(n)){const o={session:null,error:n};return tr(n)||(await this._removeSession(),await this._notifyAllSubscribers("SIGNED_OUT",null)),(i=this.refreshingDeferred)===null||i===void 0||i.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(n),n}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(t,i,r=!0){const s=`#_notifyAllSubscribers(${t})`;this._debug(s,"begin",i,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:t,session:i});const n=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(t,i)}catch(l){n.push(l)}});if(await Promise.all(o),n.length>0){for(let a=0;a<n.length;a+=1)console.error(n[a]);throw n[0]}}finally{this._debug(s,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),await Ze(this.storage,this.storageKey,t)}async _removeSession(){this._debug("#_removeSession()"),await Xi(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&ye()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(i){console.error("removing visibilitychange callback failed",i)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),Lt);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async i=>{const{data:{session:r}}=i;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-t)/Lt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Lt}ms, refresh threshold is ${ns} ticks`),s<=ns&&await this._callRefreshToken(r.refresh_token)})}catch(i){console.error("Auto refresh tick failed with error. This is likely a transient error.",i)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof qs)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ye()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const i=`#_onVisibilityChanged(${t})`;this._debug(i,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(i,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,i,r){const s=[`provider=${encodeURIComponent(i)}`];if(r?.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const n=lt();await Ze(this.storage,`${this.storageKey}-code-verifier`,n);const o=await ut(n),a=n===o?"plain":"s256";this._debug("PKCE","code verifier",`${n.substring(0,5)}...`,"code challenge",o,"method",a);const l=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(a)}`});s.push(l.toString())}if(r?.queryParams){const n=new URLSearchParams(r.queryParams);s.push(n.toString())}return r?.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${t}?${s.join("&")}`}async _unenroll(t){try{return await this._useSession(async i=>{var r;const{data:s,error:n}=i;return n?{data:null,error:n}:await I(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token})})}catch(i){if(D(i))return{data:null,error:i};throw i}}async _enroll(t){try{return await this._useSession(async i=>{var r,s;const{data:n,error:o}=i;if(o)return{data:null,error:o};const{data:a,error:l}=await I(this.fetch,"POST",`${this.url}/factors`,{body:{friendly_name:t.friendlyName,factor_type:t.factorType,issuer:t.issuer},headers:this.headers,jwt:(r=n?.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(!((s=a?.totp)===null||s===void 0)&&s.qr_code&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})})}catch(i){if(D(i))return{data:null,error:i};throw i}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var r;const{data:s,error:n}=i;if(n)return{data:null,error:n};const{data:o,error:a}=await I(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(i){if(D(i))return{data:null,error:i};throw i}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async i=>{var r;const{data:s,error:n}=i;return n?{data:null,error:n}:await I(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token})})}catch(i){if(D(i))return{data:null,error:i};throw i}})}async _challengeAndVerify(t){const{data:i,error:r}=await this._challenge({factorId:t.factorId});return r?{data:null,error:r}:await this._verify({factorId:t.factorId,challengeId:i.id,code:t.code})}async _listFactors(){const{data:{user:t},error:i}=await this.getUser();if(i)return{data:null,error:i};const r=t?.factors||[],s=r.filter(n=>n.factor_type==="totp"&&n.status==="verified");return{data:{all:r,totp:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async t=>{var i,r;const{data:{session:s},error:n}=t;if(n)return{data:null,error:n};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const o=this._decodeJWT(s.access_token);let a=null;o.aal&&(a=o.aal);let l=a;((r=(i=s.user.factors)===null||i===void 0?void 0:i.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");const c=o.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:c},error:null}}))}}qt.nextInstanceID=0;class Yo extends qt{constructor(t){super(t)}}var Xo=function(e,t,i,r){function s(n){return n instanceof i?n:new i(function(o){o(n)})}return new(i||(i=Promise))(function(n,o){function a(c){try{u(r.next(c))}catch(h){o(h)}}function l(c){try{u(r.throw(c))}catch(h){o(h)}}function u(c){c.done?n(c.value):s(c.value).then(a,l)}u((r=r.apply(e,t||[])).next())})};const ea={headers:mo},ta={schema:"public"},ia={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ra={};class sa{constructor(t,i,r){var s,n,o,a,l,u,c,h;if(this.supabaseUrl=t,this.supabaseKey=i,!t)throw new Error("supabaseUrl is required.");if(!i)throw new Error("supabaseKey is required.");const d=_o(t);this.realtimeUrl=`${d}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${d}/auth/v1`,this.storageUrl=`${d}/storage/v1`,this.functionsUrl=`${d}/functions/v1`;const p=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,w={db:ta,realtime:ra,auth:Object.assign(Object.assign({},ia),{storageKey:p}),global:ea},v=bo(r??{},w);this.storageKey=(n=(s=v.auth)===null||s===void 0?void 0:s.storageKey)!==null&&n!==void 0?n:"",this.headers=(a=(o=v.global)===null||o===void 0?void 0:o.headers)!==null&&a!==void 0?a:{},this.auth=this._initSupabaseAuthClient((l=v.auth)!==null&&l!==void 0?l:{},this.headers,(u=v.global)===null||u===void 0?void 0:u.fetch),this.fetch=yo(i,this._getAccessToken.bind(this),(c=v.global)===null||c===void 0?void 0:c.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},v.realtime)),this.rest=new Tr(`${d}/rest/v1`,{headers:this.headers,schema:(h=v.db)===null||h===void 0?void 0:h.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new An(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new fo(this.storageUrl,this.headers,this.fetch)}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,i={},r){return this.rest.rpc(t,i,r)}channel(t,i={config:{}}){return this.realtime.channel(t,i)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var t,i;return Xo(this,void 0,void 0,function*(){const{data:r}=yield this.auth.getSession();return(i=(t=r.session)===null||t===void 0?void 0:t.access_token)!==null&&i!==void 0?i:null})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:i,detectSessionInUrl:r,storage:s,storageKey:n,flowType:o,debug:a},l,u){const c={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Yo({url:this.authUrl,headers:Object.assign(Object.assign({},c),l),storageKey:n,autoRefreshToken:t,persistSession:i,detectSessionInUrl:r,storage:s,flowType:o,debug:a,fetch:u})}_initRealtimeClient(t){return new Xn(this.realtimeUrl,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((i,r)=>{this._handleTokenChanged(i,"CLIENT",r?.access_token)})}_handleTokenChanged(t,i,r){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==r?(this.realtime.setAuth(r??null),this.changedAccessToken=r):t==="SIGNED_OUT"&&(this.realtime.setAuth(this.supabaseKey),i=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const na=(e,t,i)=>new sa(e,t,i);/*!
 *  decimal.js v10.4.3
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2022 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */var gt=9e15,Me=1e9,hr="0123456789abcdef",ti="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",ii="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",dr={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-gt,maxE:gt,crypto:!1},Rs,Le,A=!0,ai="[DecimalError] ",Ue=ai+"Invalid argument: ",Us=ai+"Precision limit exceeded",Ms=ai+"crypto unavailable",Fs="[object Decimal]",oe=Math.floor,Y=Math.pow,oa=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,aa=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,la=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Bs=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,ke=1e7,$=7,ua=9007199254740991,ca=ti.length-1,fr=ii.length-1,m={toStringTag:Fs};m.absoluteValue=m.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),O(e)};m.ceil=function(){return O(new this.constructor(this),this.e+1,2)};m.clampedTo=m.clamp=function(e,t){var i,r=this,s=r.constructor;if(e=new s(e),t=new s(t),!e.s||!t.s)return new s(NaN);if(e.gt(t))throw Error(Ue+t);return i=r.cmp(e),i<0?e:r.cmp(t)>0?t:new s(r)};m.comparedTo=m.cmp=function(e){var t,i,r,s,n=this,o=n.d,a=(e=new n.constructor(e)).d,l=n.s,u=e.s;if(!o||!a)return!l||!u?NaN:l!==u?l:o===a?0:!o^l<0?1:-1;if(!o[0]||!a[0])return o[0]?l:a[0]?-u:0;if(l!==u)return l;if(n.e!==e.e)return n.e>e.e^l<0?1:-1;for(r=o.length,s=a.length,t=0,i=r<s?r:s;t<i;++t)if(o[t]!==a[t])return o[t]>a[t]^l<0?1:-1;return r===s?0:r>s^l<0?1:-1};m.cosine=m.cos=function(){var e,t,i=this,r=i.constructor;return i.d?i.d[0]?(e=r.precision,t=r.rounding,r.precision=e+Math.max(i.e,i.sd())+$,r.rounding=1,i=ha(r,Gs(r,i)),r.precision=e,r.rounding=t,O(Le==2||Le==3?i.neg():i,e,t,!0)):new r(1):new r(NaN)};m.cubeRoot=m.cbrt=function(){var e,t,i,r,s,n,o,a,l,u,c=this,h=c.constructor;if(!c.isFinite()||c.isZero())return new h(c);for(A=!1,n=c.s*Y(c.s*c,1/3),!n||Math.abs(n)==1/0?(i=re(c.d),e=c.e,(n=(e-i.length+1)%3)&&(i+=n==1||n==-2?"0":"00"),n=Y(i,1/3),e=oe((e+1)/3)-(e%3==(e<0?-1:2)),n==1/0?i="5e"+e:(i=n.toExponential(),i=i.slice(0,i.indexOf("e")+1)+e),r=new h(i),r.s=c.s):r=new h(n.toString()),o=(e=h.precision)+3;;)if(a=r,l=a.times(a).times(a),u=l.plus(c),r=F(u.plus(c).times(a),u.plus(l),o+2,1),re(a.d).slice(0,o)===(i=re(r.d)).slice(0,o))if(i=i.slice(o-3,o+1),i=="9999"||!s&&i=="4999"){if(!s&&(O(a,e+1,0),a.times(a).times(a).eq(c))){r=a;break}o+=4,s=1}else{(!+i||!+i.slice(1)&&i.charAt(0)=="5")&&(O(r,e+1,1),t=!r.times(r).times(r).eq(c));break}return A=!0,O(r,e,h.rounding,t)};m.decimalPlaces=m.dp=function(){var e,t=this.d,i=NaN;if(t){if(e=t.length-1,i=(e-oe(this.e/$))*$,e=t[e],e)for(;e%10==0;e/=10)i--;i<0&&(i=0)}return i};m.dividedBy=m.div=function(e){return F(this,new this.constructor(e))};m.dividedToIntegerBy=m.divToInt=function(e){var t=this,i=t.constructor;return O(F(t,new i(e),0,1,1),i.precision,i.rounding)};m.equals=m.eq=function(e){return this.cmp(e)===0};m.floor=function(){return O(new this.constructor(this),this.e+1,3)};m.greaterThan=m.gt=function(e){return this.cmp(e)>0};m.greaterThanOrEqualTo=m.gte=function(e){var t=this.cmp(e);return t==1||t===0};m.hyperbolicCosine=m.cosh=function(){var e,t,i,r,s,n=this,o=n.constructor,a=new o(1);if(!n.isFinite())return new o(n.s?1/0:NaN);if(n.isZero())return a;i=o.precision,r=o.rounding,o.precision=i+Math.max(n.e,n.sd())+4,o.rounding=1,s=n.d.length,s<32?(e=Math.ceil(s/3),t=(1/ui(4,e)).toString()):(e=16,t="2.3283064365386962890625e-10"),n=kt(o,1,n.times(t),new o(1),!0);for(var l,u=e,c=new o(8);u--;)l=n.times(n),n=a.minus(l.times(c.minus(l.times(c))));return O(n,o.precision=i,o.rounding=r,!0)};m.hyperbolicSine=m.sinh=function(){var e,t,i,r,s=this,n=s.constructor;if(!s.isFinite()||s.isZero())return new n(s);if(t=n.precision,i=n.rounding,n.precision=t+Math.max(s.e,s.sd())+4,n.rounding=1,r=s.d.length,r<3)s=kt(n,2,s,s,!0);else{e=1.4*Math.sqrt(r),e=e>16?16:e|0,s=s.times(1/ui(5,e)),s=kt(n,2,s,s,!0);for(var o,a=new n(5),l=new n(16),u=new n(20);e--;)o=s.times(s),s=s.times(a.plus(o.times(l.times(o).plus(u))))}return n.precision=t,n.rounding=i,O(s,t,i,!0)};m.hyperbolicTangent=m.tanh=function(){var e,t,i=this,r=i.constructor;return i.isFinite()?i.isZero()?new r(i):(e=r.precision,t=r.rounding,r.precision=e+7,r.rounding=1,F(i.sinh(),i.cosh(),r.precision=e,r.rounding=t)):new r(i.s)};m.inverseCosine=m.acos=function(){var e,t=this,i=t.constructor,r=t.abs().cmp(1),s=i.precision,n=i.rounding;return r!==-1?r===0?t.isNeg()?Te(i,s,n):new i(0):new i(NaN):t.isZero()?Te(i,s+4,n).times(.5):(i.precision=s+6,i.rounding=1,t=t.asin(),e=Te(i,s+4,n).times(.5),i.precision=s,i.rounding=n,e.minus(t))};m.inverseHyperbolicCosine=m.acosh=function(){var e,t,i=this,r=i.constructor;return i.lte(1)?new r(i.eq(1)?0:NaN):i.isFinite()?(e=r.precision,t=r.rounding,r.precision=e+Math.max(Math.abs(i.e),i.sd())+4,r.rounding=1,A=!1,i=i.times(i).minus(1).sqrt().plus(i),A=!0,r.precision=e,r.rounding=t,i.ln()):new r(i)};m.inverseHyperbolicSine=m.asinh=function(){var e,t,i=this,r=i.constructor;return!i.isFinite()||i.isZero()?new r(i):(e=r.precision,t=r.rounding,r.precision=e+2*Math.max(Math.abs(i.e),i.sd())+6,r.rounding=1,A=!1,i=i.times(i).plus(1).sqrt().plus(i),A=!0,r.precision=e,r.rounding=t,i.ln())};m.inverseHyperbolicTangent=m.atanh=function(){var e,t,i,r,s=this,n=s.constructor;return s.isFinite()?s.e>=0?new n(s.abs().eq(1)?s.s/0:s.isZero()?s:NaN):(e=n.precision,t=n.rounding,r=s.sd(),Math.max(r,e)<2*-s.e-1?O(new n(s),e,t,!0):(n.precision=i=r-s.e,s=F(s.plus(1),new n(1).minus(s),i+e,1),n.precision=e+4,n.rounding=1,s=s.ln(),n.precision=e,n.rounding=t,s.times(.5))):new n(NaN)};m.inverseSine=m.asin=function(){var e,t,i,r,s=this,n=s.constructor;return s.isZero()?new n(s):(t=s.abs().cmp(1),i=n.precision,r=n.rounding,t!==-1?t===0?(e=Te(n,i+4,r).times(.5),e.s=s.s,e):new n(NaN):(n.precision=i+6,n.rounding=1,s=s.div(new n(1).minus(s.times(s)).sqrt().plus(1)).atan(),n.precision=i,n.rounding=r,s.times(2)))};m.inverseTangent=m.atan=function(){var e,t,i,r,s,n,o,a,l,u=this,c=u.constructor,h=c.precision,d=c.rounding;if(u.isFinite()){if(u.isZero())return new c(u);if(u.abs().eq(1)&&h+4<=fr)return o=Te(c,h+4,d).times(.25),o.s=u.s,o}else{if(!u.s)return new c(NaN);if(h+4<=fr)return o=Te(c,h+4,d).times(.5),o.s=u.s,o}for(c.precision=a=h+10,c.rounding=1,i=Math.min(28,a/$+2|0),e=i;e;--e)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(A=!1,t=Math.ceil(a/$),r=1,l=u.times(u),o=new c(u),s=u;e!==-1;)if(s=s.times(l),n=o.minus(s.div(r+=2)),s=s.times(l),o=n.plus(s.div(r+=2)),o.d[t]!==void 0)for(e=t;o.d[e]===n.d[e]&&e--;);return i&&(o=o.times(2<<i-1)),A=!0,O(o,c.precision=h,c.rounding=d,!0)};m.isFinite=function(){return!!this.d};m.isInteger=m.isInt=function(){return!!this.d&&oe(this.e/$)>this.d.length-2};m.isNaN=function(){return!this.s};m.isNegative=m.isNeg=function(){return this.s<0};m.isPositive=m.isPos=function(){return this.s>0};m.isZero=function(){return!!this.d&&this.d[0]===0};m.lessThan=m.lt=function(e){return this.cmp(e)<0};m.lessThanOrEqualTo=m.lte=function(e){return this.cmp(e)<1};m.logarithm=m.log=function(e){var t,i,r,s,n,o,a,l,u=this,c=u.constructor,h=c.precision,d=c.rounding,p=5;if(e==null)e=new c(10),t=!0;else{if(e=new c(e),i=e.d,e.s<0||!i||!i[0]||e.eq(1))return new c(NaN);t=e.eq(10)}if(i=u.d,u.s<0||!i||!i[0]||u.eq(1))return new c(i&&!i[0]?-1/0:u.s!=1?NaN:i?0:1/0);if(t)if(i.length>1)n=!0;else{for(s=i[0];s%10===0;)s/=10;n=s!==1}if(A=!1,a=h+p,o=Re(u,a),r=t?ri(c,a+10):Re(e,a),l=F(o,r,a,1),Rt(l.d,s=h,d))do if(a+=10,o=Re(u,a),r=t?ri(c,a+10):Re(e,a),l=F(o,r,a,1),!n){+re(l.d).slice(s+1,s+15)+1==1e14&&(l=O(l,h+1,0));break}while(Rt(l.d,s+=10,d));return A=!0,O(l,h,d)};m.minus=m.sub=function(e){var t,i,r,s,n,o,a,l,u,c,h,d,p=this,w=p.constructor;if(e=new w(e),!p.d||!e.d)return!p.s||!e.s?e=new w(NaN):p.d?e.s=-e.s:e=new w(e.d||p.s!==e.s?p:NaN),e;if(p.s!=e.s)return e.s=-e.s,p.plus(e);if(u=p.d,d=e.d,a=w.precision,l=w.rounding,!u[0]||!d[0]){if(d[0])e.s=-e.s;else if(u[0])e=new w(p);else return new w(l===3?-0:0);return A?O(e,a,l):e}if(i=oe(e.e/$),c=oe(p.e/$),u=u.slice(),n=c-i,n){for(h=n<0,h?(t=u,n=-n,o=d.length):(t=d,i=c,o=u.length),r=Math.max(Math.ceil(a/$),o)+2,n>r&&(n=r,t.length=1),t.reverse(),r=n;r--;)t.push(0);t.reverse()}else{for(r=u.length,o=d.length,h=r<o,h&&(o=r),r=0;r<o;r++)if(u[r]!=d[r]){h=u[r]<d[r];break}n=0}for(h&&(t=u,u=d,d=t,e.s=-e.s),o=u.length,r=d.length-o;r>0;--r)u[o++]=0;for(r=d.length;r>n;){if(u[--r]<d[r]){for(s=r;s&&u[--s]===0;)u[s]=ke-1;--u[s],u[r]+=ke}u[r]-=d[r]}for(;u[--o]===0;)u.pop();for(;u[0]===0;u.shift())--i;return u[0]?(e.d=u,e.e=li(u,i),A?O(e,a,l):e):new w(l===3?-0:0)};m.modulo=m.mod=function(e){var t,i=this,r=i.constructor;return e=new r(e),!i.d||!e.s||e.d&&!e.d[0]?new r(NaN):!e.d||i.d&&!i.d[0]?O(new r(i),r.precision,r.rounding):(A=!1,r.modulo==9?(t=F(i,e.abs(),0,3,1),t.s*=e.s):t=F(i,e,0,r.modulo,1),t=t.times(e),A=!0,i.minus(t))};m.naturalExponential=m.exp=function(){return pr(this)};m.naturalLogarithm=m.ln=function(){return Re(this)};m.negated=m.neg=function(){var e=new this.constructor(this);return e.s=-e.s,O(e)};m.plus=m.add=function(e){var t,i,r,s,n,o,a,l,u,c,h=this,d=h.constructor;if(e=new d(e),!h.d||!e.d)return!h.s||!e.s?e=new d(NaN):h.d||(e=new d(e.d||h.s===e.s?h:NaN)),e;if(h.s!=e.s)return e.s=-e.s,h.minus(e);if(u=h.d,c=e.d,a=d.precision,l=d.rounding,!u[0]||!c[0])return c[0]||(e=new d(h)),A?O(e,a,l):e;if(n=oe(h.e/$),r=oe(e.e/$),u=u.slice(),s=n-r,s){for(s<0?(i=u,s=-s,o=c.length):(i=c,r=n,o=u.length),n=Math.ceil(a/$),o=n>o?n+1:o+1,s>o&&(s=o,i.length=1),i.reverse();s--;)i.push(0);i.reverse()}for(o=u.length,s=c.length,o-s<0&&(s=o,i=c,c=u,u=i),t=0;s;)t=(u[--s]=u[s]+c[s]+t)/ke|0,u[s]%=ke;for(t&&(u.unshift(t),++r),o=u.length;u[--o]==0;)u.pop();return e.d=u,e.e=li(u,r),A?O(e,a,l):e};m.precision=m.sd=function(e){var t,i=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Ue+e);return i.d?(t=Zs(i.d),e&&i.e+1>t&&(t=i.e+1)):t=NaN,t};m.round=function(){var e=this,t=e.constructor;return O(new t(e),e.e+1,t.rounding)};m.sine=m.sin=function(){var e,t,i=this,r=i.constructor;return i.isFinite()?i.isZero()?new r(i):(e=r.precision,t=r.rounding,r.precision=e+Math.max(i.e,i.sd())+$,r.rounding=1,i=fa(r,Gs(r,i)),r.precision=e,r.rounding=t,O(Le>2?i.neg():i,e,t,!0)):new r(NaN)};m.squareRoot=m.sqrt=function(){var e,t,i,r,s,n,o=this,a=o.d,l=o.e,u=o.s,c=o.constructor;if(u!==1||!a||!a[0])return new c(!u||u<0&&(!a||a[0])?NaN:a?o:1/0);for(A=!1,u=Math.sqrt(+o),u==0||u==1/0?(t=re(a),(t.length+l)%2==0&&(t+="0"),u=Math.sqrt(t),l=oe((l+1)/2)-(l<0||l%2),u==1/0?t="5e"+l:(t=u.toExponential(),t=t.slice(0,t.indexOf("e")+1)+l),r=new c(t)):r=new c(u.toString()),i=(l=c.precision)+3;;)if(n=r,r=n.plus(F(o,n,i+2,1)).times(.5),re(n.d).slice(0,i)===(t=re(r.d)).slice(0,i))if(t=t.slice(i-3,i+1),t=="9999"||!s&&t=="4999"){if(!s&&(O(n,l+1,0),n.times(n).eq(o))){r=n;break}i+=4,s=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(O(r,l+1,1),e=!r.times(r).eq(o));break}return A=!0,O(r,l,c.rounding,e)};m.tangent=m.tan=function(){var e,t,i=this,r=i.constructor;return i.isFinite()?i.isZero()?new r(i):(e=r.precision,t=r.rounding,r.precision=e+10,r.rounding=1,i=i.sin(),i.s=1,i=F(i,new r(1).minus(i.times(i)).sqrt(),e+10,0),r.precision=e,r.rounding=t,O(Le==2||Le==4?i.neg():i,e,t,!0)):new r(NaN)};m.times=m.mul=function(e){var t,i,r,s,n,o,a,l,u,c=this,h=c.constructor,d=c.d,p=(e=new h(e)).d;if(e.s*=c.s,!d||!d[0]||!p||!p[0])return new h(!e.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?e.s/0:e.s*0);for(i=oe(c.e/$)+oe(e.e/$),l=d.length,u=p.length,l<u&&(n=d,d=p,p=n,o=l,l=u,u=o),n=[],o=l+u,r=o;r--;)n.push(0);for(r=u;--r>=0;){for(t=0,s=l+r;s>r;)a=n[s]+p[r]*d[s-r-1]+t,n[s--]=a%ke|0,t=a/ke|0;n[s]=(n[s]+t)%ke|0}for(;!n[--o];)n.pop();return t?++i:n.shift(),e.d=n,e.e=li(n,i),A?O(e,h.precision,h.rounding):e};m.toBinary=function(e,t){return Or(this,2,e,t)};m.toDecimalPlaces=m.toDP=function(e,t){var i=this,r=i.constructor;return i=new r(i),e===void 0?i:(ce(e,0,Me),t===void 0?t=r.rounding:ce(t,0,8),O(i,e+i.e+1,t))};m.toExponential=function(e,t){var i,r=this,s=r.constructor;return e===void 0?i=Pe(r,!0):(ce(e,0,Me),t===void 0?t=s.rounding:ce(t,0,8),r=O(new s(r),e+1,t),i=Pe(r,!0,e+1)),r.isNeg()&&!r.isZero()?"-"+i:i};m.toFixed=function(e,t){var i,r,s=this,n=s.constructor;return e===void 0?i=Pe(s):(ce(e,0,Me),t===void 0?t=n.rounding:ce(t,0,8),r=O(new n(s),e+s.e+1,t),i=Pe(r,!1,e+r.e+1)),s.isNeg()&&!s.isZero()?"-"+i:i};m.toFraction=function(e){var t,i,r,s,n,o,a,l,u,c,h,d,p=this,w=p.d,v=p.constructor;if(!w)return new v(p);if(u=i=new v(1),r=l=new v(0),t=new v(r),n=t.e=Zs(w)-p.e-1,o=n%$,t.d[0]=Y(10,o<0?$+o:o),e==null)e=n>0?t:u;else{if(a=new v(e),!a.isInt()||a.lt(u))throw Error(Ue+a);e=a.gt(t)?n>0?t:u:a}for(A=!1,a=new v(re(w)),c=v.precision,v.precision=n=w.length*$*2;h=F(a,t,0,1,1),s=i.plus(h.times(r)),s.cmp(e)!=1;)i=r,r=s,s=u,u=l.plus(h.times(s)),l=s,s=t,t=a.minus(h.times(s)),a=s;return s=F(e.minus(i),r,0,1,1),l=l.plus(s.times(u)),i=i.plus(s.times(r)),l.s=u.s=p.s,d=F(u,r,n,1).minus(p).abs().cmp(F(l,i,n,1).minus(p).abs())<1?[u,r]:[l,i],v.precision=c,A=!0,d};m.toHexadecimal=m.toHex=function(e,t){return Or(this,16,e,t)};m.toNearest=function(e,t){var i=this,r=i.constructor;if(i=new r(i),e==null){if(!i.d)return i;e=new r(1),t=r.rounding}else{if(e=new r(e),t===void 0?t=r.rounding:ce(t,0,8),!i.d)return e.s?i:e;if(!e.d)return e.s&&(e.s=i.s),e}return e.d[0]?(A=!1,i=F(i,e,0,t,1).times(e),A=!0,O(i)):(e.s=i.s,i=e),i};m.toNumber=function(){return+this};m.toOctal=function(e,t){return Or(this,8,e,t)};m.toPower=m.pow=function(e){var t,i,r,s,n,o,a=this,l=a.constructor,u=+(e=new l(e));if(!a.d||!e.d||!a.d[0]||!e.d[0])return new l(Y(+a,u));if(a=new l(a),a.eq(1))return a;if(r=l.precision,n=l.rounding,e.eq(1))return O(a,r,n);if(t=oe(e.e/$),t>=e.d.length-1&&(i=u<0?-u:u)<=ua)return s=Hs(l,a,i,r),e.s<0?new l(1).div(s):O(s,r,n);if(o=a.s,o<0){if(t<e.d.length-1)return new l(NaN);if(e.d[t]&1||(o=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=o,a}return i=Y(+a,u),t=i==0||!isFinite(i)?oe(u*(Math.log("0."+re(a.d))/Math.LN10+a.e+1)):new l(i+"").e,t>l.maxE+1||t<l.minE-1?new l(t>0?o/0:0):(A=!1,l.rounding=a.s=1,i=Math.min(12,(t+"").length),s=pr(e.times(Re(a,r+i)),r),s.d&&(s=O(s,r+5,1),Rt(s.d,r,n)&&(t=r+10,s=O(pr(e.times(Re(a,t+i)),t),t+5,1),+re(s.d).slice(r+1,r+15)+1==1e14&&(s=O(s,r+1,0)))),s.s=o,A=!0,l.rounding=n,O(s,r,n))};m.toPrecision=function(e,t){var i,r=this,s=r.constructor;return e===void 0?i=Pe(r,r.e<=s.toExpNeg||r.e>=s.toExpPos):(ce(e,1,Me),t===void 0?t=s.rounding:ce(t,0,8),r=O(new s(r),e,t),i=Pe(r,e<=r.e||r.e<=s.toExpNeg,e)),r.isNeg()&&!r.isZero()?"-"+i:i};m.toSignificantDigits=m.toSD=function(e,t){var i=this,r=i.constructor;return e===void 0?(e=r.precision,t=r.rounding):(ce(e,1,Me),t===void 0?t=r.rounding:ce(t,0,8)),O(new r(i),e,t)};m.toString=function(){var e=this,t=e.constructor,i=Pe(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+i:i};m.truncated=m.trunc=function(){return O(new this.constructor(this),this.e+1,1)};m.valueOf=m.toJSON=function(){var e=this,t=e.constructor,i=Pe(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+i:i};function re(e){var t,i,r,s=e.length-1,n="",o=e[0];if(s>0){for(n+=o,t=1;t<s;t++)r=e[t]+"",i=$-r.length,i&&(n+=Ie(i)),n+=r;o=e[t],r=o+"",i=$-r.length,i&&(n+=Ie(i))}else if(o===0)return"0";for(;o%10===0;)o/=10;return n+o}function ce(e,t,i){if(e!==~~e||e<t||e>i)throw Error(Ue+e)}function Rt(e,t,i,r){var s,n,o,a;for(n=e[0];n>=10;n/=10)--t;return--t<0?(t+=$,s=0):(s=Math.ceil((t+1)/$),t%=$),n=Y(10,$-t),a=e[s]%n|0,r==null?t<3?(t==0?a=a/100|0:t==1&&(a=a/10|0),o=i<4&&a==99999||i>3&&a==49999||a==5e4||a==0):o=(i<4&&a+1==n||i>3&&a+1==n/2)&&(e[s+1]/n/100|0)==Y(10,t-2)-1||(a==n/2||a==0)&&(e[s+1]/n/100|0)==0:t<4?(t==0?a=a/1e3|0:t==1?a=a/100|0:t==2&&(a=a/10|0),o=(r||i<4)&&a==9999||!r&&i>3&&a==4999):o=((r||i<4)&&a+1==n||!r&&i>3&&a+1==n/2)&&(e[s+1]/n/1e3|0)==Y(10,t-3)-1,o}function Xt(e,t,i){for(var r,s=[0],n,o=0,a=e.length;o<a;){for(n=s.length;n--;)s[n]*=t;for(s[0]+=hr.indexOf(e.charAt(o++)),r=0;r<s.length;r++)s[r]>i-1&&(s[r+1]===void 0&&(s[r+1]=0),s[r+1]+=s[r]/i|0,s[r]%=i)}return s.reverse()}function ha(e,t){var i,r,s;if(t.isZero())return t;r=t.d.length,r<32?(i=Math.ceil(r/3),s=(1/ui(4,i)).toString()):(i=16,s="2.3283064365386962890625e-10"),e.precision+=i,t=kt(e,1,t.times(s),new e(1));for(var n=i;n--;){var o=t.times(t);t=o.times(o).minus(o).times(8).plus(1)}return e.precision-=i,t}var F=function(){function e(r,s,n){var o,a=0,l=r.length;for(r=r.slice();l--;)o=r[l]*s+a,r[l]=o%n|0,a=o/n|0;return a&&r.unshift(a),r}function t(r,s,n,o){var a,l;if(n!=o)l=n>o?1:-1;else for(a=l=0;a<n;a++)if(r[a]!=s[a]){l=r[a]>s[a]?1:-1;break}return l}function i(r,s,n,o){for(var a=0;n--;)r[n]-=a,a=r[n]<s[n]?1:0,r[n]=a*o+r[n]-s[n];for(;!r[0]&&r.length>1;)r.shift()}return function(r,s,n,o,a,l){var u,c,h,d,p,w,v,f,g,k,x,P,E,L,V,X,H,ae,W,le,Fe=r.constructor,ot=r.s==s.s?1:-1,z=r.d,B=s.d;if(!z||!z[0]||!B||!B[0])return new Fe(!r.s||!s.s||(z?B&&z[0]==B[0]:!B)?NaN:z&&z[0]==0||!B?ot*0:ot/0);for(l?(p=1,c=r.e-s.e):(l=ke,p=$,c=oe(r.e/p)-oe(s.e/p)),W=B.length,H=z.length,g=new Fe(ot),k=g.d=[],h=0;B[h]==(z[h]||0);h++);if(B[h]>(z[h]||0)&&c--,n==null?(L=n=Fe.precision,o=Fe.rounding):a?L=n+(r.e-s.e)+1:L=n,L<0)k.push(1),w=!0;else{if(L=L/p+2|0,h=0,W==1){for(d=0,B=B[0],L++;(h<H||d)&&L--;h++)V=d*l+(z[h]||0),k[h]=V/B|0,d=V%B|0;w=d||h<H}else{for(d=l/(B[0]+1)|0,d>1&&(B=e(B,d,l),z=e(z,d,l),W=B.length,H=z.length),X=W,x=z.slice(0,W),P=x.length;P<W;)x[P++]=0;le=B.slice(),le.unshift(0),ae=B[0],B[1]>=l/2&&++ae;do d=0,u=t(B,x,W,P),u<0?(E=x[0],W!=P&&(E=E*l+(x[1]||0)),d=E/ae|0,d>1?(d>=l&&(d=l-1),v=e(B,d,l),f=v.length,P=x.length,u=t(v,x,f,P),u==1&&(d--,i(v,W<f?le:B,f,l))):(d==0&&(u=d=1),v=B.slice()),f=v.length,f<P&&v.unshift(0),i(x,v,P,l),u==-1&&(P=x.length,u=t(B,x,W,P),u<1&&(d++,i(x,W<P?le:B,P,l))),P=x.length):u===0&&(d++,x=[0]),k[h++]=d,u&&x[0]?x[P++]=z[X]||0:(x=[z[X]],P=1);while((X++<H||x[0]!==void 0)&&L--);w=x[0]!==void 0}k[0]||k.shift()}if(p==1)g.e=c,Rs=w;else{for(h=1,d=k[0];d>=10;d/=10)h++;g.e=h+c*p-1,O(g,a?n+g.e+1:n,o,w)}return g}}();function O(e,t,i,r){var s,n,o,a,l,u,c,h,d,p=e.constructor;e:if(t!=null){if(h=e.d,!h)return e;for(s=1,a=h[0];a>=10;a/=10)s++;if(n=t-s,n<0)n+=$,o=t,c=h[d=0],l=c/Y(10,s-o-1)%10|0;else if(d=Math.ceil((n+1)/$),a=h.length,d>=a)if(r){for(;a++<=d;)h.push(0);c=l=0,s=1,n%=$,o=n-$+1}else break e;else{for(c=a=h[d],s=1;a>=10;a/=10)s++;n%=$,o=n-$+s,l=o<0?0:c/Y(10,s-o-1)%10|0}if(r=r||t<0||h[d+1]!==void 0||(o<0?c:c%Y(10,s-o-1)),u=i<4?(l||r)&&(i==0||i==(e.s<0?3:2)):l>5||l==5&&(i==4||r||i==6&&(n>0?o>0?c/Y(10,s-o):0:h[d-1])%10&1||i==(e.s<0?8:7)),t<1||!h[0])return h.length=0,u?(t-=e.e+1,h[0]=Y(10,($-t%$)%$),e.e=-t||0):h[0]=e.e=0,e;if(n==0?(h.length=d,a=1,d--):(h.length=d+1,a=Y(10,$-n),h[d]=o>0?(c/Y(10,s-o)%Y(10,o)|0)*a:0),u)for(;;)if(d==0){for(n=1,o=h[0];o>=10;o/=10)n++;for(o=h[0]+=a,a=1;o>=10;o/=10)a++;n!=a&&(e.e++,h[0]==ke&&(h[0]=1));break}else{if(h[d]+=a,h[d]!=ke)break;h[d--]=0,a=1}for(n=h.length;h[--n]===0;)h.pop()}return A&&(e.e>p.maxE?(e.d=null,e.e=NaN):e.e<p.minE&&(e.e=0,e.d=[0])),e}function Pe(e,t,i){if(!e.isFinite())return zs(e);var r,s=e.e,n=re(e.d),o=n.length;return t?(i&&(r=i-o)>0?n=n.charAt(0)+"."+n.slice(1)+Ie(r):o>1&&(n=n.charAt(0)+"."+n.slice(1)),n=n+(e.e<0?"e":"e+")+e.e):s<0?(n="0."+Ie(-s-1)+n,i&&(r=i-o)>0&&(n+=Ie(r))):s>=o?(n+=Ie(s+1-o),i&&(r=i-s-1)>0&&(n=n+"."+Ie(r))):((r=s+1)<o&&(n=n.slice(0,r)+"."+n.slice(r)),i&&(r=i-o)>0&&(s+1===o&&(n+="."),n+=Ie(r))),n}function li(e,t){var i=e[0];for(t*=$;i>=10;i/=10)t++;return t}function ri(e,t,i){if(t>ca)throw A=!0,i&&(e.precision=i),Error(Us);return O(new e(ti),t,1,!0)}function Te(e,t,i){if(t>fr)throw Error(Us);return O(new e(ii),t,i,!0)}function Zs(e){var t=e.length-1,i=t*$+1;if(t=e[t],t){for(;t%10==0;t/=10)i--;for(t=e[0];t>=10;t/=10)i++}return i}function Ie(e){for(var t="";e--;)t+="0";return t}function Hs(e,t,i,r){var s,n=new e(1),o=Math.ceil(r/$+4);for(A=!1;;){if(i%2&&(n=n.times(t),ls(n.d,o)&&(s=!0)),i=oe(i/2),i===0){i=n.d.length-1,s&&n.d[i]===0&&++n.d[i];break}t=t.times(t),ls(t.d,o)}return A=!0,n}function as(e){return e.d[e.d.length-1]&1}function Js(e,t,i){for(var r,s=new e(t[0]),n=0;++n<t.length;)if(r=new e(t[n]),r.s)s[i](r)&&(s=r);else{s=r;break}return s}function pr(e,t){var i,r,s,n,o,a,l,u=0,c=0,h=0,d=e.constructor,p=d.rounding,w=d.precision;if(!e.d||!e.d[0]||e.e>17)return new d(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:NaN);for(t==null?(A=!1,l=w):l=t,a=new d(.03125);e.e>-2;)e=e.times(a),h+=5;for(r=Math.log(Y(2,h))/Math.LN10*2+5|0,l+=r,i=n=o=new d(1),d.precision=l;;){if(n=O(n.times(e),l,1),i=i.times(++c),a=o.plus(F(n,i,l,1)),re(a.d).slice(0,l)===re(o.d).slice(0,l)){for(s=h;s--;)o=O(o.times(o),l,1);if(t==null)if(u<3&&Rt(o.d,l-r,p,u))d.precision=l+=10,i=n=a=new d(1),c=0,u++;else return O(o,d.precision=w,p,A=!0);else return d.precision=w,o}o=a}}function Re(e,t){var i,r,s,n,o,a,l,u,c,h,d,p=1,w=10,v=e,f=v.d,g=v.constructor,k=g.rounding,x=g.precision;if(v.s<0||!f||!f[0]||!v.e&&f[0]==1&&f.length==1)return new g(f&&!f[0]?-1/0:v.s!=1?NaN:f?0:v);if(t==null?(A=!1,c=x):c=t,g.precision=c+=w,i=re(f),r=i.charAt(0),Math.abs(n=v.e)<15e14){for(;r<7&&r!=1||r==1&&i.charAt(1)>3;)v=v.times(e),i=re(v.d),r=i.charAt(0),p++;n=v.e,r>1?(v=new g("0."+i),n++):v=new g(r+"."+i.slice(1))}else return u=ri(g,c+2,x).times(n+""),v=Re(new g(r+"."+i.slice(1)),c-w).plus(u),g.precision=x,t==null?O(v,x,k,A=!0):v;for(h=v,l=o=v=F(v.minus(1),v.plus(1),c,1),d=O(v.times(v),c,1),s=3;;){if(o=O(o.times(d),c,1),u=l.plus(F(o,new g(s),c,1)),re(u.d).slice(0,c)===re(l.d).slice(0,c))if(l=l.times(2),n!==0&&(l=l.plus(ri(g,c+2,x).times(n+""))),l=F(l,new g(p),c,1),t==null)if(Rt(l.d,c-w,k,a))g.precision=c+=w,u=o=v=F(h.minus(1),h.plus(1),c,1),d=O(v.times(v),c,1),s=a=1;else return O(l,g.precision=x,k,A=!0);else return g.precision=x,l;l=u,s+=2}}function zs(e){return String(e.s*e.s/0)}function mr(e,t){var i,r,s;for((i=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(i<0&&(i=r),i+=+t.slice(r+1),t=t.substring(0,r)):i<0&&(i=t.length),r=0;t.charCodeAt(r)===48;r++);for(s=t.length;t.charCodeAt(s-1)===48;--s);if(t=t.slice(r,s),t){if(s-=r,e.e=i=i-r-1,e.d=[],r=(i+1)%$,i<0&&(r+=$),r<s){for(r&&e.d.push(+t.slice(0,r)),s-=$;r<s;)e.d.push(+t.slice(r,r+=$));t=t.slice(r),r=$-t.length}else r-=s;for(;r--;)t+="0";e.d.push(+t),A&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function da(e,t){var i,r,s,n,o,a,l,u,c;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),Bs.test(t))return mr(e,t)}else if(t==="Infinity"||t==="NaN")return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(aa.test(t))i=16,t=t.toLowerCase();else if(oa.test(t))i=2;else if(la.test(t))i=8;else throw Error(Ue+t);for(n=t.search(/p/i),n>0?(l=+t.slice(n+1),t=t.substring(2,n)):t=t.slice(2),n=t.indexOf("."),o=n>=0,r=e.constructor,o&&(t=t.replace(".",""),a=t.length,n=a-n,s=Hs(r,new r(i),n,n*2)),u=Xt(t,i,ke),c=u.length-1,n=c;u[n]===0;--n)u.pop();return n<0?new r(e.s*0):(e.e=li(u,c),e.d=u,A=!1,o&&(e=F(e,s,a*4)),l&&(e=e.times(Math.abs(l)<54?Y(2,l):J.pow(2,l))),A=!0,e)}function fa(e,t){var i,r=t.d.length;if(r<3)return t.isZero()?t:kt(e,2,t,t);i=1.4*Math.sqrt(r),i=i>16?16:i|0,t=t.times(1/ui(5,i)),t=kt(e,2,t,t);for(var s,n=new e(5),o=new e(16),a=new e(20);i--;)s=t.times(t),t=t.times(n.plus(s.times(o.times(s).minus(a))));return t}function kt(e,t,i,r,s){var n,o,a,l,u=e.precision,c=Math.ceil(u/$);for(A=!1,l=i.times(i),a=new e(r);;){if(o=F(a.times(l),new e(t++*t++),u,1),a=s?r.plus(o):r.minus(o),r=F(o.times(l),new e(t++*t++),u,1),o=a.plus(r),o.d[c]!==void 0){for(n=c;o.d[n]===a.d[n]&&n--;);if(n==-1)break}n=a,a=r,r=o,o=n}return A=!0,o.d.length=c+1,o}function ui(e,t){for(var i=e;--t;)i*=e;return i}function Gs(e,t){var i,r=t.s<0,s=Te(e,e.precision,1),n=s.times(.5);if(t=t.abs(),t.lte(n))return Le=r?4:1,t;if(i=t.divToInt(s),i.isZero())Le=r?3:2;else{if(t=t.minus(i.times(s)),t.lte(n))return Le=as(i)?r?2:3:r?4:1,t;Le=as(i)?r?1:4:r?3:2}return t.minus(s).abs()}function Or(e,t,i,r){var s,n,o,a,l,u,c,h,d,p=e.constructor,w=i!==void 0;if(w?(ce(i,1,Me),r===void 0?r=p.rounding:ce(r,0,8)):(i=p.precision,r=p.rounding),!e.isFinite())c=zs(e);else{for(c=Pe(e),o=c.indexOf("."),w?(s=2,t==16?i=i*4-3:t==8&&(i=i*3-2)):s=t,o>=0&&(c=c.replace(".",""),d=new p(1),d.e=c.length-o,d.d=Xt(Pe(d),10,s),d.e=d.d.length),h=Xt(c,10,s),n=l=h.length;h[--l]==0;)h.pop();if(!h[0])c=w?"0p+0":"0";else{if(o<0?n--:(e=new p(e),e.d=h,e.e=n,e=F(e,d,i,r,0,s),h=e.d,n=e.e,u=Rs),o=h[i],a=s/2,u=u||h[i+1]!==void 0,u=r<4?(o!==void 0||u)&&(r===0||r===(e.s<0?3:2)):o>a||o===a&&(r===4||u||r===6&&h[i-1]&1||r===(e.s<0?8:7)),h.length=i,u)for(;++h[--i]>s-1;)h[i]=0,i||(++n,h.unshift(1));for(l=h.length;!h[l-1];--l);for(o=0,c="";o<l;o++)c+=hr.charAt(h[o]);if(w){if(l>1)if(t==16||t==8){for(o=t==16?4:3,--l;l%o;l++)c+="0";for(h=Xt(c,s,t),l=h.length;!h[l-1];--l);for(o=1,c="1.";o<l;o++)c+=hr.charAt(h[o])}else c=c.charAt(0)+"."+c.slice(1);c=c+(n<0?"p":"p+")+n}else if(n<0){for(;++n;)c="0"+c;c="0."+c}else if(++n>l)for(n-=l;n--;)c+="0";else n<l&&(c=c.slice(0,n)+"."+c.slice(n))}c=(t==16?"0x":t==2?"0b":t==8?"0o":"")+c}return e.s<0?"-"+c:c}function ls(e,t){if(e.length>t)return e.length=t,!0}function pa(e){return new this(e).abs()}function ma(e){return new this(e).acos()}function ga(e){return new this(e).acosh()}function va(e,t){return new this(e).plus(t)}function wa(e){return new this(e).asin()}function ya(e){return new this(e).asinh()}function _a(e){return new this(e).atan()}function ba(e){return new this(e).atanh()}function Ta(e,t){e=new this(e),t=new this(t);var i,r=this.precision,s=this.rounding,n=r+4;return!e.s||!t.s?i=new this(NaN):!e.d&&!t.d?(i=Te(this,n,1).times(t.s>0?.25:.75),i.s=e.s):!t.d||e.isZero()?(i=t.s<0?Te(this,r,s):new this(0),i.s=e.s):!e.d||t.isZero()?(i=Te(this,n,1).times(.5),i.s=e.s):t.s<0?(this.precision=n,this.rounding=1,i=this.atan(F(e,t,n,1)),t=Te(this,n,1),this.precision=r,this.rounding=s,i=e.s<0?i.minus(t):i.plus(t)):i=this.atan(F(e,t,n,1)),i}function ka(e){return new this(e).cbrt()}function Sa(e){return O(e=new this(e),e.e+1,2)}function Ea(e,t,i){return new this(e).clamp(t,i)}function Oa(e){if(!e||typeof e!="object")throw Error(ai+"Object expected");var t,i,r,s=e.defaults===!0,n=["precision",1,Me,"rounding",0,8,"toExpNeg",-gt,0,"toExpPos",0,gt,"maxE",0,gt,"minE",-gt,0,"modulo",0,9];for(t=0;t<n.length;t+=3)if(i=n[t],s&&(this[i]=dr[i]),(r=e[i])!==void 0)if(oe(r)===r&&r>=n[t+1]&&r<=n[t+2])this[i]=r;else throw Error(Ue+i+": "+r);if(i="crypto",s&&(this[i]=dr[i]),(r=e[i])!==void 0)if(r===!0||r===!1||r===0||r===1)if(r)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[i]=!0;else throw Error(Ms);else this[i]=!1;else throw Error(Ue+i+": "+r);return this}function xa(e){return new this(e).cos()}function $a(e){return new this(e).cosh()}function Vs(e){var t,i,r;function s(n){var o,a,l,u=this;if(!(u instanceof s))return new s(n);if(u.constructor=s,us(n)){u.s=n.s,A?!n.d||n.e>s.maxE?(u.e=NaN,u.d=null):n.e<s.minE?(u.e=0,u.d=[0]):(u.e=n.e,u.d=n.d.slice()):(u.e=n.e,u.d=n.d?n.d.slice():n.d);return}if(l=typeof n,l==="number"){if(n===0){u.s=1/n<0?-1:1,u.e=0,u.d=[0];return}if(n<0?(n=-n,u.s=-1):u.s=1,n===~~n&&n<1e7){for(o=0,a=n;a>=10;a/=10)o++;A?o>s.maxE?(u.e=NaN,u.d=null):o<s.minE?(u.e=0,u.d=[0]):(u.e=o,u.d=[n]):(u.e=o,u.d=[n]);return}else if(n*0!==0){n||(u.s=NaN),u.e=NaN,u.d=null;return}return mr(u,n.toString())}else if(l!=="string")throw Error(Ue+n);return(a=n.charCodeAt(0))===45?(n=n.slice(1),u.s=-1):(a===43&&(n=n.slice(1)),u.s=1),Bs.test(n)?mr(u,n):da(u,n)}if(s.prototype=m,s.ROUND_UP=0,s.ROUND_DOWN=1,s.ROUND_CEIL=2,s.ROUND_FLOOR=3,s.ROUND_HALF_UP=4,s.ROUND_HALF_DOWN=5,s.ROUND_HALF_EVEN=6,s.ROUND_HALF_CEIL=7,s.ROUND_HALF_FLOOR=8,s.EUCLID=9,s.config=s.set=Oa,s.clone=Vs,s.isDecimal=us,s.abs=pa,s.acos=ma,s.acosh=ga,s.add=va,s.asin=wa,s.asinh=ya,s.atan=_a,s.atanh=ba,s.atan2=Ta,s.cbrt=ka,s.ceil=Sa,s.clamp=Ea,s.cos=xa,s.cosh=$a,s.div=Pa,s.exp=Aa,s.floor=La,s.hypot=ja,s.ln=Na,s.log=Ca,s.log10=Ia,s.log2=Da,s.max=qa,s.min=Ra,s.mod=Ua,s.mul=Ma,s.pow=Fa,s.random=Ba,s.round=Za,s.sign=Ha,s.sin=Ja,s.sinh=za,s.sqrt=Ga,s.sub=Va,s.sum=Ka,s.tan=Qa,s.tanh=Wa,s.trunc=Ya,e===void 0&&(e={}),e&&e.defaults!==!0)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<r.length;)e.hasOwnProperty(i=r[t++])||(e[i]=this[i]);return s.config(e),s}function Pa(e,t){return new this(e).div(t)}function Aa(e){return new this(e).exp()}function La(e){return O(e=new this(e),e.e+1,3)}function ja(){var e,t,i=new this(0);for(A=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)i.d&&(i=i.plus(t.times(t)));else{if(t.s)return A=!0,new this(1/0);i=t}return A=!0,i.sqrt()}function us(e){return e instanceof J||e&&e.toStringTag===Fs||!1}function Na(e){return new this(e).ln()}function Ca(e,t){return new this(e).log(t)}function Da(e){return new this(e).log(2)}function Ia(e){return new this(e).log(10)}function qa(){return Js(this,arguments,"lt")}function Ra(){return Js(this,arguments,"gt")}function Ua(e,t){return new this(e).mod(t)}function Ma(e,t){return new this(e).mul(t)}function Fa(e,t){return new this(e).pow(t)}function Ba(e){var t,i,r,s,n=0,o=new this(1),a=[];if(e===void 0?e=this.precision:ce(e,1,Me),r=Math.ceil(e/$),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(r));n<r;)s=t[n],s>=429e7?t[n]=crypto.getRandomValues(new Uint32Array(1))[0]:a[n++]=s%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(r*=4);n<r;)s=t[n]+(t[n+1]<<8)+(t[n+2]<<16)+((t[n+3]&127)<<24),s>=214e7?crypto.randomBytes(4).copy(t,n):(a.push(s%1e7),n+=4);n=r/4}else throw Error(Ms);else for(;n<r;)a[n++]=Math.random()*1e7|0;for(r=a[--n],e%=$,r&&e&&(s=Y(10,$-e),a[n]=(r/s|0)*s);a[n]===0;n--)a.pop();if(n<0)i=0,a=[0];else{for(i=-1;a[0]===0;i-=$)a.shift();for(r=1,s=a[0];s>=10;s/=10)r++;r<$&&(i-=$-r)}return o.e=i,o.d=a,o}function Za(e){return O(e=new this(e),e.e+1,this.rounding)}function Ha(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function Ja(e){return new this(e).sin()}function za(e){return new this(e).sinh()}function Ga(e){return new this(e).sqrt()}function Va(e,t){return new this(e).sub(t)}function Ka(){var e=0,t=arguments,i=new this(t[e]);for(A=!1;i.s&&++e<t.length;)i=i.plus(t[e]);return A=!0,O(i,this.precision,this.rounding)}function Qa(e){return new this(e).tan()}function Wa(e){return new this(e).tanh()}function Ya(e){return O(e=new this(e),e.e+1,1)}m[Symbol.for("nodejs.util.inspect.custom")]=m.toString;m[Symbol.toStringTag]="Decimal";var J=m.constructor=Vs(dr);ti=new J(ti);ii=new J(ii);function Xa(e){let t=e;return{get pattern(){return t},get lexem(){return t},match(i){return i.startsWith(t)}}}function el(e){let t=e,i,r;return{get pattern(){return t},get lexem(){return i},get parts(){return r},match(s){let n=new RegExp(t).exec(s);return n&&(i=n[0],n.length>1&&(r=n)),n!==null}}}function j(e){let t;return e.startsWith("@")?t=el("^("+e.slice(1,e.length)+")"):t=Xa(e),t}function tl(e){let t=j("@\\s+"),i=0,r,s,n=e.trim(),o;function a(){i<n.length&&t.match(n.slice(i))&&(i+=t.lexem.length)}return{get lexem(){return s},get pos(){return i},get parts(){return o},match(l){if(i>=n.length)return!1;let u=n.slice(i);return l.match(u)?(s=l.lexem,"parts"in l&&(o=l.parts),i+=s.length,a(),!0):!1},prematch(l){if(i>=n.length)return!1;let u=n.slice(i);return l.match(u)},saveTrack(){r=i},backTrack(){i=r}}}function gr(e){return e.type===Fr}function pe(e){return e.type===Ft||e.type===Bt}function dt(e){return!pe(e)&&!gr(e)}function wt(e){return e.type===Ri}function M(e){return e.type===Si}function we(e){return M(e)&&e.value.isInt()}function be(e){return e.type===xi}function $t(e){return e.type===Di}function y(e){return e.type===tt}function rt(e){return e.type===Gi}function ne(e){return e.type===ki}function me(e){return e.type===Ti}function S(e){return!(wt(e)||M(e)||be(e)||$t(e)||y(e)||rt(e)||ne(e)||me(e))}function C(e){return S(e)&&e.type===Ei}function ie(e){return S(e)&&e.type===Oi}function U(e){return S(e)&&e.type===$i}function st(e){return S(e)&&e.type===zi}function Ee(e){return S(e)&&e.type===vi}function Oe(e){return S(e)&&e.type===wi}function he(e){return S(e)&&e.type===yt}function Pt(e){return S(e)&&e.type===Vt}function At(e){return S(e)&&e.type===Mt}function $e(e){return S(e)&&e.type===_i}function nt(e){return S(e)&&e.type===yi}function Se(e){return S(e)&&e.type===bi}function St(e){return S(e)&&e.type===Vi}function ci(e){return S(e)&&e.type===Cr}function Et(e){return S(e)&&e.type===Pi}function Qe(e){return S(e)&&e.type===Li}function We(e){return S(e)&&e.type===ji}function Ye(e){return S(e)&&e.type===Ni}function Xe(e){return S(e)&&e.type===Ci}function Ut(e){return S(e)&&e.type===Rr}function xr(e){return S(e)&&e.type===qr}function hi(e){return S(e)&&e.type===Ir}function $r(e){return S(e)&&e.type===Dr}function di(e){return S(e)&&e.type===Nr}function Jt(e){return S(e)&&e.type===Ui}function zt(e){return S(e)&&e.type===Mi}function fi(e){return S(e)&&e.type===Fi}function Ae(e){return S(e)&&e.type===Bi}function pi(e){return S(e)&&e.type===Zi}function Ot(e){return S(e)&&e.type===Hi}function mi(e){return S(e)&&e.type===Mr}function Gt(e){return S(e)&&e.type===Ur}function Pr(e){return S(e)&&e.type===Ji}function Ar(e){return S(e)&&e.type===Ii}function Lr(e){return S(e)&&e.type===qi}function gi(e){return S(e)&&e.type===Ai}function jr(e){return st(e)||Ar(e)||xr(e)||Ut(e)||$r(e)||hi(e)||Lr(e)||Jt(e)||zt(e)||fi(e)||pi(e)||Ae(e)||Ot(e)||Pr(e)||Gt(e)}var vi="+",wi="-",yt="*",Mt="",Vt=".",yi=":",_i="/",bi="^",tt="!! Error !!",Ti="?",ki="symbol",Si="number",Nr="percentage",Ei="opposite",Oi="positive",xi="template",Ks="unit",$i="bracket",Pi="=",Ai="!=",Li="<",ji="<=",Ni=">",Ci=">=",Cr="relations",Di="segment length",Ii="gcd",Dr="maxi",Ir="maxip",qr="mini",Rr="minip",qi="mod",Ri="boolean",Ui="cos",Mi="sin",Fi="tan",Bi="ln",Zi="log",Hi="exp",Ji="floor",Ur="abs",zi="sqrt",Mr="time",Gi="identifiant",Vi="limit",Fr="normal",Ft="nsum",Bt="nproduct",il="not initialized";function ee(e,t){if(M(e))return e.value;if(ne(e))throw new Error(`Le symbole ${e.symbol} doit tre substitu.`);if(me(e))throw new Error("Impossible d'valuer une expression contenant un trou.");if(ie(e)||U(e))return ee(e.first);if(C(e))return ee(e.first).mul(-1);if(st(e))return ee(e.first).sqrt();if(Oe(e))return ee(e.first).sub(ee(e.last));if(Se(e))return ee(e.first).pow(ee(e.last));if($e(e)||nt(e))return ee(e.first).div(ee(e.last));if(Ee(e))return e.children.reduce((i,r)=>i.add(ee(r)),new J(0));if(he(e)||Pt(e)||At(e))return e.children.reduce((i,r)=>i.mul(ee(r)),new J(1));if(Jt(e))return ee(e.first).cos();if(zt(e))return ee(e.first).sin();if(fi(e))return ee(e.first).tan();if(Ae(e))return ee(e.first).ln();if(Ot(e))return ee(e.first).exp();if(pi(e))return ee(e.first).log();throw new Error("Exp non recognized for decimal evaluation : "+e.string)}function rl(e,t,i){let r=e.length-1,s=0,n,o=r+1;for(;s<o;)n=s+(o-s>>1),i(e[n],t)<0?s=n+1:o=n;return s<=r&&i(e[s],t)===0?s:~s}var Qs=function(e,t){return t?Ws(t,e%t):e},Ws=function(e,t){return t?Ws(t,e%t):e};function Zt(e){switch(e.length){case 1:return e[0];case 2:{let t=e[0],i=e[1];if(i.isZero())return t;if(t.isZero())return i;for(i.greaterThan(t)&&([t,i]=[i,t]);!t.mod(i).isZero();)[t,i]=[i,t.mod(i)];return i}default:{let t=e.shift(),i=e.shift();return e.unshift(Zt([t,i])),Zt(e)}}}var Ki=function(e){let t=e.length,i,r;for(;t!==0;)r=Math.floor(Math.random()*t),t-=1,i=e[t],e[t]=e[r],e[r]=i;return e};function sl(e){if(e===0)return 0;if(e===1)return 1;let t=1,i=1,r=Math.floor(Math.sqrt(e));for(;i<=r;)e%(i*i)===0?(e=e/(i*i),t=t*i,r=Math.floor(Math.sqrt(e)),i=2):i++;return t}function nl(e){if(e<1)throw new RangeError("Argument error");if(e==1)return[1];let t=[];for(;e>1;){let i=ol(e);t.push(i),e/=i}return t}function ol(e){if(e<2)throw new RangeError("Argument error");if(e%2===0)return 2;let t=Math.floor(Math.sqrt(e));for(let i=3;i<=t;i+=2)if(e%i===0)return i;return e}function al(e){let t=[],i=e[0],r=1;for(let s=1;s<e.length;s++)e[s]===i?r++:(t.push([i,r]),i=e[s],r=1);return t.push([i,r]),t}function cs(e){return al(nl(e))}function ll(e,t){return Zt([e,t])}var ul={s:1,d:new J(1),n:new J(1),add(e){let t=this.n.mul(e.d).mul(this.s).add(this.d.mul(e.s).mul(e.n)),i=this.d.mul(e.d),r=t.s;return t=t.abs(),Ve({n:t,d:i,s:r}).reduce()},sub(e){let t=this.n.mul(e.d).mul(this.s),i=this.d.mul(e.s).mul(e.n),r=t.sub(i),s=this.d.mul(e.d),n=r.s;return n!==-1&&n!==1&&console.log("sub",n,this,e,t,i,r),r=r.abs(),Ve({n:r,d:s,s:n}).reduce()},mult(e){let t=this.n.mul(e.n),i=this.d.mul(e.d),r=e.s*this.s;return Ve({n:t,d:i,s:r}).reduce()},div(e){let t=this.n.mul(e.d),i=this.d.mul(e.n),r=e.s*this.s;return Ve({n:t,d:i,s:r})},reduce(){let e=ll(this.n,this.d);return Ve({n:this.n.div(e),d:this.d.div(e),s:this.s})},isLowerThan(e){let t=this.sub(e);return t.n.equals(0)?!1:(t.s!==-1&&t.s!==1&&console.log("!!!! erreur s!!!",this,e,t),t.s===-1)},isGreaterThan(e){return this.sub(e).n.equals(0)?!1:(this.sub(e).s!==-1&&this.sub(e).s!==1&&console.log("!!!! erreur s!!!",this.sub(e).s),this.sub(e).s===1)},toString(){let e=this.s<0?"-":"";return e+=this.d.equals(1)?this.n.toString():this.n.toString()+"/"+this.d.toString(),e}};function Ve({n:e,d:t,s:i}){return e.isNegative()&&console.log("!!!negative !!!"),Object.assign(Object.create(ul),{n:e,d:t,s:i})}function cl(e,t){let i=new J(e),r=new J(t),s=i.s*r.s;for(i=i.abs(),r=r.abs();!i.isInteger();)i=i.mul(10),r=r.mul(10);for(;!r.isInteger();)i=i.mul(10),r=r.mul(10);return{n:i,d:r,s}}function Ys(e){if(typeof e=="number"||J.isDecimal(e)){let t=new J(e).toFraction(),i=t[0],r=t[1],s=i.s;return i=i.abs(),Ve({n:i,d:r,s}).reduce()}else if(typeof e=="string"){e=e.replace(/ /g,"");let t=new RegExp("^([\\(\\{]?(-?\\d+)(\\.\\d+)?[\\)\\}]?)(\\/[\\(\\{]?(-?\\d+)[\\]\\}]?)?$").exec(e);if(t){let{n:i,d:r,s}=cl(parseFloat(t[1]),t[5]?parseFloat(t[5]):1);return Ve({n:i,d:r,s})}else throw new Error("fraction not recognized")}else return Ys(e.toString({displayUnit:!1}))}var _t=Ys;function hl(e){return U(e)||jr(e)||ne(e)||Se(e)&&e.first.isSymbol()}function dl(e,t){let i="";if(St(e))e.first.isSymbol(),i=e.first.string+(e.sign==="+"?"plus":"moins");else if(ci(e))i=e.first.toString(t),e.ops.forEach((r,s)=>{i+=r,i+=e.children[s+1].toString(t)});else if(mi(e))i="",e.children[0]&&!e.children[0].isZero()&&(i+=e.children[0],i+=" "),e.children[1]&&!e.children[1].isZero()&&(i+=e.children[1],i+=" "),e.children[2]&&!e.children[2].isZero()&&(i+=e.children[2],i+=" "),e.children[3]&&!e.children[3].isZero()&&(i+=e.children[3],i+=" "),e.children[4]&&!e.children[4].isZero()&&(i+=e.children[4],i+=" "),e.children[5]&&!e.children[5].isZero()&&(i+=e.children[5],i+=" "),e.children[6]&&!e.children[6].isZero()&&(i+=e.children[6],i+=" "),e.children[7]&&!e.children[7].isZero()&&(i+=e.children[7],i+=" "),i=i.trim();else if($t(e))i=e.begin+e.end;else if(Et(e)||gi(e)||Qe(e)||We(e)||Ye(e)||Xe(e))i=e.first.toString(t)+e.type+e.last.toString(t);else if(di(e))i=e.first.toString(t)+"%";else if(ie(e))i="+"+e.first.toString(t);else if(C(e)){let r=t.addBrackets&&(e.first.isOpposite()||e.first.isPositive());i="-",r&&(i+="("),i+=e.first.toString(t),r&&(i+=")")}else if(st(e)||Jt(e)||zt(e)||fi(e)||Ae(e)||pi(e)||Ot(e)||Pr(e)||Gt(e))i=e.type+"("+e.first.toString(t)+")";else if(U(e))i="("+e.first.toString(t)+")";else if(Oe(e))i=e.first.toString(t)+"-"+e.last.toString(t);else if(Se(e))i=e.last.toString(t),e.last.isSymbol()||e.last.isNumber()||e.last.isHole()||e.last.isBracket()||(i="{"+i+"}"),i=e.first.toString(t)+"^"+i;else if(nt(e))i=e.first.toString(t)+":"+e.last.toString(t);else if($e(e)){let r=e.first.toString(t),s=e.last.toString(t);(e.first.isOpposite()||e.first.isSum()||e.first.isDifference())&&(r="{"+r+"}"),(e.last.isOpposite()||e.last.isSum()||e.last.isDifference()||e.last.isProduct()||e.last.isDivision()||e.last.isQuotient())&&(s="{"+s+"}"),i=r+"/"+s}else if(Ee(e))i=e.children.map(r=>r.toString(t)).join(e.type);else if(he(e))i=e.first.toString(t)+(t.isUnit?".":t.implicit&&hl(e.last)?"":e.type)+e.last.toString(t);else if(At(e))i=e.children.map(r=>r.isQuotient()?"{"+r.toString(t)+"}":r.toString(t)).join("");else if(Pt(e))i=e.children.map(r=>r.toString(t)).join(e.type);else if(rt(e))i=e.name;else if(ne(e))i=e.symbol;else if(M(e))i=e.input,t.comma&&(i=i.replace(".",","));else if(me(e))i="?";else if(y(e))i=e.input||"";else if(Ar(e))i="pgcd("+e.first.toString(t)+";"+e.last.toString(t)+")";else if(Lr(e))i="mod("+e.first.toString(t)+";"+e.last.toString(t)+")";else if(wt(e))i=e.boolvalue.toString();else if(be(e))switch(i=e.nature,e.relative&&(i+="r"),e.signed&&(i+="s"),e.nature){case"$e":case"$ep":case"$ei":e.children[0].isHole()&&e.children[1].isHole()?i+=`[${e.children[2].toString(t)};${e.children[3].toString(t)}]`:i+=`{${e.children[0].isHole()?"":e.children[0].toString(t)+";"}${e.children[1].toString(t)}}`,e.exclude&&(i+="\\{"+e.exclude.map(r=>r.toString(t)).join(";")+"}"),e.excludeMin&&(i+="\\["+e.excludeMin+";"+e.excludeMax+"]");break;case"$d":case"$dr":case"$dn":break;case"$l":i+="{"+e.children.map(r=>r.toString(t)).join(";")+"}",e.exclude&&(i+="\\{"+e.exclude.map(r=>r.toString(t)).join(";")+"}"),e.excludeMin&&(i+="\\["+e.excludeMin+";"+e.excludeMax+"]");break;case"$":i+="{"+e.first.toString(t)+"}"}else(xr(e)||Ut(e)||$r(e)||hi(e))&&(i=e.type+"("+e.first.string+";"+e.last.string+")");return e.unit&&t.displayUnit&&(e.isSymbol()||e.isNumber()||e.isBracket()||e.isHole()||e.isTemplate()||(i="{"+i+"}"),i+=" "+e.unit.string),i}function fl(e,t){let i;if(St(e)&&(e.first.isSymbol()?i=e.sign+"\\infin":i=e.first.string+"^"+e.sign),Gt(e))i="\\left\\lvert "+e.first.toLatex(t)+" \\right\\rvert";else if(mi(e))i="",e.children[0]&&!e.children[0].isZero()&&(i+=e.children[0].toLatex(t),i+="\\,"),e.children[1]&&!e.children[1].isZero()&&(i+=e.children[1].toLatex(t),i+="\\,"),e.children[2]&&!e.children[2].isZero()&&(i+=e.children[2].toLatex(t),i+="\\,"),e.children[3]&&!e.children[3].isZero()&&(i+=e.children[3].toLatex(t),i+="\\,"),e.children[4]&&!e.children[4].isZero()&&(i+=e.children[4].toLatex(t),i+="\\,"),e.children[5]&&!e.children[5].isZero()&&(e.children[5].value.lessThan(10)?i+="0"+e.children[5].toLatex(t):i+=e.children[5].toLatex(t),i+="\\,"),e.children[6]&&!e.children[6].isZero()&&(i+=e.children[6].toLatex(t),i+="\\,"),e.children[7]&&!e.children[7].isZero()&&(i+=e.children[7].toLatex(t),i+="\\,");else if($t(e))i=e.begin+e.end;else if(ci(e))i=e.first.toLatex(t),e.ops.forEach((r,s)=>{i+=r,i+=e.children[s+1].toLatex(t)});else if(Et(e)||gi(e)||Qe(e)||We(e)||Ye(e)||Xe(e))i=e.first.toLatex(t)+e.type+e.last.toLatex(t);else if(di(e))i=e.first.toLatex(t)+"\\%";else if(st(e))i="\\sqrt{"+e.first.toLatex(t)+"}";else if(U(e))i="\\left(",i+=e.first.toLatex(t),i+="\\right)";else if(ie(e)){let r=t.addBrackets&&(e.first.isOpposite()||e.first.isPositive());i="+",r&&(i+="\\left("),i+=e.first.toLatex(t),r&&(i+="\\right)")}else if(C(e)){let r=t.addBrackets&&(e.first.isSum()||e.first.isDifference()||e.first.isOpposite()||e.first.isPositive());i="-",r&&(i+="\\left("),i+=e.first.toLatex(t),r&&(i+="\\right)")}else if(Oe(e)){let r=t.addBrackets&&(e.last.isSum()||e.last.isDifference()||e.last.isOpposite()||e.last.isPositive());i=e.first.toLatex(t)+"-",r&&(i+="\\left("),i+=e.last.toLatex(t),r&&(i+="\\right)")}else if(Ee(e)){let r=t.addBrackets&&(e.last.isOpposite()||e.last.isPositive());i=e.first.toLatex(t)+"+",r&&(i+="\\left("),i+=e.last.toLatex(t),r&&(i+="\\right)")}else if(Se(e))i=e.first.toLatex(t)+"^{"+e.last.toLatex(t)+"}";else if(nt(e))i=e.first.toLatex(t)+"\\div"+e.last.toLatex(t);else if($e(e))i="\\dfrac{"+(U(e.first)?e.first.first.toLatex(t):e.first.toLatex(t))+"}{"+(U(e.last)?e.last.first.toLatex(t):e.last.toLatex(t))+"}";else if(he(e)){let r=e.first,s=e.last;U(r)&&r.first.isQuotient()&&(r=r.first),U(s)&&s.first.isQuotient()&&(s=s.first),i=r.toLatex(t)+(t.implicit?"":"\\times ")+s.toLatex(t)}else if(At(e))i=e.children.map(r=>r.toLatex(t)).join("");else if(Pt(e))i=e.children.map(r=>r.toLatex(t)).join(" \\cdot ");else if(rt(e))i=e.name;else if(ne(e))e.symbol==="pi"?i="\\pi":i=e.symbol;else if(M(e))i=e.toString({displayUnit:!1}),t.addSpaces&&(i=Xs(i)),i=i.replace(/ /g,"\\,").replace(".","{,}");else if(me(e))i="\\ldots";else if(y(e))switch(e.input){case"<":i="\\lt";break;case">":i="\\gt";break;default:i=e.input||""}else i=e.string;return e.unit&&(i+="\\,"+e.unit.string),i}function pl(e,t){let i="";return Gt(e)?i="<around*|\\||"+e.first.toLatex(t)+"|\\|>":mi(e)?(i="",e.children[0]&&!e.children[0].isZero()&&(i+=e.children[0].toTexmacs(t),i+="<space|0.17em>"),e.children[1]&&!e.children[1].isZero()&&(i+=e.children[1].toTexmacs(t),i+="<space|0.17em>"),e.children[2]&&!e.children[2].isZero()&&(i+=e.children[2].toTexmacs(t),i+="<space|0.17em>"),e.children[3]&&!e.children[3].isZero()&&(i+=e.children[3].toTexmacs(t),i+="<space|0.17em>"),e.children[4]&&!e.children[4].isZero()&&(i+=e.children[4].toTexmacs(t),i+="<space|0.17em>"),e.children[5]&&!e.children[5].isZero()&&(e.children[5].value.lessThan(10)?i+="0"+e.children[5].toTexmacs(t):i+=e.children[5].toTexmacs(t),i+="<space|0.17em>"),e.children[6]&&!e.children[6].isZero()&&(i+=e.children[6].toTexmacs(t),i+="<space|0.17em>"),e.children[7]&&!e.children[7].isZero()&&(i+=e.children[7].toTexmacs(t),i+="<space|0.17em>")):$t(e)?i=e.begin+e.end:Et(e)?i=e.first.toTexmacs(t)+"="+e.last.toTexmacs(t):gi(e)?i=e.first.toTexmacs(t)+"\\<neq\\>"+e.last.toTexmacs(t):Qe(e)?i=e.first.toTexmacs(t)+"\\<less\\>"+e.last.toTexmacs(t):We(e)?i=e.first.toTexmacs(t)+"\\<leqslant\\>"+e.last.toTexmacs(t):Ye(e)?i=e.first.toTexmacs(t)+"\\<gtr\\>"+e.last.toTexmacs(t):Xe(e)?i=e.first.toTexmacs(t)+"\\<geqslant\\>"+e.last.toTexmacs(t):di(e)?i=e.first.toTexmacs(t)+"%":st(e)?i="<sqrt|"+e.first.toTexmacs(t)+">":U(e)?i="<around*|(|"+e.first.toTexmacs(t)+"|)>":ie(e)?i+="+"+e.first.toTexmacs(t):C(e)?i="-"+e.first.toTexmacs(t):Oe(e)?i=e.first.toTexmacs(t)+"-"+e.last.toTexmacs(t):Ee(e)?i=e.first.toTexmacs(t)+"+"+e.last.toTexmacs(t):Se(e)?i=e.first.toTexmacs(t)+"<rsup|"+e.last.toTexmacs(t)+">":nt(e)?i=e.first.toTexmacs(t)+"\\<div\\>"+e.last.toTexmacs(t):$e(e)?i="<dfrac|"+e.first.toTexmacs(t)+"|"+e.last.toTexmacs(t)+">":he(e)?i=e.first.toTexmacs(t)+"\\<times\\>"+e.last.toTexmacs(t):At(e)?i=e.first.toTexmacs(t)+"*"+e.last.toTexmacs(t):Pt(e)?i=e.first.toTexmacs(t)+"\\<cdot\\>"+e.last.toTexmacs(t):rt(e)?i=e.name:ne(e)?e.symbol==="pi"?i="\\<pi\\>":i=e.symbol:M(e)?(i=e.toString({displayUnit:!1}),t.addSpaces&&(i=Xs(i)),i=i.replace(/ /g,"<space|0.17em>").replace(".",",")):me(e)?i="......":y(e)?i="error":i=e.string,e.unit&&(i+="<space|0.17em>"+e.unit.string),i}function Xs(e){let[t,i]=e.replace(/ /g,"").split(".");return t=t.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1 "),i&&(i=i.replace(/\d{3}(?=\d)/g,"$& ")),i?t+"."+i:t}function Br(e,t){let i,r=[Si,ki,Gi,Ti,Ri,xi,Oi,Ei,Nr,Di,$i,Ui,Mi,Fi,Bi,Zi,Hi,zi,Ji,Ii,qi,vi,wi,yt,Mt,Vt,yi,_i,bi,Ks,Pi,Ai,Li,ji,Ni,Ci,tt,Ft,Bt,Vi];if(!(r.includes(e.type)&&r.includes(t.type)))throw new Error(`type ${e.type} forgotten`);if(pe(e)&&pe(t)){let s=e[Symbol.iterator](),n=t[Symbol.iterator](),o=s.next(),a=n.next();for(;!o.done&&!a.done;){let l=o.value,u=a.value,c=l[1],h=u[1];if(pe(c)&&pe(h))i=c.compareTo(h);else if(dt(c)&&dt(h))i=c.compareTo(h);else throw new Error("impossible to compare bases.");if(i!==0)return i;let d=l[0],p=u[0];if(pe(d)&&pe(p)){if(i=d.compareTo(p),i!==0)return i}else if(dt(d)&&dt(p)){if(d.isLowerThan(p))return-1;if(d.isGreaterThan(p))return 1}else throw new Error("unable to compare coefs.");o=s.next(),a=n.next()}return o.done&&a.done?0:o.done?-1:1}else{if(gr(e)&&gr(t))return i=e.n.mult(t.d).compareTo(t.n.mult(e.d)),i===0&&(e.unit&&t.unit?i=e.unit.compareTo(t.unit):e.unit?i=1:t.unit&&(i=-1)),i;if(dt(e)&&dt(t))if(e.type===t.type){if(M(e))return e.value.lt(t.value)?-1:e.value.gt(t.value)?1:0;if(ne(e)||rt(e))return e.string<t.string?-1:e.string>t.string?1:0;if(me(e)||be(e))return 0;if(S(e)&&!St(e)){for(let s=0;s<e.children.length;s++){let n=e.children[s].compareTo(t.children[s]);if(n)return n}return 0}else{if(y(e))return e.message<t.message?-1:e.message>t.message?1:0;if(St(e))return e.first.isSymbol()&&t.first.isSymbol()?e.sign<t.sign?-1:e.sign>t.sign?1:0:e.first.isSymbol()?1:t.first.isSymbol()?-1:e.first.equals(t.first)?e.sign<t.sign?-1:e.sign>t.sign?1:0:e.first.compareTo(t.first);throw new Error(`type ${e.type} forgotten in the compare list`)}}else return r.indexOf(e.type)<r.indexOf(t.type)?-1:1;else throw new Error(`incompatible types to compare ${e} ${t}`)}}var ir={pi:"3.14",e:"2.7"};function ml(e,t,i="x"){let r=()=>"("+t.string+")";return b(e.string.replace(new RegExp(`(${i})(?!p)(?<!e)`,"g"),r)).removeUnecessaryBrackets()}function gl(e,t="x"){let i=e;if(jr(e)&&e.first.string!==t){let r=e.first,s=e.copy([et(t)]).derivate(t);i=r.derivate(t).mult(s.compose(r,t))}else if(M(e))i=_(0);else if(Ee(e))i=e.first.derivate(t).bracket().add(e.last.derivate(t).bracket());else if(Oe(e))i=e.first.derivate(t).bracket().sub(e.last.derivate(t).bracket());else if(C(e))i=e.first.derivate(t).oppose();else if(he(e)||At(e)||Pt(e))i=e.first.derivate(t).mult(e.last).add(e.first.mult(e.last.derivate(t)));else if(nt(e)||$e(e))i=e.first.derivate(t).mult(e.last).sub(e.first.mult(e.last.derivate(t))).frac(e.last.pow(_(2)));else if(ne(e))i=e.string===t?_(1):_(0);else if(Ot(e))i=e.first.derivate(t).mult(e);else if(Ae(e))i=e.first.derivate(t).mult(e.first.inverse());else if(Jt(e))i=e.first.derivate(t).mult(e.first.sin().oppose());else if(zt(e))i=e.first.derivate(t).mult(e.first.cos());else if(Se(e)){let r=e.first,s=e.last,n=r.derivate(t);i=s.derivate(t).mult(r.ln()).add(s.mult(n.frac(r))).mult(r.pow(s))}else st(e)&&(i=e.first.derivate(t).frac(_(2).mult(e.first.radical())));return i.normal.node}function vl(e){let t=S(e)?e.copy(e.children.map(i=>i.reduceFractions())):e;return t.isNumeric()&&$e(t)&&(M(t.first)||C(t.first)&&M(t.first.first)||U(t.first)&&(M(t.first.first)||C(t.first.first)&&M(t.first.first.first)))&&(M(t.last)||C(t.last)&&M(t.last.first)||U(t.last)&&(M(t.last.first)||C(t.last.first)&&M(t.last.first.first)))&&(t=t.reduce()),t=b(t.string),t.unit=e.unit,t}function wl(e){let t=S(e)?e.copy(e.children.map(i=>i.removeZerosAndSpaces())):b(e.string);return M(e)&&(t=t.eval({decimal:!0})),t.unit=e.unit,t}function yl(e){let t=S(e)?e.copy(e.children.map(i=>i.removeMultOperator())):b(e.string);return he(e)&&(jr(e.last)||U(e.last)||ne(e.last)||Se(e.last)&&ne(e.last.first))&&(t=Hr([e.first,e.last])),t.unit=e.unit,t}function _l(e){let t;if(Ee(e)){let i=e.first.removeNullTerms(),r=e.last.removeNullTerms();i.equalsZero()&&r.equalsZero()?t=_(0):i.equalsZero()?t=b(r.string):r.equalsZero()?t=b(i.string):t=i.add(r)}else if(Oe(e)){let i=e.first.removeNullTerms(),r=e.last.removeNullTerms();i.equalsZero()&&r.equalsZero()?t=_(0):i.equalsZero()?t=b(r.string).oppose():r.equalsZero()?t=b(i.string):t=i.sub(r)}else S(e)?t=e.copy(e.children.map(i=>i.removeNullTerms())):t=b(e.string);return t.unit=e.unit,t}function bl(e){let t;if(he(e)){let i=e.first.removeFactorsOne(),r=e.last.removeFactorsOne();i.isOne()&&r.isOne()?t=_(1):i.isOne()?(t=r,U(t)&&(t=t.first)):r.isOne()?(t=i,U(t)&&(t=t.first)):t=e.copy([i,r])}else S(e)?t=e.copy(e.children.map(i=>i.removeFactorsOne())):t=b(e.string);return e.unit&&!t.unit&&(t.unit=e.unit),t}function Tl(e){let t=S(e)?e.copy(e.children.map(i=>i.simplifyNullProducts())):b(e.string);return he(e)&&t.factors.some(i=>i.isZero())&&(t=_(0)),t.unit=e.unit,t}function kl(e,t=!1){let i;return U(e)&&(!e.parent||e.parent.isFunction()||e.parent.isBracket()||e.first.isFunction()||e.first.isHole()||e.first.isNumber()||e.first.isSymbol()||e.parent.isSum()&&e.first.isSum()||e.parent.isSum()&&e.first.isDifference()||e.parent.isSum()&&e.first.isProduct()||e.parent.isSum()&&e.first.isQuotient()||e.parent.isSum()&&e.first.isDivision()||e.parent.isSum()&&e.first.isPower()||e.parent.isOpposite()&&e.first.isProduct()||e.parent.isOpposite()&&e.first.isQuotient()||e.parent.isOpposite()&&e.first.isDivision()||e.parent.isDifference()&&e.first.isSum()&&e.isFirst()||e.parent.isDifference()&&e.first.isDifference()&&e.isFirst()||e.parent.isDifference()&&e.first.isProduct()||e.parent.isDifference()&&e.first.isQuotient()||e.parent.isDifference()&&e.first.isDivision()||e.parent.isDifference()&&e.first.isPower()||e.parent.isProduct()&&e.first.isProduct()||e.parent.isProduct()&&e.first.isQuotient()&&e.isFirst()||e.parent.isProduct()&&e.first.isDivision()||e.parent.isProduct()&&e.first.isPower()||e.parent.isQuotient()&&e.first.isProduct()&&e.isFirst()||e.parent.isQuotient()&&e.first.isQuotient()&&e.isFirst()||e.parent.isQuotient()&&e.first.isDivision()&&e.isFirst()||e.parent.isQuotient()&&e.first.isPower()||e.parent.isDivision()&&e.first.isProduct()&&e.isFirst()||e.parent.isDivision()&&e.first.isQuotient()&&e.isFirst()||e.parent.isDivision()&&e.first.isDivision()&&e.isFirst()||e.parent.isDivision()&&e.first.isPower()||e.parent.isPower()&&e.first.isPower()&&e.isFirst()||e.parent.isPower()&&e.isLast()||!t&&e.parent.isSum()&&e.first.isOpposite()&&e.isFirst()||!t&&e.parent.isSum()&&e.first.isPositive()&&e.isFirst()||!t&&e.parent.isDifference()&&e.first.isOpposite()&&e.isFirst()||!t&&e.parent.isDifference()&&e.first.isPositive()&&e.isFirst()||e.parent.isEquality()||e.parent.isUnequality()||e.parent.isInequality()||e.parent.isProduct()&&e.first.isQuotient()&&e.isLast()||e.parent.isQuotient()&&e.first.isProduct()&&e.isLast()||e.parent.isQuotient()&&e.first.isQuotient()&&e.isLast()||e.parent.isQuotient()&&e.first.isDivision()&&e.isLast()||e.parent.isQuotient()&&e.first.isOpposite()||e.parent.isQuotient()&&e.first.isSum()||e.parent.isQuotient()&&e.first.isDifference())?i=e.first.removeUnecessaryBrackets(t):S(e)?i=e.copy(e.children.map(r=>r.removeUnecessaryBrackets(t))):i=b(e.string),i.unit=e.unit,i}function Sl(e){let t=e.terms;Ki(t);let i=t.pop(),r=i.op==="+"?i.term:i.term.oppose();return t.forEach(s=>{r=s.op==="+"?r.add(s.term):r.sub(s.term)}),r.unit=e.unit,r}function El(e){let t=S(e)?e.copy(e.children.map(s=>s.shuffleTerms())):b(e.string),i=t.terms;Ki(i);let r=i.pop();return t=r.op==="+"?r.term:r.term.oppose(),i.forEach(s=>{t=s.op==="+"?t.add(s.term):t.sub(s.term)}),t.unit=e.unit,t}function Ol(e){let t=e.factors;Ki(t);let i=t.pop();return t.forEach(r=>i=i.mult(r)),i.unit=e.unit,i}function xl(e){let t=S(e)?e.copy(e.children.map(r=>r.shuffleFactors())):b(e.string),i=e.factors;return Ki(i),t=i.pop(),i.forEach(r=>t=t.mult(r)),t.unit=e.unit,t}function $l(e){let t=S(e)?e.copy(e.children.map(i=>i.shuffleTermsAndFactors())):b(e.string);return t.isProduct()?t=t.shallowShuffleFactors():(t.isSum()||t.isDifference())&&(t=t.shallowShuffleTerms()),t.unit=e.unit,t}function Pl(e){let t=e;if(e.isSum()||e.isDifference()){let i=e.terms,r=i.filter(o=>o.op==="+").map(o=>o.term).sort((o,a)=>o.compareTo(a)),s=r.length,n=i.filter(o=>o.op==="-").map(o=>o.term).sort((o,a)=>o.compareTo(a));r.length&&(t=r.shift(),r.forEach(o=>t=t.add(o))),n.length&&(s||(t=n.shift().oppose()),n.forEach(o=>t=t.sub(o))),t.unit=e.unit}return t}function Al(e){let t=S(e)?e.copy(e.children.map(i=>i.sortTerms())):b(e.string);return(e.isSum()||e.isDifference())&&(t=t.shallowSortTerms()),t.unit=e.unit,t}function Ll(e){let t;if(e.isProduct()){let i=e.factors;i.sort((r,s)=>r.compareTo(s)),t=i.shift(),i.forEach(r=>t=t.mult(r)),t.unit=e.unit}else t=e;return t}function jl(e){let t=S(e)?e.copy(e.children.map(i=>i.sortFactors())):b(e.string);return e.isProduct()&&(t=t.shallowSortFactors()),t.unit=e.unit,t}function Nl(e){let t=S(e)?e.copy(e.children.map(i=>i.sortTermsAndFactors())):b(e.string);return e.isSum()||e.isDifference()?t=t.shallowSortTerms():e.isProduct()&&(t=t.shallowSortFactors()),t.unit=e.unit,t}function Cl(e){let t=e.parent,i=S(e)?e.copy(e.children.map(r=>r.removeSigns())):b(e.string);if(he(i)||nt(i)||$e(i)){let r,s,n=!1;U(i.first)&&C(i.first.first)?(r=i.first.first.first,n=!n):U(i.first)&&ie(i.first.first)?r=i.first.first.first:$e(i)&&C(i.first)?(r=i.first.first,n=!n):r=i.first,U(i.last)&&C(i.last.first)?(s=i.last.first.first,n=!n,s.isNumber()||s.isSymbol()||(s=s.bracket())):U(i.last)&&ie(i.last.first)?s=i.last.first.first:$e(i)&&C(i.last)?(s=i.last.first,n=!n):s=i.last,i.isProduct()?i=i.copy([r,s]):i.isDivision()?i=r.div(s):i=r.frac(s),n&&(i=i.oppose()),n&&t&&!(t.isBracket()||t.isQuotient()||t.isPower()&&i.isLast())&&(i=i.bracket())}else Ee(i)&&U(i.last)&&C(i.last.first)?i=i.first.sub(i.last.first.first):Ee(i)&&U(i.last)&&ie(i.last.first)||Oe(i)&&U(i.last)&&C(i.last.first)?i=i.first.add(i.last.first.first):Oe(i)&&U(i.last)&&ie(i.last.first)?i=i.first.sub(i.last.first.first):ie(i)&&U(i.first)&&C(i.first.first)?i=i.first.first:ie(i)&&U(i.first)&&ie(i.first.first)?i=i.first.first.first:C(i)&&U(i.first)&&C(i.first.first)?i=i.first.first.first.positive():C(i)&&U(i.first)&&ie(i.first.first)?i=i.first.first.first.oppose():U(i)&&ie(i.first)&&(t&&(t.isQuotient()||t.isDivision())&&e.isLast()&&(i.first.first.isQuotient()||i.first.first.isDivision())?i=i.first.first.bracket():i=i.first.first);return(!t||!t.isBracket())&&ie(i)&&(i=i.first),i=b(i.string),i.unit=e.unit,i.parent=t,i}function vr(e,t){let i=e;if(!t)return i;if(ne(e)){if(!ir[e.symbol]&&!t[e.symbol])return i;ir[e.symbol]?i=b(ir[e.symbol]):(i=b(t[e.symbol]),i=vr(i,t))}else S(e)?i=e.copy(e.children.map(r=>vr(r,t))):i=b(e.string);return i.unit=e.unit,i}function Dl(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e}function Je(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function rr(e,t,i=!0){function r(){return Dl(e===0?0:Math.pow(10,e-1),t===0?0:Math.pow(10,Je(e,t)))}let s=r();if(!i&&t!==0)for(;s%10===0;)s=r();return s}function hs(e,t,i){return i.value.gte(e.value)&&t.value.lte(e.value)}function mt(e){let t=e.nature==="$$",i=e.precision,r,s,n,o,a,l;switch(e.nature){case"$e":case"$ep":case"$ei":{let u=!1,c=e.children.map(g=>be(g)?mt(g):Ke(Object.assign(g.substitute(),{parent:e})).eval({decimal:t,precision:i})),h=e.excludeMin,d=e.excludeMax,p=e.excludeDivider,w=e.excludeMultiple,v=e.exclude?e.exclude.map(g=>be(g)?mt(g):Ke(Object.assign(g.substitute(),{parent:e})).eval({decimal:t,precision:i})):null,f=e.excludeCommonDividersWith?e.excludeCommonDividersWith.map(g=>be(g)?mt(g):Ke(Object.assign(g.substitute(),{parent:e})).eval({decimal:t,precision:i})):null;do u=!1,c[1].isHole()?(r=_(Je(C(c[2])?c[2].first.value.toNumber()*-1:c[2].value.toNumber(),C(c[3])?c[3].first.value.toNumber()*-1:c[3].value.toNumber())),e.relative&&!r.isZero()&&(Je(0,1)?r=r.oppose():e.signed&&(r=r.positive())),u=!!v&&v.map(g=>g.string).includes(r.string)||!!h&&hs(r,h,d)):(r=_(rr(me(c[0])?1:c[0].value.toNumber(),c[1].value.toNumber())),e.relative&&!r.isZero()&&(Je(0,1)?r=r.oppose():e.signed&&(r=r.positive())),u=!!v&&v.map(g=>g.string).includes(r.string)),w&&(u=u||w.some(g=>r.value.mod(g.eval().value).equals(0))),p&&(u=u||p.some(g=>g.eval().value.mod(r.value).equals(0))),f&&(u=u||f.some(g=>{let k=g.generate().eval(),x=C(k)?k.first.value.toNumber():k.value.toNumber(),P=r.generate().eval(),E=C(P)?P.first.value.toNumber():P.value.toNumber();return Qs(x,E)!==1}));while(u);e.root.generated.push(r);break}case"$d":{let u=e.children.map(c=>be(c)?mt(c):Ke(Object.assign(c.substitute(),{parent:e})).eval({decimal:t,precision:i}));if(u[0])o=u[0].generate().value.toNumber(),n=u[1].generate().value.toNumber(),s=new J(rr(o,o)),s=s.add(new J(rr(n,n,!1)).div(Math.pow(10,n)));else{let c=u[2].generate().value.toNumber(),h=u[3].generate().value.toNumber(),d=u[4].generate().value.toNumber(),p=u[5].generate().value.toNumber();o=Je(c,h),n=Je(d,p),s=new J(o).div(Math.pow(10,n))}r=_(s),e.relative&&Je(0,1)&&(r=r.oppose()),e.root.generated.push(r);break}case"$l":{l=e.children;let u=!1;if(e.exclude){let c=e.exclude.map(h=>h.eval().string);l=l.filter(h=>!c.includes(h.string))}do u=!1,r=l[Math.floor(Math.random()*l.length)],u=!!e.excludeMin&&hs(r,e.excludeMin,e.excludeMax),e.excludeMultiple&&(u=u||e.excludeMultiple&&e.excludeMultiple.some(c=>r.value.mod(c.eval().value).isZero())),e.excludeDivider&&(u=u||e.excludeDivider&&e.excludeDivider.some(c=>c.eval().value.mod(r.value).isZero()));while(u);r=r.generate(),e.root.generated.push(r);break}case"$":case"$$":{r=e.children.map(u=>be(u)?mt(u):Ke(Object.assign(u.substitute(),{parent:e})).eval({decimal:t,precision:i}))[0],e.root.generated.push(r);break}default:a=parseInt(e.nature.slice(1,e.nature.length),10),r=e.root.generated[a-1]}return e.unit&&(r.unit=e.unit),r}function Ke(e){let t=e;return be(e)?t=mt(e):ne(e)||me(e)||M(e)||y(e)||$t(e)?t=e:S(e)&&(t=e.copy(e.children.map(i=>Ke(i)))),t}var Il={mult(e){return Q(this.u.mult(e.u,Vt),this.normal().mult(e.normal()))},div(e){return Q(this.u.div(e.u),this.normal().div(e.normal()))},pow(e){return Q(this.u.pow(e),this.normal().pow(e.normal))},toString(){return this.u.toString({isUnit:!0})},get string(){return this.toString()},isVolume(){return this.isMetricalVolume()||this.isCapacity()},isMetricalVolume(){return this.isConvertibleTo(Q("m").mult(Q("m")).mult(Q("m")))},isCapacity(){return this.isConvertibleTo(Q("L"))},isConvertibleTo(e){return this.normal().isConvertibleTo(e.normal())},getCoefTo(e){return this.normal().getCoefTo(e.normal()).node},equalsTo(e){return this.normal().equalsTo(e.normal())},type:Ks,normal(){return this._normal},get u(){return this._u}};function Q(e,t){if(typeof e=="string"){let r=_(ds[e][0]),s=et(ds[e][1]);t=r.mult(s).normal}let i=Object.create(Il);return Object.assign(i,{_u:typeof e=="string"?et(e):e,_normal:t}),i}var ds={Qr:[1,"Qr"],"k":[1e3,""],"":[1,""],kL:[1e3,"L"],hL:[100,"L"],daL:[10,"L"],L:[1,"L"],dL:[.1,"L"],cL:[.01,"L"],mL:[.001,"L"],km:[1e3,"m"],hm:[100,"m"],dam:[10,"m"],m:[1,"m"],dm:[.1,"m"],cm:[.01,"m"],mm:[.001,"m"],t:[1e6,"g"],q:[1e5,"g"],kg:[1e3,"g"],hg:[100,"g"],dag:[10,"g"],g:[1,"g"],dg:[.1,"g"],cg:[.01,"g"],mg:[.001,"g"],an:[31536e6,"ms"],ans:[31536e6,"ms"],mois:[2592e6,"ms"],semaine:[6048e5,"ms"],semaines:[6048e5,"ms"],jour:[864e5,"ms"],jours:[864e5,"ms"],h:[36e5,"ms"],min:[6e4,"ms"],mins:[6e4,"ms"],s:[1e3,"ms"],ms:[1,"ms"],"":[1,""],noUnit:[1,"noUnit"]},ql={isUnit:!1,formatTime:!1},Zr={type:Ft,children:[],[Symbol.iterator](){return this.children[Symbol.iterator]()},compareTo(e){return Br(this,e)},equalsTo(e){return this.string===e.string},merge(e){let t,i=this.children.filter(r=>!r[0].isZero());for(let r of e){let s=r[1],n=r[0];if(n.isZero())continue;let o=i.map(a=>a[1]);if(t=o.length>0?rl(o,s,(a,l)=>(pe(a),a.compareTo(l))):-1,t<0)i.splice(~t,0,r);else{let a=i[t][0],l;if(pe(a))l=a.merge(n);else{let u=_t(a.string).add(_t(n.string)).reduce();l=b(u.toString())}l.isZero()?i.splice(t,1):i[t]=[l,s]}}return this.createList(this.type,i)},createList(e,t){return e===Ft?T(t):si(t)},symmetrize(){let e=function(t){let i=t[0],r=t[1],s;return i.isZero()?t:(pe(i)?s=i.oppose():s=C(i)?i.first:i.oppose(),[s,r])};return this.createList(this.type,this.children.map(e))},get string(){return this.toString()},toString(e){return this.node.toString(e)},isOne(){return this.node.isOne()},isZero(){return this.node.isZero()},isMinusOne(){return this.node.isMinusOne()},isInt(){return this.node.isInt()},isOpposite(){return this.node.isOpposite()},get first(){return this.children[0]},get last(){return this.children[this.children.length-1]},get length(){return this.children.length},get node(){return this.toNode()},toNode(){let e=function([i,r]){let s=r;return i.string==="1/2"?s=Jr([r]):!r.isOne()&&!i.isOne()&&(s.isOpposite()&&(s=s.bracket()),s=s.pow(i)),s},t;if(this.type===Bt){t=_(1);for(let i=0;i<this.children.length;i++){let r=this.children[i][0],s=this.children[i][1],n=e([r,s]);(n.isOpposite()||n.isSum()||n.isDifference())&&(n=n.bracket()),i===0?t=n:n.isOne()||(t=t.mult(n))}}else{t=_(0);for(let i=0;i<this.children.length;i++){let r=this.children[i],s=pe(r[0])?r[0].node:r[0],n=r[1].node,o,a=!1;n.isOne()?o=s:s.isOne()?o=n:s.isMinusOne()?(a=!0,o=n):C(s)?(a=!0,s.first.isSum()||s.first.isDifference()?o=s.first.bracket().mult(n):o=s.first.mult(n)):((s.isSum()||s.isDifference())&&(s=s.bracket()),o=s.mult(n)),i===0?t=a?o.oppose():o:t=a?t.sub(o):t.add(o)}}return t},mult(e){let t=[];if(this.type===Bt)return t=t.concat(this.merge(e).children),t=t.filter(i=>!i[1].isOne()),si(t);for(let i of this)for(let r of e){let s=[],n=i[0],o=i[1],a=r[0],l=r[1];for(let[c,h]of n)for(let[d,p]of a){let w=parseInt(c.string)*parseInt(d.string),v=w<0,f=_(Math.abs(w)),g=h.mult(p);M(g.node)&&!g.node.isOne()&&(f=_(f.value.mul(g.node.value)),g=G()),v&&(f=f.oppose()),s.push([f,g])}let u=xe(_(0)).merge(T(s));t.push([u,o.mult(l)])}return tn().merge(T(t))},add(e){return this.merge(e)},sub(e){return this.merge(e.oppose())},oppose(){return this.symmetrize()},invert(){return this.symmetrize()},div(e){return this.frac(e)},frac(e){return this.mult(e.invert())}},fs=Object.create(Zr),en={type:Fr,get n(){return this._n},get d(){return this._d},isDefined(){return this.type!==tt},isZero(){return this.isDefined()&&this.n.isZero()},isInt(){return this.isDefined()&&this.node.isInt()},isOne(){return this.isDefined()&&this.node.isOne()},isProduct(){return this.isDefined()&&this.node.isProduct()},isPower(){return this.isDefined()&&this.node.isPower()},isDivision(){return this.isDefined()&&this.node.isDivision()},isQuotient(){return this.isDefined()&&this.node.isQuotient()},isOpposite(){return this.isDefined()&&this.node.isOpposite()},isMinusOne(){return this.isDefined()&&this.node.isMinusOne()},isNumeric(){return this.isDefined()&&this.node.isNumeric()},isDuration(){return this.isDefined()&&!!this.unit&&this.unit.isConvertibleTo(Q("s").normal())},isLength(){return this.isDefined()&&!!this.unit&&this.unit.isConvertibleTo(Q("m").normal())},isMass(){return this.isDefined()&&!!this.unit&&this.unit.isConvertibleTo(Q("g").normal())},isConvertibleTo(e){let t=T([[xe(_(1)),this.n.first[1]]]),i=T([[xe(_(1)),this.d.first[1]]]),r=te(t,i),s=T([[xe(_(1)),e.n.first[1]]]),n=T([[xe(_(1)),e.d.first[1]]]),o=te(s,n);return r.equalsTo(o)||r.string==="m^3"&&o.string==="L"||r.string==="L"&&o.string==="m^3"},isSameQuantityType(e){return this.isDefined()&&e.isDefined()&&(!this.unit&&!e.unit||!!this.unit&&!!e.unit&&this.unit.isConvertibleTo(e.unit))},getCoefTo(e){let t=T([[this.n.first[0],G()]]),i=T([[this.d.first[0],G()]]),r=te(t,i),s=T([[e.n.first[0],G()]]),n=T([[e.d.first[0],G()]]),o=te(s,n),a=T([[q(),this.n.first[1]]]),l=T([[q(),this.d.first[1]]]),u=te(a,l),c=T([[q(),e.n.first[1]]]),h=T([[q(),e.d.first[1]]]),d=te(c,h),p=r.div(o);return u.string==="L"&&d.string==="m^3"?p=p.mult(b(.001).normal):d.string==="L"&&u.string==="m^3"&&(p=p.mult(b(1e3).normal)),p},reduce(){if(!this.isDefined())return this;function e(l){let u=new J(0);return l.children.forEach(c=>{let h=c[0],d;pe(h)?d=e(h):d=C(h)?h.first.value:h.value,u=u.isZero()?d:Zt([u,d])}),u}function t(l,u){let c=l.children.map(h=>{let d=h[0],p=h[1],w;return pe(d)?(d=t(d,u),w=[d,p]):w=C(d)?[_(d.first.value.div(u)).oppose(),p]:[_(d.value.div(u)),p],w});return T(c)}let i=e(this.n),r=e(this.d),s=Zt([i,r]),n=t(this.n,s),o=t(this.d,s),a=!1;return n.node.isOpposite()&&(a=!0,n=n.oppose()),o.node.isOpposite()&&(a=!a,o=o.oppose()),a&&(n=n.oppose()),te(n,o,this.unit)},add(e){if(!this.isDefined())return this;if(!e.isDefined())return e;if(!this.isSameQuantityType(e))throw new Error("Erreur d'unit");return te(this.n.mult(e.d).add(e.n.mult(this.d)),this.d.mult(e.d),this.unit).reduce()},sub(e){if(!this.isDefined())return this;if(!e.isDefined())return e;if(e.unit&&this.unit&&!e.unit.equalsTo(this.unit)||this.unit&&!e.unit||!this.unit&&e.unit)throw new Error("Erreur d'unit");return te(this.n.mult(e.d).sub(e.n.mult(this.d)),this.d.mult(e.d),this.unit).reduce()},mult(e){let t=ps(e);if(!this.isDefined())return this;if(!t.isDefined())return t;let i;return this.unit&&t.unit?i=this.unit.mult(t.unit):this.unit?i=this.unit:i=t.unit,i&&i.string==="1"&&(i=void 0),te(this.n.mult(t.n),t.d.mult(this.d),i).reduce()},div(e){return this.isDefined()?e.isDefined()?e.equalsTo(0)?wr("Division by zero"):this.mult(e.invert()):e:this},pow(e){if(!this.isDefined())return this;if(!e.isDefined())return e;if(e.isZero())return Ul(this.unit);if(e.isOne())return this;if(this.isZero())return this;if(this.isOne())return this;if(e.isMinusOne())return this.invert();let t;if(we(e.node)){let i=e.node.value.toNumber();if(t=this.mult(this),i>=3)for(let r=1;r<i-1;r++)t=t.mult(this)}else if(C(e.node)&&we(e.node.first)){let i=e.node.first.value.toNumber();if(t=this.mult(this),i>=3)for(let r=1;r<i-1;r++)t=t.mult(this);t=t.invert()}else if(he(this.node)){let i=this.node.factors.map(r=>r.normal);t=i.shift().pow(e),i.forEach(r=>{t=t.mult(r.pow(e))})}else if(this.isQuotient()||this.isDivision())t=this.n.node.normal.pow(e).div(this.d.node.normal.pow(e));else if(Se(this.node)){let i=this.node.last.mult(e.node).eval();t=this.node.first.normal.pow(i.normal)}else if(e.equalsTo(_(.5).normal)&&we(this.node))if(this.node.value.sqrt().isInt())t=_(this.node.value.sqrt()).normal;else{let i=this.node.value.toNumber(),r=sl(i);if(r===1){let s=T([[_(1),R(this.node,e.node)]]),n=T([[s,G()]]),o=q();t=te(n,o)}else t=_(r).mult(_(i/(r*r)).pow(_(.5))).normal}else if(C(e.node)&&e.node.first.equals(_(.5))&&we(this.node)&&this.node.value.sqrt().isInt())t=_(this.node.value.sqrt().toNumber()).normal.invert();else{let i,r;if(this.isNumeric()&&e.isNumeric()){let s=T([[_(1),R(this.node,e.node)]]);i=T([[s,G()]]),r=q()}else i=T([[K(),R(this.node,e.node)]]),r=q();t=te(i,r)}return t},oppose(){return this.isDefined()?te(this.n.oppose(),this.d,this.unit):this},invert(){if(!this.isDefined())return this;let e=this.unit?this.unit.invert():void 0,t,i;if(this.n.length===1){let r=this.n.first[0];i=T([[r,G()]]);let s=this.n.first[1].symmetrize();t=T([[K(),s]])}else t=q(),i=this.n;return t=t.mult(this.d),te(t,i,e).reduce()},compareTo(e){return this.isDefined()?e.isDefined()?Br(this,e):-1:1},get node(){return this.toNode()},toNode({formatTime:e}=ql){if(!this.isDefined())return yn(this.error);let t,i=this.n.node,r=this.d.node;if(r.isOne())t=i;else{let s=!0;C(i)&&(s=!1,i=i.first),t=i.frac(r),s||(t=t.oppose())}if(this.unit)if(e){let s="",n=t.value.toNumber(),o=Math.floor(n/31536e6);o&&(s+=o+" ans "),n=n%31536e6;let a=Math.floor(n/864e5);a&&(s+=a+" jours "),n=n%864e5;let l=Math.floor(n/36e5);l&&(s+=l+" h "),n=n%36e5;let u=Math.floor(n/6e4);u&&(s+=u+" min "),n=n%6e4;let c=Math.floor(n/1e3);c&&(s+=c+" s "),n=n%1e3,n&&(s+=n+" ms "),t=b(s)}else t.unit=b("1"+this.unit.toNode({isUnit:!0}).toString({isUnit:!0})).unit;return t},get string(){return this.node.string},equalsTo(e){if(!this.isDefined())return!1;let t=ps(e);return t.isDefined()?this.n.mult(t.d).equalsTo(this.d.mult(t.n)):!1}};function wr(e){return Object.assign(Object.create(en),{type:tt,error:e})}function te(e,t,i){let r=Object.create(en);return t||(t=q()),Object.assign(r,{_n:e,_d:t,unit:i,type:Fr}),r}function G(){return si([[_(1),_(1)]])}function xe(e){return T([[e,G()]])}function K(){return xe(_(1))}function Rl(){return xe(_(0))}function q(){return T([[K(),G()]])}function tn(){return T([[Rl(),G()]])}function Ul(e){return te(q(),q(),e)}function si(e){let t=Object.create(Zr);return Object.assign(t,{type:Bt,children:!e||e.length===0?[[_(1),_(1)]]:e}),t}function T(e){let t=Object.create(Zr);return Object.assign(t,{type:Ft,children:!e||e.length===0?tn().children:e}),t}function R(e,t){return si([[t||_(1),e]])}function rn(e){let t=fs,i=fs,r=null;if(y(e))r=wr("Incorrect expression");else if(St(e))i=T([[K(),R(e)]]),t=q();else if(mi(e)){let s=e.children.map(n=>n.normal);for(r=s.pop();s.length;)r=r.add(s.pop())}else if(wt(e))i=T([[K(),R(e)]]),t=q();else if(M(e))e.isInt()?(i=T([[xe(_(e.value)),G()]]),t=q()):r=b(_t(e).toString()).normal;else if(Se(e))r=e.first.normal.pow(e.last.normal);else if(st(e))r=e.first.normal.pow(_(.5).normal);else if(Jt(e)){let s=e.children[0].normal,n=s.node;if(s.equalsTo(0)||s.equalsTo("2pi"))r=b(1).normal;else if(s.equalsTo("pi")||s.equalsTo("-pi"))r=b(-1).normal;else if(s.equalsTo("pi/2")||s.equalsTo("-pi/2"))r=b(0).normal;else if(s.equalsTo("pi/3")||s.equalsTo("-pi/3"))r=b(.5).normal;else if(s.equalsTo("2pi/3")||s.equalsTo("-2pi/3"))r=b(-.5).normal;else if(s.equalsTo("pi/4")||s.equalsTo("-pi/4"))r=b("sqrt(2)/2").normal;else if(s.equalsTo("3pi/4")||s.equalsTo("-3pi/4"))r=b("-sqrt(2)/2").normal;else if(s.equalsTo("pi/6")||s.equalsTo("-pi/6"))r=b("sqrt(3)/2").normal;else if(s.equalsTo("5pi/6")||s.equalsTo("-5pi/6"))r=b("-sqrt(3)/2").normal;else{let o=e.copy([n]);if(t=q(),n.isNumeric()){let a=T([[_(1),R(o)]]);i=T([[a,G()]])}else i=T([[K(),R(o)]])}}else if(zt(e)){let s=e.children[0].normal,n=s.node;if(s.equalsTo(0)||s.equalsTo("2pi")||s.equalsTo("pi")||s.equalsTo("-pi"))r=b(0).normal;else if(s.equalsTo("pi/2"))r=b(1).normal;else if(s.equalsTo("-pi/2"))r=b(-1).normal;else if(s.equalsTo("pi/6")||s.equalsTo("5pi/6"))r=b(.5).normal;else if(s.equalsTo("-pi/6")||s.equalsTo("-5pi/6"))r=b(-.5).normal;else if(s.equalsTo("pi/4")||s.equalsTo("3pi/4"))r=b("sqrt(2)/2").normal;else if(s.equalsTo("-pi/4")||s.equalsTo("-3pi/4"))r=b("-sqrt(2)/2").normal;else if(s.equalsTo("pi/3")||s.equalsTo("2pi/3"))r=b("sqrt(3)/2").normal;else if(s.equalsTo("-pi/3")||s.equalsTo("-2pi/3"))r=b("-sqrt(3)/2").normal;else{let o=e.copy([n]);if(t=q(),n.isNumeric()){let a=T([[_(1),R(o)]]);i=T([[a,G()]])}else i=T([[K(),R(o)]])}}else if(fi(e)){let s=e.children[0].normal,n=s.node;if(s.equalsTo(0))r=b(0).normal;else if(s.equalsTo("pi/6"))r=b("1/sqrt(3)").normal;else if(s.equalsTo("-pi/6"))r=b("-1/sqrt(3)").normal;else if(s.equalsTo("pi/4"))r=b(1).normal;else if(s.equalsTo("-pi/4"))r=b("-1").normal;else if(s.equalsTo("pi/3"))r=b("sqrt(3)").normal;else if(s.equalsTo("-pi/3"))r=b("-sqrt(3)").normal;else{let o=e.copy([n]);if(t=q(),n.isNumeric()){let a=T([[_(1),R(o)]]);i=T([[a,G()]])}else i=T([[K(),R(o)]])}}else if(Ae(e)){let s=e.children[0].normal,n=s.node;if(Ot(n))r=n.first.normal;else if(Se(n))r=n.last.mult(n.first.ln()).normal;else if(s.equalsTo(1))r=b(0).normal;else if(s.equalsTo("e"))r=b(1).normal;else if(we(n)){let o=n.value.toNumber(),a=cs(o);if(a.length===1&&a[0][1]===1){let l=e.copy([n]),u=T([[_(1),R(l)]]);i=T([[u,G()]]),t=q()}else r=b(0).normal,r=r.add(_(0).normal),a.forEach(l=>{let[u,c]=l,h=b(`${c}*ln(${u})`).normal;r=r.add(h)})}else{let o=e.copy([n]);if(t=q(),n.isNumeric()){let a=T([[_(1),R(o)]]);i=T([[a,G()]])}else i=T([[K(),R(o)]])}}else if(Ot(e)){let s=e.first,n=s.normal;if(he(s)&&(Ae(s.first)||Ae(s.last)))Ae(s.first)?r=s.first.first.pow(s.last).normal:r=s.last.first.pow(s.first).normal;else if(Ae(s))r=s.first.normal;else if(n.equalsTo(0))r=b(1).normal;else{let o=e.copy([n.node]);if(t=q(),s.isNumeric()){let a=T([[_(1),R(o)]]);i=T([[a,G()]])}else i=T([[K(),R(o)]])}}else if(Gt(e)){let s=e.first,n=s.normal;if(s.isNumeric())s.isLowerThan(0)?r=n.mult(-1):r=n;else{let o=e.copy([s]);t=q(),i=T([[K(),R(o)]])}}else if(pi(e)){let s=e.children[0].normal,n=s.node;if(Se(n))r=n.last.mult(n.first.log()).normal;else if(s.equalsTo(1))r=b(0).normal;else if(s.equalsTo(10))r=b(1).normal;else if(we(n)){let o=n.value.toNumber(),a=cs(o);if(a.length===1&&a[0][1]===1){let l=e.copy([n]),u=T([[_(1),R(l)]]);i=T([[u,G()]]),t=q()}else r=b(0).normal,a.forEach(l=>{let[u,c]=l,h=b(`${c}*log(${u})`).normal;r=r.add(h)})}else{let o=e.copy([n]);if(t=q(),n.isNumeric()){let a=T([[_(1),R(o)]]);i=T([[a,G()]])}else i=T([[K(),R(o)]])}}else if(Pr(e)){let s=e.children[0].normal.node;if(s.isNumeric())r=_(s.eval({decimal:!0}).value.floor()).normal;else{let n=e.copy([s]);t=q(),i=T([[K(),R(n)]])}}else if(Ar(e)){let s=e.children.map(a=>a.normal.node),n=s[0],o=s[1];if(e.isNumeric())if(C(n)&&n.first.isInt()&&(n=n.first),C(o)&&o.first.isInt()&&(o=o.first),we(n)&&we(o))r=_(Qs(n.value.toNumber(),o.value.toNumber())).normal;else{let a=e.copy(s),l=T([[_(1),R(a)]]);i=T([[l,G()]]),t=q()}else{let a=e.copy(s);i=T([[K(),R(a)]]),t=q()}}else if(Lr(e)){let s=e.children.map(a=>a.normal.node),n=s[0],o=s[1];if(e.isNumeric())if((we(n)||C(n)&&n.first.isInt())&&(we(o)||C(o)&&o.first.isInt()))r=_(new J(n.string).mod(new J(o.string))).normal;else{let a=e.copy(s),l=T([[_(1),R(a)]]);i=T([[l,G()]]),t=q()}else{let a=e.copy(s);i=T([[K(),R(a)]]),t=q()}}else if(xr(e)||Ut(e)){let s=e.children.map(a=>a.normal.node),n=s[0],o=s[1];if(e.isNumeric())r=n.isLowerThan(o)?n.normal:o.normal;else{let a=e.copy(s);i=T([[K(),R(a)]]),t=q()}}else if($r(e)||hi(e)){let s=e.children.map(a=>a.normal.node),n=s[0],o=s[1];if(e.isNumeric())r=n.isGreaterThan(o)?n.normal:o.normal;else{let a=e.copy(s);i=T([[K(),R(a)]]),t=q()}}else if(di(e))r=e.first.div(_(100)).normal;else if(me(e))i=T([[K(),R(e)]]),t=q();else if(rt(e))i=T([[K(),R(e)]]),t=q();else if(ne(e))i=T([[K(),R(et(e.toString({displayUnit:!1})))]]),t=q();else if(U(e)||ie(e))r=rn(e.first);else if(C(e))r=e.first.normal,r.node.isZero()||(r=r.oppose());else if(Ee(e)){r=e.children[0].normal;for(let s=1;s<e.children.length;s++)r=r.add(e.children[s].normal)}else if(he(e)||At(e)||Pt(e)){r=_(1).normal;for(let s=0;s<e.children.length;s++)r=r.mult(e.children[s].normal)}else if(Oe(e))r=e.first.normal.sub(e.last.normal);else if(nt(e)||$e(e))r=e.first.normal.div(e.last.normal);else if(ci(e)){let s=!0;e.ops.forEach((n,o)=>{let a=b(e.children[o].string+n+e.children[o+1]);s=s&&a.eval().boolvalue}),r=Ce(s).normal}else gi(e)?r=Ce(!e.first.eval().equals(e.last.eval())).normal:Et(e)?r=Ce(e.first.eval().equals(e.last.eval())).normal:Qe(e)?r=Ce(e.first.eval().isLowerThan(e.last.eval())).normal:Ye(e)?r=Ce(e.first.eval().isGreaterThan(e.last.eval())).normal:We(e)?r=Ce(e.first.eval().isLowerOrEqual(e.last.eval())).normal:Xe(e)?r=Ce(e.first.eval().isGreaterOrEqual(e.last.eval())).normal:be(e)?(i=T([[K(),R(e)]]),t=q()):r=wr("Impossible to normalize "+e.string);if(r||(r=te(i,t)),e.unit){let s=e.unit.normal(),n=T([[s.n.first[0],G()]]),o=T([[s.d.first[0],G()]]),a=te(n,o),l=T([[xe(_(1)),s.n.first[1]]]),u=T([[xe(_(1)),s.d.first[1]]]);s=te(l,u),r=r.mult(a),s.string!=="1"&&(r.unit=s)}return r}function ps(e){let t;return typeof e=="string"||typeof e=="number"||J.isDecimal(e)?t=b(e).normal:t=e,t}J.set({toExpPos:89,toExpNeg:-89});var Ml={isUnit:!1,displayUnit:!0,comma:!1,addBrackets:!1,implicit:!1},Fl={addBrackets:!1,implicit:!1,addSpaces:!0,keepUnecessaryZeros:!1},Bl={addBrackets:!1,implicit:!1,addSpaces:!0,keepUnecessaryZeros:!1},Zl={precision:20,decimal:!1};function Hl(){return{type:il,generated:[],derivate(e="x"){return y(this)?this:gl(this,e)},get normal(){return this._normal||(this._normal=rn(this)),this._normal},compose(e,t="x"){return y(this)?this:ml(this,e,t)},reduce(){if(y(this))return this;let e=this.removeSigns();if(S(e)){let t=e.isOpposite(),i=_t(t?e.first.string:e.string).reduce(),r;return i.n.equals(0)?r=_(0):i.d.equals(1)?r=i.s===1?_(i.n):Ct([_(i.n)]):(r=ei([_(i.n),_(i.d)]),i.s===-1&&(r=Ct([r]))),t&&(C(r)?r=r.first:r=Ct([r])),r}else return this},isCorrect(){return this.type!==tt},isIncorrect(){return this.type===tt},isRelations(){return this.type===Cr},isEquality(){return this.type===Pi},isUnequality(){return this.type===Ai},isInequality(){return this.type===Li||this.type===ji||this.type===Ni||this.type===Ci},isBoolean(){return this.type===Ri},isSum(){return this.type===vi},isDifference(){return this.type===wi},isOpposite(){return this.type===Ei},isPositive(){return this.type===Oi},isProduct(){return this.type===yt||this.type===Mt||this.type===Vt},isDivision(){return this.type===yi},isQuotient(){return this.type===_i},isPower(){return this.type===bi},isRadical(){return this.type===zi},isPGCD(){return this.type===Ii},isMax(){return this.type===Dr},isMaxP(){return this.type===Ir},isMin(){return this.type===qr},isMinP(){return this.type===Rr},isMod(){return this.type===qi},isCos(){return this.type===Ui},isSin(){return this.type===Mi},isTan(){return this.type===Fi},isLn(){return this.type===Bi},isLog(){return this.type===Zi},isExp(){return this.type===Hi},isFloor(){return this.type===Ji},isAbs(){return this.type===Ur},isNumber(){return this.type===Si},isBracket(){return this.type===$i},isSymbol(){return this.type===ki},isSegmentLength(){return this.type===Di},isTemplate(){return this.type===xi},isHole(){return this.type===Ti},isTime(){return this.type===Mr},isLimit(){return this.type===Vi},isChild(){return!!this.parent},isIdentifier(){return this.type===Gi},isFirst(){return!!this.parent&&this.parent.children.indexOf(this)===0},isLast(){return!!this.parent&&this.parent.children.indexOf(this)===1},isFunction(){return this.isRadical()||this.isPGCD()||this.isMin()||this.isMinP()||this.isMax()||this.isMaxP()||this.isMod()||this.isCos()||this.isSin()||this.isTan()||this.isLog()||this.isLn()||this.isExp()||this.isFloor()||this.isAbs()},isDuration(){return y(this)?!1:this.isTime()||!!this.unit&&this.unit.isConvertibleTo(Q("s"))},isLength(){return y(this)?!1:!!this.unit&&this.unit.isConvertibleTo(Q("m"))},isMass(){return y(this)?!1:!!this.unit&&this.unit.isConvertibleTo(Q("g"))},isVolume(){return y(this)?!1:!!this.unit&&(this.unit.isConvertibleTo(Q("m").mult(Q("m")).mult(Q("m")))||this.unit.isConvertibleTo(Q("L")))},compareTo(e){return y(this)?-1:y(e)?1:Br(this,e)},isLowerThan(e){if(y(this))return!1;let t=ve(e);if(y(t))return!1;let i=this.normal.node,r=t.normal.node,s;try{s=_t(i).isLowerThan(_t(r))}catch{s=i.eval({decimal:!0}).isLowerThan(r.eval({decimal:!0}))}return s},isLowerOrEqual(e){if(y(this))return!1;let t=ve(e);return y(t)?!1:this.isLowerThan(t)||this.equals(t)},isGreaterThan(e){if(y(this))return!1;let t=ve(e);return y(t)?!1:t.isLowerThan(this)},isGreaterOrEqual(e){if(y(this))return!1;let t=ve(e);return y(t)?!1:this.isGreaterThan(t)||this.equals(t)},isOne(){return this.toString({displayUnit:!1})==="1"},isMinusOne(){return this.string==="-1"},isZero(){return this.toString({displayUnit:!1})==="0"},equalsZero(){return this.eval().isZero()},strictlyEquals(e){return this.string===e.string},equals(e){if(y(this))return!1;let t=ve(e);return y(t)?!1:Et(this)?Et(t)&&(this.first.equals(t.first)&&this.last.equals(t.last)||this.first.equals(t.last)&&this.last.equals(t.first)):Qe(this)?Qe(t)&&this.first.equals(t.first)&&this.last.equals(t.last)||Ye(t)&&this.first.equals(t.last)&&this.last.equals(t.first):We(this)?We(t)&&this.first.equals(t.first)&&this.last.equals(t.last)||Xe(t)&&this.first.equals(t.last)&&this.last.equals(t.first):Ye(this)?Ye(t)&&this.first.equals(t.first)&&this.last.equals(t.last)||Qe(t)&&this.first.equals(t.last)&&this.last.equals(t.first):Xe(this)?Xe(t)&&this.first.equals(t.first)&&this.last.equals(t.last)||We(t)&&this.first.equals(t.last)&&this.last.equals(t.first):this.normal.string===t.normal.string},isSameQuantityType(e){return this.normal.isSameQuantityType(e.normal)},get terms(){let e,t,i;return Ee(this)?(ie(this.first)?(i={op:"+",term:this.first.first},e=[i]):C(this.first)?(i={op:"-",term:this.first.first},e=[i]):e=this.first.terms,i={op:"+",term:this.last},t=[i],e.concat(t)):Oe(this)?(ie(this.first)?(i={op:"+",term:this.first.first},e=[i]):C(this.first)?(i={op:"-",term:this.first.first},e=[i]):e=this.first.terms,i={op:"-",term:this.last},t=[i],e.concat(t)):(i={op:"+",term:this},[i])},get factors(){if(he(this)){let e=this.first.factors,t=this.last.factors;return e.concat(t)}else return[this]},get pos(){return this.parent?this.parent.children.indexOf(this):0},toString(e){return y(this)?this.error:dl(this,{...Ml,...e||{}})},get string(){return this.toString()},toLatex(e){return fl(this,{...Fl,...e||{}})},get latex(){return this.toLatex()},toTexmacs(e){return pl(this,{...Bl,...e||{}})},get texmacs(){return this.toTexmacs()},get root(){return this.parent?this.parent.root:this},isInt(){return M(this)&&this.value.isInt()},isEven(){return we(this)&&this.value.mod(2).equals(0)},isOdd(){return we(this)&&this.value.mod(2).equals(1)},isNumeric(){return M(this)||S(this)&&this.children.every(e=>e.isNumeric())},add(e){if(y(this))return this;let t=ve(e);return y(t)?t:sn([this,t])},sub(e){if(y(this))return this;let t=ve(e);return y(t)?t:nn([this,t])},mult(e,t=yt){if(y(this))return this;let i=ve(e);return y(i)?i:t===yt?an([this,i]):t===Mt?Hr([this,i]):Jl([this,i])},div(e){if(y(this))return this;let t=ve(e);return y(t)?t:on([this,t])},frac(e){if(y(this))return this;let t=ve(e);return y(t)?t:ei([this,t])},oppose(){return y(this)?this:Ct([this])},inverse(){return y(this)?this:ei([_(1),this])},radical(){return y(this)?this:Jr([this])},positive(){return y(this)?this:un([this])},bracket(){return y(this)?this:cn([this])},pow(e){if(y(this))return this;let t=ve(e);return y(t)?t:ln([this,t])},floor(){return y(this)?this:vn([this])},mod(e){if(y(this))return this;let t=ve(e);return y(t)?t:gn([this,t])},abs(){return y(this)?this:wn([this])},exp(){return y(this)?this:mn([this])},ln(){return y(this)?this:fn([this])},log(){return y(this)?this:pn([this])},sin(){return y(this)?this:dn([this])},cos(){return y(this)?this:hn([this])},shallowShuffleTerms(){return y(this)?this:Ee(this)||Oe(this)?Sl(this):this},shallowShuffleFactors(){return y(this)?this:he(this)?Ol(this):this},shuffleTerms(){return y(this)?this:El(this)},shuffleFactors(){return y(this)?this:xl(this)},shuffleTermsAndFactors(){return y(this)?this:$l(this)},sortTerms(){return y(this)?this:Al(this)},shallowSortTerms(){return y(this)?this:Pl(this)},sortFactors(){return y(this)?this:jl(this)},shallowSortFactors(){return y(this)?this:Ll(this)},sortTermsAndFactors(){return y(this)?this:Nl(this)},reduceFractions(){return y(this)?this:vl(this)},removeMultOperator(){return y(this)?this:yl(this)},removeUnecessaryBrackets(e=!1){return y(this)?this:kl(this,e)},removeZerosAndSpaces(){return y(this)?this:wl(this)},removeSigns(){return y(this)?this:Cl(this)},removeNullTerms(){return y(this)?this:_l(this)},removeFactorsOne(){return y(this)?this:bl(this)},simplifyNullProducts(){return y(this)?this:Tl(this)},searchUnecessaryZeros(){if(y(this))return!1;if(M(this)){let e=[/^0\d+/,/[.,]\d*0$/],t=this.input;return e.some(i=>t.replace(/ /g,"").match(i))}else return S(this)?this.children.some(e=>e.searchUnecessaryZeros()):!1},searchMisplacedSpaces(){if(y(this))return!1;if(M(this)){let[e,t]=this.input.replace(",",".").split("."),i=[/\d{4}/,/\s$/,/\s\d{2}$/,/\s\d{2}\s/,/\s\d$/,/\s\d\s/];return!!(i.some(r=>e.match(r))||t&&(i=[/\d{4}/,/^\s/,/^\d{2}\s/,/\s\d{2}\s/,/^\d\s/,/\s\d\s/],i.some(r=>t.match(r))))}else return S(this)?this.children.some(e=>e.searchMisplacedSpaces()):!1},eval(e){if(y(this))return this;e={...Zl,...e};let t=this.substitute(e.values),i=typeof e.unit=="string"&&e.unit!=="HMS"?b("1 "+e.unit).unit:e.unit;if(this.isNumeric()&&(hi(this)||Ut(this)))Ut(this)?t=this.first.isLowerThan(this.last)?this.first:this.last:t=this.first.isGreaterThan(this.last)?this.first:this.last;else{let r=t.normal;if(i&&r.unit){if(i==="HMS"&&!r.isDuration()||i!=="HMS"&&!b("1"+i.string).normal.isSameQuantityType(r))throw new Error(`Units incompatibles ${r.string} ${typeof i=="string"?i:i.string}`);if(i!=="HMS"){let s=r.unit.getCoefTo(i.normal());r=r.mult(s)}}i==="HMS"?t=r.toNode({formatTime:!0}):t=r.node,i&&i!=="HMS"&&(t.unit=i)}if(e.decimal&&i!=="HMS"){let r=t.unit;t=_(ee(t).toDecimalPlaces(e.precision).toString()),r&&(t.unit=r)}return t},generate(){return y(this)?this:(this.root.generated=[],Ke(this))},shallow(){return{nature:this.type,children:S(this)?this.children.map(e=>e.type):null,unit:this.unit?this.unit.string:""}},substitute(e={}){return y(this)?this:(this.root.substitutionMap={...this.root.substitutionMap,...e},vr(this,e))},matchTemplate(e){if(y(this)||y(e))return!1;let t,i,r;function s(a,l){for(let u=0;u<l.length;u++)if(!a.children[u].matchTemplate(l.children[u]))return!1;return!0}function n(a,l,u){let c=a===0?0:Math.floor(Math.log10(a))+1;return c<=u&&c>=l}function o(a,l,u){return a>=l&&a<=u}if(M(e))return M(this)&&this.value.equals(e.value);if(me(e))return this.isHole();if(ne(e))return ne(this)&&this.symbol===e.symbol;if(be(e))switch(e.nature){case"$e":case"$ep":case"$ei":if(e.signed&&(C(this)||ie(this))||e.relative&&C(this))return this.first.matchTemplate(ze({nature:e.nature,children:e.children}));if(!me(e.children[1])&&!n(this.value.toNumber(),me(e.children[0])?0:e.children[0].value.toNumber(),e.children[1].value.toNumber())||!me(e.children[2])&&!o(this.value.toNumber(),e.children[2].value.toNumber(),e.children[3].value.toNumber()))return!1;if(e.nature==="$e")return this.isInt();if(e.nature==="$ep")return this.isEven();if(e.nature==="$ei")return this.isOdd();break;case"$d":if(e.relative&&C(this))return this.first.matchTemplate(e);if(!this.isNumber()||this.isInt())return!1;{let[a,l]=this.value.toString().split(".");if(i=parseInt(a,10),r=parseInt(l,10),e.children[0].isTemplate()){if(!_(Math.floor(Math.log10(i))+1).matchTemplate(e.children[0]))return!1}else if(!n(i,e.children[0].value.toNumber(),e.children[0].value.toNumber()))return!1;if(e.children[1].isTemplate()){if(!_(Math.floor(Math.log10(r))+1).matchTemplate(e.children[1]))return!1}else if(!n(r,e.children[1].value.toNumber(),e.children[1].value.toNumber()))return!1;return!0}case"$l":return!0;default:return t=parseInt(e.nature.slice(1,e.nature.length),10),this.matchTemplate(e.root.generated[t-1])}else if(S(e))return S(this)&&e.type===this.type&&e.length===this.length&&s(this,e);return!0},copyFromString(e=!0){return b(this.toString({displayUnit:e}))},copy(e){let t={};return this.unit&&(t.unit=this.unit),S(this)&&(t.children=e||[...this.children]),M(this)&&(t.value=this.value,t.input=this.input),wt(this)&&(t.value=this.value,t.boolvalue=this.boolvalue),ne(this)&&(t.symbol=this.symbol),$t(this)&&(t.begin=this.begin,t.end=this.end),rt(this)&&(t.name=this.name),y(this)&&(t.error=this.error,t.message=this.message),St(this)&&(t.sign=this.sign),ci(this)&&(t.ops=this.ops),N({type:this.type,...t})},[Symbol.iterator](){return this.children[Symbol.iterator]()},get first(){return this.children[0]},get last(){return this.children[this.children.length-1]},get length(){return this.children.length},isTrue(){return wt(this)&&this.boolvalue},isFalse(){return wt(this)&&!this.boolvalue}}}function N({type:e,children:t,...i}){let r=Hl();return t&&(t=t.map(s=>{if(s.parent){let n=s.copy();return n.parent=r,n}else return s.parent=r,s}),r.children=t),r.type=e,Object.assign(r,i),r}function sn(e){return N({type:vi,children:e})}function nn(e){return N({type:wi,children:e})}function on(e){return N({type:yi,children:e})}function an(e){return N({type:yt,children:e})}function Hr(e){return N({type:Mt,children:e})}function Jl(e){return N({type:Vt,children:e})}function ei(e){return N({type:_i,children:e})}function ln(e){return N({type:bi,children:e})}function Ct(e){return N({type:Ei,children:e})}function un(e){return N({type:Oi,children:e})}function cn(e){return N({type:$i,children:e})}function Jr(e){return N({type:zi,children:e})}function hn(e){return N({type:Ui,children:e})}function dn(e){return N({type:Mi,children:e})}function zl(e){return N({type:Fi,children:e})}function fn(e){return N({type:Bi,children:e})}function pn(e){return N({type:Zi,children:e})}function mn(e){return N({type:Hi,children:e})}function Gl(e){return N({type:Ii,children:e})}function gn(e){return N({type:qi,children:e})}function vn(e){return N({type:Ji,children:e})}function wn(e){return N({type:Ur,children:e})}function Vl(e){return N({type:qr,children:e})}function Kl(e){return N({type:Rr,children:e})}function Ql(e){return N({type:Dr,children:e})}function Wl(e){return N({type:Ir,children:e})}function Yl(e){return N({type:Nr,children:e})}function _(e){let t=new J(typeof e=="string"?e.replace(",",".").replace(/\s/g,""):e);return N({type:Si,value:t,input:e.toString().trim().replace(",",".")})}function Ce(e){return N({type:Ri,boolvalue:e,value:e?new J(1):new J(0)})}function et(e){return N({type:ki,symbol:e})}function Xl(e,t){return N({type:Di,begin:e,end:t})}function yn(e,t="",i=""){return N({type:tt,error:e,message:t,input:i})}function de(){return N({type:Ti})}function ze(e){return N({type:xi,...e})}function eu(e,t){return N({type:Cr,ops:e,children:t})}function tu(e){return N({type:Pi,children:e})}function iu(e){return N({type:Ai,children:e})}function ru(e,t){return N(t==="<"?{type:Li,children:e}:t===">"?{type:Ni,children:e}:t==="<="?{type:ji,children:e}:{type:Ci,children:e})}function su(e){return N({type:Mr,children:e})}function nu(e){return N({type:Gi,name:e})}function ou(e,t){return N({type:Vi,sign:e,children:t})}function ve(e){let t;return typeof e=="string"||typeof e=="number"||J.isDecimal(e)?t=b(e):t=e,t}var ms=j("+"),gs=j("-"),au=j("*"),sr=j(":"),lu=j("/"),vs=j("^"),uu=j("?"),cu=j("."),hu=j("="),du=j("!="),fu=j("%"),ws=j("\\"),ys=j("m"),_s=j("d"),pu=j("cd"),mu=j("@[<>]=?"),bs=j("("),Ts=j(")"),ue=j(";"),nr=j("["),or=j("]"),je=j("{"),Ne=j("}"),gu=j("$$"),vu=j("@\\$(e[pi]?)(rs?)?"),wu=j("@\\$d(r)?"),yu=j("@\\$(\\d)+"),_u=j("$l"),bu=j("$"),Tu=j("@&[a-z]+(\\d)*|&(\\d)+"),ku=j("@_({.+}|([0-9]+|[ijknmp]))"),Su=j("@[A-Z][A-Z]"),Eu=j("@pi|infinity"),Ou=j("@false|true"),ks=j("@cos|sin|sqrt|pgcd|minip|mini|maxip|maxi|cos|sin|tan|exp|ln|log|mod|floor|abs"),xu=j("@[\\d]+"),$u=j("@\\d+[\\d\\s]*([,\\.][\\d\\s]*\\d+)?"),Pu=j("@((\\d+[\\d\\s]*([,\\.][\\d\\s]*\\d+)?)\\s*ans?)?\\s*((\\d+[\\d\\s]*([,\\.][\\d\\s]*\\d+)?)\\s*mois)?\\s*((\\d+[\\d\\s]*([,\\.][\\d\\s]*\\d+)?)\\s*semaines?)?\\s*((\\d+[\\d\\s]*([,\\.][\\d\\s]*\\d+)?)\\s*jours?)?\\s*((\\d+[\\d\\s]*([,\\.][\\d\\s]*\\d+)?)\\s*h(?![a-zA-Z]))?\\s*((\\d+[\\d\\s]*([,\\.][\\d\\s]*\\d+)?)\\s*mins?)?\\s*((\\d+[\\d\\s]*([,\\.][\\d\\s]*\\d+)?)\\s*s(?![a-zA-Z]))?\\s*((\\d+[\\d\\s]*([,\\.][\\d\\s]*\\d+)?)\\s*ms)?"),Ss=j("@Qr||k|kL|hL|daL|L|dL|cL|mL|km|hm|dam|dm|cm|mm|ans|min|ms|t|q|kg|hg|dag|dg|cg|mg||m|g|h|s"),Au=j("@(inf|\\d+)(plus|moins)"),Es="no valid atom found",Lu="non compatible units",ju="Unexpected end of expression",Nu="unit required",Cu="no unit before a factor in implicit product",Du="Number must be placed at the beginning of an implicit product",Iu=j("@[a-z]{1}"),qu={implicit:!0};function yr({implicit:e}=qu){let t,i,r,s;function n(f){return t.match(f)?(i=t.lexem,s=t.parts,i):""}function o(f){return t.prematch(f)}function a(f){if(!n(f))throw new Error(`${f.pattern} required`)}function l(){return u()}function u(){let f=[],g=[];f.push(c());let k;for(;n(hu)||n(du)||n(mu);)g.push(i),f.push(c());return g.length===0?k=f[0]:g.length===1?g[0]==="!="?k=iu([f[0],f[1]]):g[0]==="="?k=tu([f[0],f[1]]):k=ru([f[0],f[1]],g[0]):k=eu(g,f),k}function c(){let f,g,k="";for((n(gs)||n(ms))&&(k=i),g=h(),k?f=k==="-"?Ct([g]):un([g]):f=g;n(ms)||n(gs);){if(k=i,g=h(),!g.isSameQuantityType(f))throw new Error(Lu);f=k==="+"?sn([f,g]):nn([f,g])}return f}function h(){let f=d();for(;n(au)||n(sr)||n(lu);)i==="*"?f=an([f,d()]):i===":"?f=on([f,d({localImplicit:!1})]):f=ei([f,d({localImplicit:!1})]);return f}function d({localImplicit:f=!0}={}){let g=p(),k;if(e&&f)do{try{k=p()}catch(x){if(x.message===Es)k=null;else throw x}if(k&&k.isNumber())throw new Error(Du);if(k&&g.unit)throw new Error(Cu);k&&(g=Hr([g,k]))}while(k);return g}function p(){let f=w();for(;n(vs);)f=ln([f,w()]);return f}function w(){let f,g,k,x=null,P=null;if(n(Au)){let E=i,L,V;E[0]==="i"?(L=E.substring(3)==="plus"?"+":"-",V=[et("inf")]):(L=E[E.length-2]==="u"?"+":"-",V=E[E.length-2]==="u"?[_(E.substring(0,E.length-4))]:[_(E.substring(0,E.length-5))]),f=ou(L,V)}else if(n(Tu))f=nu(i);else if(n(Ou))f=Ce(i==="true");else if(n(Pu)){let E=["ans","mois","semaines","jours","h","min","s","ms"],L=[s[3],s[6],s[9],s[12],s[15],s[18],s[21],s[24]],V=L.filter(H=>!!H),X=V.length===1?E[L.findIndex(H=>!!H)]:null;if(X)f=yr().parse(V[0]),f.unit=Q(X);else if(V.length===0)f=_(0),f.unit=Q("s");else{let H=L.map((ae,W)=>{let le=ae?yr().parse(ae.trim()):_(0);return le.unit=Q(E[W]),le});f=su(H)}}else if(n(Su))f=Xl(i.charAt(0),i.charAt(1));else if(n($u))f=_(i);else if(n(uu))f=de();else if(g=n(ks)){switch(a(bs),g){case"sqrt":f=Jr([l()]);break;case"pgcd":{let E=l();a(ue);let L=l();f=Gl([E,L]);break}case"minip":{let E=l();a(ue);let L=l();f=Kl([E,L]);break}case"mini":{let E=l();a(ue);let L=l();f=Vl([E,L]);break}case"maxip":{let E=l();a(ue);let L=l();f=Wl([E,L]);break}case"maxi":{let E=l();a(ue);let L=l();f=Ql([E,L]);break}case"mod":{let E=l();a(ue);let L=l();f=gn([E,L]);break}case"cos":f=hn([l()]);break;case"sin":f=dn([l()]);break;case"tan":f=zl([l()]);break;case"ln":f=fn([l()]);break;case"log":f=pn([l()]);break;case"exp":f=mn([l()]);break;case"floor":f=vn([l()]);break;case"abs":f=wn([l()]);break;default:throw new Error("function not recognized")}a(Ts)}else if(n(vu)){let E=s[2],L=s[3],V=!!L&&L.includes("s");k=[];let X=[],H=[],ae=[],W=de(),le=de(),Fe=de(),ot=de();if(n(je)?(le=l(),n(ue)&&(W=le,le=l()),a(Ne)):n(nr)&&(Fe=l(),a(ue),ot=l(),a(or)),n(ws))if(n(je)){k=[];do n(ys)?X.push(l()):n(_s)?H.push(l()):n(pu)?ae.push(l()):k.push(l());while(n(ue));a(Ne)}else a(nr),x=l(),a(ue),P=l(),a(or);let z={nature:"$"+E,relative:!!L,signed:V,children:[W,le,Fe,ot]};k.length&&(z.exclude=k),X.length&&(z.excludeMultiple=X),H.length&&(z.excludeDivider=H),ae.length&&(z.excludeCommonDividersWith=ae),x&&(z.excludeMin=x),P&&(z.excludeMax=P),f=ze(z)}else if(n(wu)){let E="d",L=s[2],V=de(),X=de(),H=de(),ae=de(),W=de(),le=de();n(je)&&(V=l(),n(sr)&&(X=V,V=de(),H=l()),n(ue)&&(ae=l(),n(sr)&&(W=ae,ae=de(),le=l())),a(Ne)),f=ze({nature:"$"+E,relative:!!L,children:[V,ae,X,H,W,le]})}else if(n(yu)){let E=s[2];f=ze({nature:"$"+E,children:[]})}else if(n(_u)){let E=i,L=[],V=[],X=[];for(k=[],x=null,P=null,a(je),L.push(l());n(ue);)L.push(l());if(a(Ne),n(ws))if(n(je)){k=[];do n(ys)?V.push(l()):n(_s)?X.push(l()):k.push(l());while(n(ue));a(Ne)}else a(nr),x=l(),a(ue),P=l(),a(or);let H={nature:E,children:L};k.length&&(H.exclude=k),V.length&&(H.excludeMultiple=V),X.length&&(H.excludeDivider=X),x&&(H.excludeMin=x),P&&(H.excludeMax=P),f=ze(H)}else if(n(gu)){let E=null;n(xu)&&(E=parseInt(i,10)),a(je);let L={nature:"$$",children:[l()]};E&&(L.precision=E),f=ze(L),a(Ne)}else if(n(bu))a(je),f=ze({nature:"$",children:[l()]}),a(Ne);else if(n(Eu))f=et(i);else if(n(Iu)){let E=i;switch(E){default:n(ku)&&(E+=i),f=et(E)}}else if(n(bs))f=cn([l()]),a(Ts);else if(n(je))f=l(),a(Ne);else throw new Error(Es);if(f&&n(fu)&&(f=Yl([f])),f&&!o(ks)){let E=v();E&&(f.unit=E)}return f}function v(){function f(){let g=Q(i);if(n(vs)){let k=w();g=g.pow(k)}return g}if(n(Ss)){let g=f();for(;n(cu);)if(n(Ss))g=g.mult(f());else throw new Error(Nu);return g}else return null}return{parse(f){let g;if(typeof f=="number"||J.isDecimal(f))g=_(f);else{f=f.trim(),r=f,t=tl(f);try{if(g=l(),t.pos<r.length)throw new Error(ju)}catch(k){let x="-".repeat(t.pos);x+="^";let P=`
${r}
${x}
${k.message}`;g=yn(k.message,P,f)}}return g}}}var Ru=yr;function b(e,t){return Ru(t).parse(e)}var _n=b;function jt(){}const Yt={};function Uu(e,t="info"){if(!Object.prototype.hasOwnProperty.call(Yt,e)||Yt[e].level!==t){const i=["trace","debug","info","warn","fail"],r=`%c[${e}] `,s=`[${e}] `,n=i.indexOf(t)<=i.indexOf("fail")?console.error.bind(console,r,"color:#ED8784"):jt,o=i.indexOf(t)<=i.indexOf("warn")?console.warn.bind(console,r,"color:#F3D9A2"):jt,a=i.indexOf(t)<=i.indexOf("info")?console.info.bind(console,r,"color:#8CE9FF"):jt,l=i.indexOf(t)<=i.indexOf("debug")?console.log.bind(console,s):jt,u=i.indexOf(t)<=i.indexOf("trace")?console.log.bind(console,s):jt;Yt[e]={level:t,fail:n,warn:o,info:a,debug:l,trace:u}}return Yt[e]}const Ju=function(e){let t=e.length,i,r;for(;t!==0;)r=Math.floor(Math.random()*t),t-=1,i=e[t],e[t]=e[r],e[r]=i;return e};function Mu(e){return Object.entries(e).length===0}const zu=(e,t)=>e<t?-1:e>t?1:0;function Gu(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}const bn=/\$\$(.*?)\$\$/g,Fu=(e,t)=>"$$"+_n(t).latex+"$$",Bu=(e,t)=>"$"+_n(t).texmacs+"$";function Tn(e){return typeof e=="object"&&!!e.text}const Os=e=>e?Array.isArray(e)?e.map(t=>Os(t)):Tn(e)?{...e,text:Os(e.text)}:typeof e=="string"?e.replace(bn,Fu):e:"",xs=e=>e?Array.isArray(e)?e.map(t=>xs(t)):Tn(e)?{...e,text:xs(e.text)}:typeof e=="string"?e.replace(bn,Bu):e:"";function Vu(e,t,i){return Object.keys(e).reduce(function(r,s,n){const o=e[s],a=t(o,s,n);return typeof a=="object"&&Mu(a)||Array.isArray(a)&&a.length===0||!a||(r[s]=a),r},i||{})}function Ku(e){return!isNaN(+e)&&Number.isInteger(+e)}function Qu(e){const t=Math.floor(e/864e5),i=Math.floor(e%(1e3*60*60*24)/(1e3*60*60)),r=Math.floor(e%(1e3*60*60)/(1e3*60)),s=Math.floor(e%(1e3*60)/1e3),n=Math.floor(e%1e3);return{days:t,hours:i,minutes:r,seconds:s,milliseconds:n}}const Wu="1.5em",Yu="1.875em";Uu("db","info");const Xu=na(kn,Sn);async function ec(e,t,i){return e.from("users").update({gidouilles:i}).eq("id",t)}async function tc(e,t,i){const r={vips:JSON.stringify(Zu(i))};return console.log("row",r,e),console.log("student_id",t),e.from("users").update(r).eq("id",t)}async function ic(e,t){return e.from("users").select("auth_id, role, grade, email, firstname, lastname, id, classe_ids, school_id, teacher_id, gidouilles, vips").eq("role","student").contains("classe_ids",[t])}async function rc(e,t){return e.from("classes").select("id, name, grade, school_id, schedule").eq("school_id",t)}function sc(e,{name:t,grade:i,school_id:r}){return e.from("classes").insert([{name:t,grade:i,school_id:r}])}async function nc(e,t){return e.from("users").select("auth_id, role, email, firstname, lastname, id, classe_ids, school_id").eq("role","teacher").eq("school_id",t)}async function oc(e,t){return e.from("assessments").select("id, title, questions, teacher_id").eq("teacher_id",t)}async function ac(e,t){return e.from("assessments").select("id, questions, title, teacher_id").eq("id",t).maybeSingle()}async function lc(e,t){return e.from("assignments").insert(t.map(({id:i,basket:r,...s})=>({...s,basket:JSON.stringify(r)})))}async function uc(e,t,i){return e.from("warnings").select("id, date, student_id, warnings, users(teacher_id)").eq("users.teacher_id",t).eq("date",i)}async function cc(e,t){return e.from("warnings").select("id, date, student_id, warnings").eq("student_id",t).order("date",{ascending:!1})}async function hc(e,t){return e.from("navadra_players").select("id,sex,pseudo,avatar,level,xp,fire_pyrs,wind_pyrs,water_pyrs,earth_pyrs,spent_fire_pyrs,spent_wind_pyrs,spent_water_pyrs,spent_earth_pyrs,prestige,tutor, position, monsters_ids, tuto").eq("user_id",t).maybeSingle()}async function dc(e,{id:t,...i}){return e.from("navadra_players").insert(i).select().single()}async function fc(e,t){return e.from("navadra_players").update(t).eq("id",t.id)}async function pc(e,t){return e.from("navadra_monsters").select("id, name, element, level, category, position, dead, nb_hunters").eq("id",t).maybeSingle()}async function mc(e,{id:t,...i}){return e.from("navadra_monsters").insert(i).select().single()}async function gc(e,t){return e.from("navadra_monsters").update(t).eq("id",t.id)}async function vc(e,t){return e.from("posts").insert(t).select().single()}async function wc(e){return e.from("posts").select("id, title, content, tags, summary, metadescription, updated_at, published_at")}async function yc(e){return e.from("tags").select("id, name")}function Zu(e){return e.reduce((t,{card:i,count:r})=>(t[i.name]=r,t),{})}export{Wu as A,Yu as B,pc as C,ac as D,mc as E,gc as F,hc as G,dc as H,fc as I,Ku as J,Tn as K,kn as P,Sn as a,Gu as b,na as c,Qu as d,nc as e,ic as f,Uu as g,rc as h,sc as i,tc as j,Xu as k,cc as l,oc as m,lc as n,Vu as o,ec as p,Mu as q,uc as r,Ju as s,wc as t,yc as u,vc as v,Os as w,_n as x,xs as y,zu as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}